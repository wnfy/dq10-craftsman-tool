<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>„Éâ„É©„ÇØ„Ç®10 ËÅ∑‰∫∫ÊîØÊè¥„ÉÑ„Éº„É´</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- üÜï „Çø„Éñ„ÅÆ„Ç¢„Ç§„Ç≥„É≥ÔºàfaviconÔºâ -->
  <link rel="icon" type="image/svg+xml" href="assets/main-icon.svg" />
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png" />
  <!-- üÜï Apple Touch Icon -->
  <link rel="apple-touch-icon" href="assets/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png" />

  <!-- üÜï „Åù„ÅÆ‰ªñ„ÅÆ„Ç¢„Ç§„Ç≥„É≥Ôºà‰ªªÊÑèÔºâ -->
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png" />

  <!-- üÜï „Ç¢„Éó„É™Âêç„ÅÆË®≠ÂÆöÔºà‰ªªÊÑèÔºâ -->
  <meta name="apple-mobile-web-app-title" content="DQXËÅ∑‰∫∫„ÉÑ„Éº„É´" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .page-flip-enter {
      animation: pageFlipIn 0.6s ease-out;
    }

    @keyframes pageFlipIn {
      0% {
        transform: perspective(1000px) rotateY(-90deg);
        opacity: 0;
      }

      100% {
        transform: perspective(1000px) rotateY(0deg);
        opacity: 1;
      }
    }

    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes spin-slow {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-20px);
      }
    }

    .animate-fade-in {
      animation: fade-in 0.8s ease-out forwards;
      opacity: 0;
    }

    .animate-spin-slow {
      animation: spin-slow 3s linear infinite;
    }
  </style>
</head>

<body>
  <div id="root"></div>
  <script type="text/babel">
    // SVG„Ç¢„Ç§„Ç≥„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
    const Search = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
    );

    const Package = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M16.5 9.4 7.55 4.24"></path>
        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
        <line x1="12" y1="22.08" x2="12" y2="12"></line>
      </svg>
    );

    const Sparkles = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
        <path d="M5 3v4"></path>
        <path d="M19 17v4"></path>
        <path d="M3 5h4"></path>
        <path d="M17 19h4"></path>
      </svg>
    );

    const UtensilsCrossed = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8"></path>
        <path d="M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7"></path>
        <path d="m2.1 21.8 6.4-6.3"></path>
        <path d="m19 5-7 7"></path>
      </svg>
    );

    const Pin = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <line x1="12" x2="12" y1="17" y2="22"></line>
        <path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z"></path>
      </svg>
    );

    const TrendingUp = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
        <polyline points="16 7 22 7 22 13"></polyline>
      </svg>
    );

    const { useState, useEffect } = React;

    const CraftsmanApp = () => {
      const [showWelcome, setShowWelcome] = useState(true);
      const [activeCategory, setActiveCategory] = useState('Ê≠¶Âô®ÈçõÂÜ∂');

      // Enter„Ç≠„Éº„Åß„Ç¶„Çß„É´„Ç´„É†ÁîªÈù¢„ÇíÈñâ„Åò„Çã
      useEffect(() => {
        const handleKeyPress = (e) => {
          if (e.key === 'Enter' && showWelcome) {
            setShowWelcome(false);
          }
        };
        window.addEventListener('keydown', handleKeyPress);
        return () => window.removeEventListener('keydown', handleKeyPress);
      }, [showWelcome]);

      const [searchQuery, setSearchQuery] = useState('');
      const [searchActive, setSearchActive] = useState('');
      const [selectedItem, setSelectedItem] = useState(null);
      const [materialPrices, setMaterialPrices] = useState({});
      const [toolPrices, setToolPrices] = useState({});
      const [selectedArmorType, setSelectedArmorType] = useState('Â∞èÁõæ');
      const [selectedWeaponType, setSelectedWeaponType] = useState('ÁâáÊâãÂâ£');
      const [selectedToolType, setSelectedToolType] = useState('Á¥†Êùê');
      const [selectedSewingType, setSelectedSewingType] = useState('„Ç¢„Çø„Éû');
      const [selectedWoodworkType, setSelectedWoodworkType] = useState('„Çπ„ÉÜ„Ç£„ÉÉ„ÇØ');
      const [selectedCookingType, setSelectedCookingType] = useState('ÊñôÁêÜÂÖ®ÈÉ®');
      const [craftQuantity, setCraftQuantity] = useState({});
      const [sellPrices, setSellPrices] = useState({});
      const [craftResults, setCraftResults] = useState({});
      const [bazaarMode, setBazaarMode] = useState({});
      const [pageTransition, setPageTransition] = useState(false);

      // üÜï ÂèéÁõäÁÆ°ÁêÜÁî®„ÅÆstate
      const [savedRecords, setSavedRecords] = useState([]);
      const [profitView, setProfitView] = useState('today'); // 'today' or 'month'
      const [isPinned, setIsPinned] = useState(false);

      // üÜï „ÅäÊ∞ó„Å´ÂÖ•„ÇäÊ©üËÉΩÁî®„ÅÆstate
      const [favoriteItems, setFavoriteItems] = useState([]);

      // üÜï UIË®≠ÂÆöÁî®„ÅÆstate
      const [showBackgroundVideo, setShowBackgroundVideo] = useState(true);
      const [theme, setTheme] = useState('colorful'); // 'colorful' or 'simple'

      const [fontSize, setFontSize] = useState('normal'); // 'normal' or 'large'

      // üÜï LocalStorage„Åã„ÇâÂèéÁõä„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄ
      useEffect(() => {
        const saved = localStorage.getItem('dqx_profit_records');
        if (saved) {
          setSavedRecords(JSON.parse(saved));
        }
        const pinned = localStorage.getItem('dqx_profit_pinned');
        if (pinned) {
          setIsPinned(JSON.parse(pinned));
        }
        // üÜï „ÅäÊ∞ó„Å´ÂÖ•„Çä„ÇíË™≠„ÅøËæº„Åø
        const favorites = localStorage.getItem('dqx_favorite_items');
        if (favorites) {
          setFavoriteItems(JSON.parse(favorites));
        }

        // üÜï UIË®≠ÂÆö„ÇíË™≠„ÅøËæº„Åø
        const bgVideo = localStorage.getItem('dqx_bg_video');
        if (bgVideo !== null) {
          setShowBackgroundVideo(JSON.parse(bgVideo));
        }
        const savedTheme = localStorage.getItem('dqx_theme');
        if (savedTheme) {
          setTheme(savedTheme);
        }
        const savedFontSize = localStorage.getItem('dqx_font_size');
        if (savedFontSize) {
          setFontSize(savedFontSize);
        }
      }, []);

      // JSON„Éï„Ç°„Ç§„É´„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄ
      const [allItems, setAllItems] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        fetch('data/items.json')
          .then(res => res.json())
          .then(data => {
            setAllItems(data);
            setLoading(false);
          })
          .catch(error => {
            console.error('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
            setLoading(false);
          });
      }, []);
      // üÜï ÊàêÊûú„Çí‰øùÂ≠ò„Åô„ÇãÈñ¢Êï∞
      const saveRecord = (item) => {
        const record = {
          id: Date.now(),
          timestamp: new Date().toISOString(),
          itemName: item.name,
          category: item.category,
          subCategory: item.subCategory,
          materialPrices: {},
          toolPrice: toolPrices[item.name] || 0,
          quantity: craftQuantity[item.name] || 1,
          sellPrices: sellPrices[item.name] || {},
          craftResults: craftResults[item.name] || {},
          bazaarMode: bazaarMode[item.name] ?? true,
          totalCost: calculateTotal(item),
          totalIncome: 0,
          profit: 0
        };

        // Á¥†Êùê‰æ°Ê†º„Çí„Ç≥„Éî„Éº
        item.materials.forEach(material => {
          const key = `${item.name}-${material.name}`;
          if (materialPrices[key]) {
            record.materialPrices[material.name] = materialPrices[key];
          }
        });

        // ÂèéÂÖ•„Å®Âà©Áõä„ÇíË®àÁÆó
        const results = craftResults[item.name] || {};
        const prices = sellPrices[item.name] || {};
        const feeRate = (bazaarMode[item.name] ?? true) ? 0.95 : 1.0;
        const isMaterial = item.category === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && item.subCategory === 'Á¥†Êùê';
        const isSimpleMode = isMaterial && (craftResults[`${item.name}_mode`] || 'simple') === 'simple';

        if (isMaterial) {
          const unitPrice = Math.floor((prices.unitPrice || 0) * feeRate);
          if (isSimpleMode) {
            record.totalIncome = (results.totalItems || 0) * unitPrice;
          } else {
            const totalItems =
              (results.star3 || 0) * 10 +
              (results.star2 || 0) * 3 +
              (results.star1 || 0) * 2 +
              (results.star0 || 0) * 1;
            record.totalIncome = totalItems * unitPrice;
          }
        } else {
          record.totalIncome =
            Math.floor((results.star3 || 0) * (prices.star3 || 0) * feeRate) +
            Math.floor((results.star2 || 0) * (prices.star2 || 0) * feeRate) +
            Math.floor((results.star1 || 0) * (prices.star1 || 0) * feeRate) +
            Math.floor((results.star0 || 0) * (prices.star0 || 0) * feeRate);
        }

        record.profit = record.totalIncome - record.totalCost;

        const newRecords = [record, ...savedRecords];
        setSavedRecords(newRecords);
        localStorage.setItem('dqx_profit_records', JSON.stringify(newRecords));

        alert('ÊàêÊûú„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
      };

      // üÜï ÂèéÁõä„Çµ„Éû„É™„Éº„ÇíË®àÁÆó
      const calculateSummary = (period) => {
        const now = new Date();
        let filteredRecords = savedRecords;

        if (period === 'today') {
          const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
          filteredRecords = savedRecords.filter(r => {
            const recordDate = new Date(r.timestamp);
            return recordDate >= today;
          });
        } else if (period === 'month') {
          const thisMonth = new Date(now.getFullYear(), now.getMonth(), 1);
          filteredRecords = savedRecords.filter(r => {
            const recordDate = new Date(r.timestamp);
            return recordDate >= thisMonth;
          });
        }

        const totalIncome = filteredRecords.reduce((sum, r) => sum + r.totalIncome, 0);
        const totalCost = filteredRecords.reduce((sum, r) => sum + r.totalCost, 0);
        const profit = totalIncome - totalCost;

        return { totalIncome, totalCost, profit, count: filteredRecords.length };
      };

      // üÜï „É¨„Ç≥„Éº„Éâ„ÇíÂâäÈô§
      const deleteRecord = (id) => {
        if (confirm('„Åì„ÅÆË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
          const newRecords = savedRecords.filter(r => r.id !== id);
          setSavedRecords(newRecords);
          localStorage.setItem('dqx_profit_records', JSON.stringify(newRecords));
        }
      };

      // üÜï „Éî„É≥Áïô„ÇÅÂàá„ÇäÊõø„Åà
      const togglePin = () => {
        const newPinned = !isPinned;
        setIsPinned(newPinned);
        localStorage.setItem('dqx_profit_pinned', JSON.stringify(newPinned));
      };

      // üÜï ÊúüÈñì„Åß„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åô„ÇãÈñ¢Êï∞
      const filterRecordsByPeriod = (period) => {
        const now = new Date();

        if (period === 'today') {
          const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
          return savedRecords.filter(r => {
            const recordDate = new Date(r.timestamp);
            return recordDate >= today;
          });
        } else if (period === 'month') {
          const thisMonth = new Date(now.getFullYear(), now.getMonth(), 1);
          return savedRecords.filter(r => {
            const recordDate = new Date(r.timestamp);
            return recordDate >= thisMonth;
          });
        }
        return savedRecords; // 'all'
      };

      // üÜï ‰∏ÄÊã¨ÂâäÈô§Èñ¢Êï∞
      const bulkDelete = (period) => {
        const periodNames = {
          today: '‰ªäÊó•',
          month: '‰ªäÊúà',
          all: '„Åô„Åπ„Å¶'
        };

        const targetRecords = filterRecordsByPeriod(period);

        if (targetRecords.length === 0) {
          alert(`${periodNames[period]}„ÅÆ„Éá„Éº„Çø„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì`);
          return;
        }

        if (confirm(`${periodNames[period]}„ÅÆ„Éá„Éº„ÇøÔºà${targetRecords.length}‰ª∂Ôºâ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü\n\n„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ`)) {
          if (period === 'all') {
            setSavedRecords([]);
            localStorage.setItem('dqx_profit_records', JSON.stringify([]));
            alert('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
          } else {
            const targetIds = new Set(targetRecords.map(r => r.id));
            const newRecords = savedRecords.filter(r => !targetIds.has(r.id));
            setSavedRecords(newRecords);
            localStorage.setItem('dqx_profit_records', JSON.stringify(newRecords));
            alert(`${periodNames[period]}„ÅÆ„Éá„Éº„ÇøÔºà${targetRecords.length}‰ª∂Ôºâ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`);
          }
        }
      };

      // üÜï CSV„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÈñ¢Êï∞
      const exportToCSV = (period) => {
        const periodNames = {
          today: '‰ªäÊó•',
          month: '‰ªäÊúà',
          all: '„Åô„Åπ„Å¶'
        };

        const targetRecords = filterRecordsByPeriod(period);

        if (targetRecords.length === 0) {
          alert(`${periodNames[period]}„ÅÆ„Éá„Éº„Çø„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì`);
          return;
        }

        // CSV„Éò„ÉÉ„ÉÄ„Éº
        const headers = [
          'Êó•ÊôÇ',
          '„Ç´„ÉÜ„Ç¥„É™',
          '„Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™',
          'ÂïÜÊùêÂêç',
          '‰ΩúÊàêÂõûÊï∞',
          'Á∑èÂ£≤‰∏ä',
          'Á∑è„Ç≥„Çπ„Éà',
          'Á¥îÂà©Áõä',
          '„Éê„Ç∂„Éº/„É¢„Éº„É¢„É≥',
          '‚òÜ‚òÜ‚òÜ',
          '‚òÜ‚òÜ',
          '‚òÜ',
          '‚òÜ„Å™„Åó',
          'Â§±Êïó'
        ];

        // Êï∞ÂÄ§„Çí„Ç´„É≥„ÉûÂå∫Âàá„Çä„Å´„Åô„ÇãÈñ¢Êï∞
        const formatNumber = (num) => {
          return num.toLocaleString('ja-JP');
        };

        // CSV„Éá„Éº„Çø
        const rows = targetRecords.map(record => {
          // Êó•‰ªò„Çí yyyy/MM/dd HH:mm ÂΩ¢Âºè„Å´ÔºàExcel„Åß####„Å´„Å™„Çâ„Å™„ÅÑÔºâ
          const date = new Date(record.timestamp);
          const dateStr = `${date.getFullYear()}/${String(date.getMonth() + 1).padStart(2, '0')}/${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;

          const bazaarMode = record.bazaarMode ? '„Éê„Ç∂„Éº' : '„É¢„Éº„É¢„É≥';
          const results = record.craftResults || {};

          return [
            dateStr,
            record.category,
            record.subCategory,
            record.itemName,
            formatNumber(record.quantity),
            formatNumber(record.totalIncome),
            formatNumber(record.totalCost),
            formatNumber(record.profit),
            bazaarMode,
            formatNumber(results.star3 || 0),
            formatNumber(results.star2 || 0),
            formatNumber(results.star1 || 0),
            formatNumber(results.star0 || 0),
            formatNumber(results.fail || 0)
          ];
        });

        // ÂèéÁõä„Çµ„Éû„É™„Éº„ÇíË®àÁÆó
        const totalIncome = targetRecords.reduce((sum, r) => sum + r.totalIncome, 0);
        const totalCost = targetRecords.reduce((sum, r) => sum + r.totalCost, 0);
        const totalProfit = totalIncome - totalCost;

        // „Çµ„Éû„É™„ÉºË°åÔºàÁ©∫Ë°å + „Çµ„Éû„É™„ÉºÔºâ
        const summaryRows = [
          [''], // Á©∫Ë°å
          ['=== ÂèéÁõä„Çµ„Éû„É™„Éº ==='],
          ['ÊúüÈñì', periodNames[period]],
          ['Ë®òÈå≤Êï∞', `${formatNumber(targetRecords.length)}‰ª∂`],
          ['Á∑èÂ£≤‰∏ä', `${formatNumber(totalIncome)}G`],
          ['Á∑è„Ç≥„Çπ„Éà', `${formatNumber(totalCost)}G`],
          ['Á¥îÂà©Áõä', `${formatNumber(totalProfit)}G`]
        ];

        // CSVÁîüÊàê
        const csvContent = [
          headers.join(','),
          ...rows.map(row => row.map(cell => `"${cell}"`).join(',')),
          ...summaryRows.map(row => row.map(cell => `"${cell}"`).join(','))
        ].join('\n');

        // BOM‰ªò„Åç„Åß„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÔºàExcel„ÅßÊñáÂ≠óÂåñ„ÅëÈò≤Ê≠¢Ôºâ
        const bom = '\uFEFF';
        const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        const filename = `dqx_profit_${period}_${new Date().toISOString().split('T')[0]}.csv`;

        link.href = url;
        link.download = filename;
        link.click();
        URL.revokeObjectURL(url);

        alert(`${periodNames[period]}„ÅÆ„Éá„Éº„ÇøÔºà${targetRecords.length}‰ª∂Ôºâ„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü`);
      };

      // üÜï CSV„Ç§„É≥„Éù„Éº„ÉàÈñ¢Êï∞
      const importFromCSV = (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const text = e.target.result;
            const lines = text.split('\n').filter(line => line.trim());

            if (lines.length < 2) {
              alert('CSV„Éï„Ç°„Ç§„É´„ÅåÁ©∫„Åß„Åô');
              return;
            }

            // „Éò„ÉÉ„ÉÄ„Éº„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Å¶„ÄÅ„Éá„Éº„ÇøË°å„Çí„Éë„Éº„Çπ
            const dataLines = lines.slice(1);
            const importedRecords = [];

            for (const line of dataLines) {
              // „Çµ„Éû„É™„ÉºË°å„Çí„Çπ„Ç≠„ÉÉ„Éó
              if (line.includes('ÂèéÁõä„Çµ„Éû„É™„Éº') || line.includes('ÊúüÈñì') || line.includes('Ë®òÈå≤Êï∞') || line.includes('Á∑èÂ£≤‰∏ä') || line.includes('Á∑è„Ç≥„Çπ„Éà') || line.includes('Á¥îÂà©Áõä')) {
                continue;
              }

              // Á©∫Ë°å„Çí„Çπ„Ç≠„ÉÉ„Éó
              if (line.trim() === '' || line === '""') {
                continue;
              }

              // CSV„Éë„Éº„ÇπÔºà„ÉÄ„Éñ„É´„ÇØ„Ç©„Éº„ÉàÂØæÂøúÔºâ
              const matches = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
              if (!matches || matches.length < 14) continue;

              const cells = matches.map(cell => cell.replace(/^"|"$/g, '').replace(/,/g, '')); // „Ç´„É≥„Éû„ÇíÈô§Âéª

              // Êó•‰ªò„Éë„Éº„ÇπÔºàyyyy/MM/dd HH:mmÂΩ¢Âºè„Å´ÂØæÂøúÔºâ
              let timestamp;
              try {
                const dateStr = cells[0];
                // yyyy/MM/dd HH:mm ‚Üí Date
                const [datePart, timePart] = dateStr.split(' ');
                const [year, month, day] = datePart.split('/');
                const [hour, minute] = (timePart || '00:00').split(':');
                timestamp = new Date(year, month - 1, day, hour, minute).toISOString();
              } catch {
                timestamp = new Date().toISOString(); // „Éë„Éº„ÇπÂ§±ÊïóÊôÇ„ÅØÁèæÂú®ÊôÇÂàª
              }

              const record = {
                id: Date.now() + Math.random(), // Êñ∞„Åó„ÅÑID„ÇíÁîüÊàê
                timestamp: timestamp,
                category: cells[1],
                subCategory: cells[2],
                itemName: cells[3],
                quantity: parseInt(cells[4]) || 1,
                totalIncome: parseInt(cells[5]) || 0,
                totalCost: parseInt(cells[6]) || 0,
                profit: parseInt(cells[7]) || 0,
                bazaarMode: cells[8] === '„Éê„Ç∂„Éº',
                craftResults: {
                  star3: parseInt(cells[9]) || 0,
                  star2: parseInt(cells[10]) || 0,
                  star1: parseInt(cells[11]) || 0,
                  star0: parseInt(cells[12]) || 0,
                  fail: parseInt(cells[13]) || 0
                },
                materialPrices: {},
                toolPrice: 0,
                sellPrices: {}
              };

              importedRecords.push(record);
            }

            if (importedRecords.length === 0) {
              alert('ÊúâÂäπ„Å™„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
              return;
            }

            if (confirm(`${importedRecords.length}‰ª∂„ÅÆ„Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åô„ÅãÔºü\n\nÊó¢Â≠ò„ÅÆ„Éá„Éº„Çø„Å´ËøΩÂä†„Åï„Çå„Åæ„Åô„ÄÇ`)) {
              const newRecords = [...importedRecords, ...savedRecords];
              setSavedRecords(newRecords);
              localStorage.setItem('dqx_profit_records', JSON.stringify(newRecords));
              alert(`${importedRecords.length}‰ª∂„ÅÆ„Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„Åü`);
            }
          } catch (error) {
            console.error('Import error:', error);
            alert('CSV„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éï„Ç°„Ç§„É´ÂΩ¢Âºè„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
          }
        };

        reader.readAsText(file);
        event.target.value = ''; // input „Çí„É™„Çª„ÉÉ„Éà
      };

      // üÜï „ÅäÊ∞ó„Å´ÂÖ•„Çä„Éà„Ç∞„É´Èñ¢Êï∞
      const toggleFavorite = (item) => {
        const itemKey = `${item.category}-${item.subCategory}-${item.name}`;
        const existingIndex = favoriteItems.findIndex(
          fav => `${fav.category}-${fav.subCategory}-${fav.name}` === itemKey
        );

        let newFavorites;
        if (existingIndex !== -1) {
          // Êó¢„Å´„ÅäÊ∞ó„Å´ÂÖ•„Çä„Å´Â≠òÂú® ‚Üí ÂâäÈô§
          newFavorites = favoriteItems.filter((_, index) => index !== existingIndex);
        } else {
          // „ÅäÊ∞ó„Å´ÂÖ•„Çä„Å´ËøΩÂä†ÔºàÊúÄÊñ∞„ÇíÂÖàÈ†≠„Å´Ôºâ
          const favoriteItem = {
            ...item,
            favoritedAt: Date.now()
          };
          newFavorites = [favoriteItem, ...favoriteItems];
        }

        setFavoriteItems(newFavorites);
        localStorage.setItem('dqx_favorite_items', JSON.stringify(newFavorites));
      };

      // üÜï „ÅäÊ∞ó„Å´ÂÖ•„Çä„Åã„Å©„ÅÜ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
      const isFavorite = (item) => {
        const itemKey = `${item.category}-${item.subCategory}-${item.name}`;
        return favoriteItems.some(
          fav => `${fav.category}-${fav.subCategory}-${fav.name}` === itemKey
        );
      };

      const handleReset = () => {
        setSearchQuery('');
        setSearchActive('');
        setSelectedItem(null);
        setMaterialPrices({});
        setToolPrices({});
      };

      // üÜï ËÉåÊôØÂãïÁîª„ÅÆÂàá„ÇäÊõø„Åà
      const toggleBackgroundVideo = () => {
        const newValue = !showBackgroundVideo;
        setShowBackgroundVideo(newValue);
        localStorage.setItem('dqx_bg_video', JSON.stringify(newValue));
      };

      // üÜï „ÉÜ„Éº„Éû„ÅÆÂàá„ÇäÊõø„Åà
      const toggleTheme = () => {
        const newTheme = theme === 'colorful' ? 'simple' : 'colorful';
        setTheme(newTheme);
        localStorage.setItem('dqx_theme', newTheme);
      };

      // üÜï ÊñáÂ≠ó„Çµ„Ç§„Ç∫„ÅÆÂàá„ÇäÊõø„Åà
      const toggleFontSize = () => {
        const newSize = fontSize === 'normal' ? 'large' : 'normal';
        setFontSize(newSize);
        localStorage.setItem('dqx_font_size', newSize);
      };

      const handleSearch = () => {
        setSearchActive(searchQuery);
        setSelectedItem(null);
        setMaterialPrices({});
        setToolPrices({});
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter') {
          handleSearch();
        }
      };

      const filteredItems = (() => {
        // „ÅäÊ∞ó„Å´ÂÖ•„Çä„Ç´„ÉÜ„Ç¥„É™„ÅÆÂ†¥Âêà
        if (activeCategory === '„ÅäÊ∞ó„Å´ÂÖ•„Çä') {
          const searchMatch = searchActive === '';
          if (!searchMatch) {
            return favoriteItems.filter(item =>
              item.name.toLowerCase().includes(searchActive.toLowerCase())
            );
          }
          return favoriteItems;
        }

        // ÈÄöÂ∏∏„ÅÆ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
        let items = allItems.filter(item => {
          const categoryMatch = item.category === activeCategory;
          const searchMatch = searchActive === '' || item.name.toLowerCase().includes(searchActive.toLowerCase());

          let subCategoryMatch = true;

          if (activeCategory === 'Ê≠¶Âô®ÈçõÂÜ∂') {
            subCategoryMatch = item.subCategory === selectedWeaponType;
          }

          if (activeCategory === 'Èò≤ÂÖ∑ÈçõÂÜ∂') {
            subCategoryMatch = item.subCategory === selectedArmorType;
          }

          if (activeCategory === 'ÈÅìÂÖ∑ÈçõÂÜ∂') {
            subCategoryMatch = item.subCategory === selectedToolType;
          }

          if (activeCategory === 'Ë£ÅÁ∏´') {
            subCategoryMatch = item.subCategory === selectedSewingType;
          }

          if (activeCategory === 'Êú®Â∑•') {
            subCategoryMatch = item.subCategory === selectedWoodworkType;
          }

          if (activeCategory === 'ÊñôÁêÜ' && selectedCookingType !== 'ÊñôÁêÜÂÖ®ÈÉ®') {
            subCategoryMatch = item.subCategory === selectedCookingType;
          }

          return categoryMatch && searchMatch && subCategoryMatch;
        });

        // üÜï „ÅäÊ∞ó„Å´ÂÖ•„Çä„Ç¢„Ç§„ÉÜ„É†„ÇíÂÖàÈ†≠„Å´ÈÖçÁΩÆ
        const favoriteItemsInCategory = items.filter(item => isFavorite(item));
        const nonFavoriteItems = items.filter(item => !isFavorite(item));

        return [...favoriteItemsInCategory, ...nonFavoriteItems];
      })();

      // üÜï „ÉÜ„Éº„ÉûÂà•„ÅÆ„Ç´„É©„ÉºË®≠ÂÆö
      const getThemeColors = () => {
        if (theme === 'simple') {
          return {
            categories: Array(9).fill('from-white/20 to-white/10'),  // üîÑ ÈÄèÈÅé„Å´Â§âÊõ¥
            glowColors: Array(9).fill('rgba(255, 255, 255, 0.3)'),   // üîÑ ÁôΩ„ÅÑÂÖâ„Å´Â§âÊõ¥
            subCategories: 'from-white/20 to-white/10',              // üîÑ ÈÄèÈÅé„Å´Â§âÊõ¥
            paramColors: {
              A: 'from-indigo-500/80 to-purple-600/80',   // Â§úÁ©∫È¢®„Éç„Ç™„É≥ÔºàÁµ±‰∏ÄÔºâ
              B: 'from-indigo-500/80 to-purple-600/80',
              C: 'from-indigo-500/80 to-purple-600/80',
              D: 'from-indigo-500/80 to-purple-600/80',
              E: 'from-indigo-500/80 to-purple-600/80',
              F: 'from-indigo-500/80 to-purple-600/80',
              G: 'from-indigo-500/80 to-purple-600/80',
              H: 'from-indigo-500/80 to-purple-600/80'
            }
          };
        }
        // „Ç´„É©„Éï„É´„É¢„Éº„Éâ
        return {
          categories: [
            'from-orange-500 to-amber-500',
            'from-purple-500 to-violet-500',
            'from-pink-500 to-rose-500',
            'from-cyan-500 to-blue-500',
            'from-emerald-500 to-teal-500',
            'from-indigo-500 to-purple-500',
            'from-yellow-500 to-amber-500',
            'from-green-500 to-emerald-500'
          ],
          glowColors: [
            'rgba(251, 146, 60, 0.6)',
            'rgba(168, 85, 247, 0.6)',
            'rgba(236, 72, 153, 0.6)',
            'rgba(56, 189, 248, 0.6)',
            'rgba(16, 185, 129, 0.6)',
            'rgba(99, 102, 241, 0.6)',
            'rgba(234, 179, 8, 0.6)',
            'rgba(34, 197, 94, 0.6)'
          ],
          subCategories: 'from-cyan-500/80 to-blue-500/80',
          paramColors: {
            A: 'from-red-400 to-red-600',           // Ëµ§
            B: 'from-blue-400 to-blue-600',         // Èùí
            C: 'from-green-400 to-green-600',       // Á∑ë
            D: 'from-purple-400 to-purple-600',     // Á¥´
            E: 'from-orange-400 to-orange-600',     // „Ç™„É¨„É≥„Ç∏
            F: 'from-lime-400 to-lime-600',         // „Ç§„Ç®„É≠„Éº„Ç∞„É™„Éº„É≥
            G: 'from-cyan-400 to-cyan-600',         // Ê∞¥Ëâ≤
            H: 'from-rose-400 to-rose-600'          // „É≠„Éº„Ç∫
          }
        };
      };

      const themeColors = getThemeColors();

const categories = ['Ê≠¶Âô®ÈçõÂÜ∂', 'Èò≤ÂÖ∑ÈçõÂÜ∂', 'ÈÅìÂÖ∑ÈçõÂÜ∂', 'Ë£ÅÁ∏´', 'Êú®Â∑•', 'ÊñôÁêÜ', '„ÅäÊ∞ó„Å´ÂÖ•„Çä', 'ÂèéÁõäÁÆ°ÁêÜ', 'Ë®≠ÂÆö'];

      const weaponTypes = ['ÁâáÊâãÂâ£', '‰∏°ÊâãÂâ£', 'Áü≠Ââ£', '„É§„É™', '„Ç™„Éé', '„ÉÑ„É°', '„É†„ÉÅ', '„Éè„É≥„Éû„Éº', '„Éñ„Éº„É°„É©„É≥', 'Èéå', 'ÂÆ∂ÂÖ∑', 'Â∫≠ÂÖ∑'];

      const armorTypes = ['Â∞èÁõæ', 'Â§ßÁõæ', '„Ç¢„Çø„Éû', '„Åã„Çâ„Å†‰∏ä', '„Åã„Çâ„Å†‰∏ã', '„Ç¶„Éá', 'Ë∂≥'];

      const toolTypes = ['ÈÅìÂÖ∑', 'Á¥†Êùê', 'ÂÆ∂ÂÖ∑', 'Â∫≠ÂÖ∑'];

      const sewingTypes = ['„Ç¢„Çø„Éû', '„Åã„Çâ„Å†‰∏ä', '„Åã„Çâ„Å†‰∏ã', '„Ç¶„Éá', 'Ë∂≥', 'ÂÆ∂ÂÖ∑'];

      const woodworkTypes = ['„Çπ„ÉÜ„Ç£„ÉÉ„ÇØ', '‰∏°ÊâãÊùñ', 'Ê£ç', 'Êâá', 'Âºì', 'ÂÆ∂ÂÖ∑', 'Â∫≠ÂÖ∑', 'Èá£„Çä„Åñ„Åä'];

      const cookingTypes = ['ÊñôÁêÜÂÖ®ÈÉ®', 'ËÇâÊñôÁêÜ', 'È≠öÊñôÁêÜ', '„Éë„Çπ„Çø&„É©„Ç§„Çπ', '„Çπ„Ç§„Éº„ÉÑ'];

      const updatePrice = (itemName, materialName, price) => {
        const numericValue = price.replace(/,/g, '');
        setMaterialPrices(prev => ({
          ...prev,
          [`${itemName}-${materialName}`]: numericValue === '' ? 0 : parseInt(numericValue) || 0
        }));
      };

      const formatNumber = (value) => {
        if (!value) return '';
        return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      };

      const calculateTotal = (item) => {
        const materialTotal = item.materials.reduce((total, material) => {
          const price = materialPrices[`${item.name}-${material.name}`] || 0;
          return total + (price * material.quantity);
        }, 0);

        const toolPrice = toolPrices[item.name] || 0;
        const toolCost = Math.floor(toolPrice / 30);
        const quantity = craftQuantity[item.name] || 1;

        return (materialTotal + toolCost) * quantity;
      };

      // „Ç¶„Çß„É´„Ç´„É†ÁîªÈù¢
      if (showWelcome) {
        return (
          <div className="min-h-screen relative flex items-center justify-center overflow-hidden">
            {/* ËÉåÊôØÂãïÁîª */}
            {showBackgroundVideo ? (
              <video
                key="welcome-video"
                autoPlay
                loop
                muted
                playsInline
                className="fixed inset-0 -z-10 w-full h-full object-cover"
                ref={(video) => {
                  if (video) {
                    video.playbackRate = 0.5;
                  }
                }}
              >
                <source src="assets/bg-image-v10.mp4" type="video/mp4" />
              </video>
            ) : (
              <div className="fixed inset-0 -z-10 bg-gradient-to-br from-slate-700 via-slate-600 to-slate-700" />
            )}
            {/* ËÉåÊôØ„Ç™„Éº„Éê„Éº„É¨„Ç§ÔºàÂãïÁîª„ÇíÂ∞ë„ÅóÊöó„ÅèÔºâ */}
            <div className="fixed inset-0 -z-10 bg-gradient-to-b from-black/30 via-black/20 to-black/40" />

            {/* „Éç„Ç™„É≥Ë£ÖÈ£æ */}
            <div className="absolute top-10 left-10 w-96 h-96 bg-cyan-400/20 rounded-full blur-3xl animate-pulse"></div>
            <div className="absolute bottom-20 right-20 w-80 h-80 bg-purple-400/20 rounded-full blur-3xl animate-pulse" style={{ animationDelay: '1s' }}></div>
            <div className="absolute top-1/3 right-1/4 w-64 h-64 bg-pink-400/20 rounded-full blur-3xl animate-pulse" style={{ animationDelay: '2s' }}></div>

            {/* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ */}
            <div className="text-center z-10 px-4 max-w-2xl">
              {/* „Çø„Ç§„Éà„É´ */}
              <h1
                className="text-6xl md:text-7xl font-black text-white mb-4 animate-fade-in"
                style={{
                  textShadow: '0 0 40px rgba(56, 189, 248, 0.8), 0 0 80px rgba(56, 189, 248, 0.4), 0 4px 8px rgba(0,0,0,0.3)'
                }}
              >
                „Çà„ÅÜ„Åì„Åù
              </h1>
              <h2
                className="text-4xl md:text-5xl font-black text-white mb-8 animate-fade-in"
                style={{
                  animationDelay: '0.2s',
                  textShadow: '0 0 30px rgba(168, 85, 247, 0.8), 0 0 60px rgba(168, 85, 247, 0.4), 0 4px 8px rgba(0,0,0,0.3)'
                }}
              >
                ËÅ∑‰∫∫ÊîØÊè¥„ÉÑ„Éº„É´„Å∏
              </h2>

              {/* „Ç¢„Ç§„Ç≥„É≥ */}
              <div className="mb-8" style={{
                animation: 'float 3s ease-in-out infinite'
              }}>
                <div
                  className="bg-white/10 backdrop-blur-md p-6 rounded-3xl border-2 border-white/30 relative animate-pulse inline-block"
                  style={{
                    boxShadow: '0 0 40px rgba(56, 189, 248, 0.6), 0 0 80px rgba(168, 85, 247, 0.4), 0 8px 16px rgba(0,0,0,0.2)'
                  }}
                >
                  <div className="absolute inset-0 bg-gradient-to-br from-cyan-400/20 to-purple-400/20 rounded-3xl"></div>
                  <img
                    src="assets/main-icon.svg"
                    alt="DQXËÅ∑‰∫∫„ÉÑ„Éº„É´"
                    className="w-32 h-32 relative z-10"
                    style={{
                      filter: 'brightness(1.2) saturate(1.3) hue-rotate(10deg) drop-shadow(0 0 10px rgba(255, 255, 255, 0.5))',
                      display: 'block'
                    }}
                  />
                </div>
              </div>
              {/* Ë™¨ÊòéÊñá */}
              <div className="relative mb-12 animate-fade-in" style={{ animationDelay: '0.6s' }}>
                <div className="absolute inset-0 bg-gradient-to-r from-cyan-400/20 via-purple-400/20 to-pink-400/20 rounded-2xl blur-xl"></div>
                <div
                  className="relative bg-white/10 backdrop-blur-md rounded-2xl p-8 border border-white/30"
                  style={{
                    boxShadow: '0 0 30px rgba(56, 189, 248, 0.3), 0 8px 16px rgba(0,0,0,0.1)'
                  }}
                >
                  <div className="flex items-center justify-center gap-3 mb-4">
                    <div className="w-12 h-px bg-gradient-to-r from-transparent via-cyan-400 to-transparent"></div>
                    <Sparkles className="text-cyan-300" size={20} />
                    <div className="w-12 h-px bg-gradient-to-r from-transparent via-purple-400 to-transparent"></div>
                  </div>
                  <p className="text-xl md:text-2xl font-bold text-white leading-relaxed drop-shadow-lg">
                    „Éâ„É©„Ç¥„É≥„ÇØ„Ç®„Çπ„ÉàX„ÅÆËÅ∑‰∫∫Ê¥ªÂãï„Çí
                  </p>
                  <p
                    className="text-2xl md:text-3xl font-black text-white mt-2"
                    style={{
                      textShadow: '0 0 20px rgba(56, 189, 248, 0.6), 0 0 40px rgba(168, 85, 247, 0.4)'
                    }}
                  >
                    „ÇÇ„Å£„Å®‰æøÂà©„Å´„ÄÅ„ÇÇ„Å£„Å®Ê•Ω„Åó„Åè
                  </p>
                  <div className="flex items-center justify-center gap-3 mt-4">
                    <div className="w-12 h-px bg-gradient-to-r from-transparent via-purple-400 to-transparent"></div>
                    <Package className="text-purple-300" size={20} />
                    <div className="w-12 h-px bg-gradient-to-r from-transparent via-pink-400 to-transparent"></div>
                  </div>
                </div>
              </div>

              {/* „Çπ„Çø„Éº„Éà„Éú„Çø„É≥ */}
              <button
                onClick={() => setShowWelcome(false)}
                onMouseEnter={(e) => {
                  e.currentTarget.style.boxShadow = '0 0 60px rgba(56, 189, 248, 0.8), 0 0 100px rgba(168, 85, 247, 0.6), 0 20px 60px rgba(236, 72, 153, 0.4)';
                  e.currentTarget.style.transform = 'scale(1.1) translateY(-2px)';
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.boxShadow = '0 0 40px rgba(56, 189, 248, 0.6), 0 0 60px rgba(168, 85, 247, 0.4)';
                  e.currentTarget.style.transform = 'scale(1) translateY(0)';
                }}
                className="group relative px-16 py-5 bg-white/10 backdrop-blur-md text-white rounded-2xl font-black text-2xl transition-all duration-300 animate-fade-in cursor-pointer border-2 border-white/30 overflow-hidden"
                style={{
                  animationDelay: '0.9s',
                  boxShadow: '0 0 40px rgba(56, 189, 248, 0.6), 0 0 60px rgba(168, 85, 247, 0.4)'
                }}
              >
                <div className="absolute inset-0 bg-gradient-to-r from-cyan-400/20 via-purple-400/20 to-pink-400/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                <div className="relative flex items-center gap-3">
                  <Sparkles className="animate-spin-slow" size={28} />
                  <span style={{ textShadow: '0 0 20px rgba(56, 189, 248, 0.8)' }}>START</span>
                  <div className="w-2 h-2 bg-cyan-300 rounded-full animate-ping"></div>
                </div>
              </button>

              {/* Ë£úË∂≥„ÉÜ„Ç≠„Çπ„Éà */}
              <p
                className="mt-8 text-sm text-white/80 animate-fade-in drop-shadow-lg"
                style={{ animationDelay: '1.2s' }}
              >
                Enter„Ç≠„Éº„Åß„ÇÇ„Çπ„Çø„Éº„Éà„Åß„Åç„Åæ„Åô
              </p>
            </div>
          </div>
        );
      }

      // „É≠„Éº„Éá„Ç£„É≥„Ç∞‰∏≠„ÅÆË°®Á§∫
      if (loading) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-violet-100 via-fuchsia-100 to-cyan-100 flex items-center justify-center">
            <div className="text-center">
              <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-purple-600 mx-auto mb-4"></div>
              <p className="text-lg font-bold text-gray-700">„Éá„Éº„ÇøË™≠„ÅøËæº„Åø‰∏≠...</p>
            </div>
          </div>
        );
      }

      const paramColors = themeColors.paramColors;

      const gridColors = {
        A: 'from-rose-500 via-pink-500 to-red-500',
        B: 'from-sky-500 via-blue-500 to-indigo-500',
        C: 'from-emerald-500 via-teal-500 to-cyan-500',
        D: 'from-purple-500 via-violet-500 to-fuchsia-500',
        E: 'from-amber-500 via-orange-500 to-yellow-500',
        F: 'from-lime-500 via-green-500 to-emerald-500',
        G: 'from-cyan-500 via-sky-500 to-blue-500',
        H: 'from-fuchsia-500 via-pink-500 to-rose-500',
        I: 'from-violet-500 via-purple-500 to-indigo-500'
      };

      // 3x3„Ç∞„É™„ÉÉ„ÉâË°®Á§∫
      const renderGrid = (targetValues) => {
        const gridPositions = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'];

        return (
          <div className="grid grid-cols-3 gap-2.5">
            {gridPositions.map((pos) => {
              const value = targetValues[pos];
              const isEmpty = !value;

              return (
                <div
                  key={pos}
                  className={`p-4 rounded-xl text-white shadow-lg flex flex-col items-center justify-center ${isEmpty ? 'bg-white/10 backdrop-blur-sm border border-white/20' : `bg-gradient-to-br ${gridColors[pos]} backdrop-blur-sm border border-white/30`
                    }`}
                  style={isEmpty ? {} : { boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                >
                  <div className={`text-xs font-bold tracking-wider ${isEmpty ? 'text-white/40' : 'opacity-90 drop-shadow'}`}>
                    {pos}
                  </div>
                  {isEmpty ? (
                    <div className="text-2xl font-black text-white/40 mt-1 text-center">-</div>
                  ) : (
                    <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                      {value.min}-{value.max}
                    </div>
                  )}
                </div>
              );
            })}
          </div>
        );
      };

      // ÁâáÊâãÂâ£ÔºàÁ∏¶3Ôºâ: A, B, C
      const renderOnHandSword = (targetValues) => {
        const positions = ['A', 'B', 'C'];
        const paramColors = themeColors.paramColors;
        return (
          <div className="grid grid-cols-1 gap-2.5 max-w-xs mx-auto">
            {positions.map((pos) => {
              const value = targetValues[pos];
              return (
                <div
                  key={pos}
                  className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                  style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                >
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {value.min} - {value.max}
                  </div>
                </div>
              );
            })}
          </div>
        );
      };

      // ‰∏°ÊâãÂâ£ÔºàÁ∏¶4√óÊ®™2Ôºâ: A,B / C,D / E,F / G,H
      const renderTwoHandSword = (targetValues) => {
        const rows = [
          ['A', 'B'],
          ['C', 'D'],
          ['E', 'F'],
          ['G', 'H']
        ];
        const paramColors = themeColors.paramColors;
        return (
          <div className="grid grid-cols-2 gap-2.5">
            {rows.flat().map((pos) => {
              const value = targetValues[pos];
              if (!value) return null;
              return (
                <div
                  key={pos}
                  className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                  style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                >
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {value.min} - {value.max}
                  </div>
                </div>
              );
            })}
          </div>
        );
      };

      // Áü≠Ââ£ÔºàÁ∏¶2Ôºâ: A, B
      const renderDagger = (targetValues) => {
        const positions = ['A', 'B'];
        const paramColors = themeColors.paramColors;
        return (
          <div className="grid grid-cols-1 gap-2.5 max-w-xs mx-auto">
            {positions.map((pos) => {
              const value = targetValues[pos];
              return (
                <div
                  key={pos}
                  className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                  style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                >
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {value.min} - {value.max}
                  </div>
                </div>
              );
            })}
          </div>
        );
      };

      // „É§„É™ÔºàÁ∏¶4Ôºâ: A, B, C, D
      const renderSpear = (targetValues) => {
        const positions = ['A', 'B', 'C', 'D'];
        const paramColors = themeColors.paramColors;
        return (
          <div className="grid grid-cols-1 gap-2.5 max-w-xs mx-auto">
            {positions.map((pos) => {
              const value = targetValues[pos];
              return (
                <div
                  key={pos}
                  className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                  style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                >
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {value.min} - {value.max}
                  </div>
                </div>
              );
            })}
          </div>
        );
      };

      // „Ç™„Éé: A,B / C,D / E / GÔºàF„Å®HÊ¨†ÊêçÔºâ
      const renderAxe = (targetValues) => {
        const paramColors = themeColors.paramColors;
        return (
          <div className="space-y-2.5">
            <div className="grid grid-cols-2 gap-2.5">
              {['A', 'B'].map((pos) => {
                const value = targetValues[pos];
                if (!value) return null;
                return (
                  <div
                    key={pos}
                    className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                    style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                  >
                    <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
                    <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                      {value.min} - {value.max}
                    </div>
                  </div>
                );
              })}
            </div>
            <div className="grid grid-cols-2 gap-2.5">
              {['C', 'D'].map((pos) => {
                const value = targetValues[pos];
                if (!value) return null;
                return (
                  <div
                    key={pos}
                    className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                    style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                  >
                    <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
                    <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                      {value.min} - {value.max}
                    </div>
                  </div>
                );
              })}
            </div>
            <div className="grid grid-cols-2 gap-2.5">
              {targetValues['E'] && (
                <div className={`bg-gradient-to-br ${paramColors['E']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}>
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">E</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {targetValues['E'].min} - {targetValues['E'].max}
                  </div>
                </div>
              )}
              <div className="bg-white/10 backdrop-blur-sm p-4 rounded-xl opacity-30 border border-white/20"></div>
            </div>
            <div className="grid grid-cols-2 gap-2.5">
              {targetValues['G'] && (
                <div className={`bg-gradient-to-br ${paramColors['G']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}>
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">G</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {targetValues['G'].min} - {targetValues['G'].max}
                  </div>
                </div>
              )}
              <div className="bg-white/10 backdrop-blur-sm p-4 rounded-xl opacity-30 border border-white/20"></div>
            </div>
          </div>
        );
      };

      // „É†„ÉÅ: A,B / C,D / E,F / GÔºàHÊ¨†ÊêçÔºâ
      const renderWhip = (targetValues) => {
        const paramColors = themeColors.paramColors;
        return (
          <div className="space-y-2.5">
            <div className="grid grid-cols-2 gap-2.5">
              {['A', 'B'].map((pos) => {
                const value = targetValues[pos];
                if (!value) return null;
                return (
                  <div
                    key={pos}
                    className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                    style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                  >
                    <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
                    <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                      {value.min} - {value.max}
                    </div>
                  </div>
                );
              })}
            </div>
            <div className="grid grid-cols-2 gap-2.5">
              {['C', 'D'].map((pos) => {
                const value = targetValues[pos];
                if (!value) return null;
                return (
                  <div
                    key={pos}
                    className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                    style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                  >
                    <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
                    <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                      {value.min} - {value.max}
                    </div>
                  </div>
                );
              })}
            </div>
            <div className="grid grid-cols-2 gap-2.5">
              {['E', 'F'].map((pos) => {
                const value = targetValues[pos];
                if (!value) return null;
                return (
                  <div
                    key={pos}
                    className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                    style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                  >
                    <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
                    <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                      {value.min} - {value.max}
                    </div>
                  </div>
                );
              })}
            </div>
            <div className="grid grid-cols-2 gap-2.5">
              {targetValues['G'] && (
                <div className={`bg-gradient-to-br ${paramColors['G']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}>
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">G</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {targetValues['G'].min} - {targetValues['G'].max}
                  </div>
                </div>
              )}
              <div className="bg-white/10 backdrop-blur-sm p-4 rounded-xl opacity-30 border border-white/20"></div>
            </div>
          </div>
        );
      };

      // „Éè„É≥„Éû„ÉºÔºà3x2Ôºâ: A,B / C,D / E,F
      const renderHammer = (targetValues) => {
        const rows = [
          ['A', 'B'],
          ['C', 'D'],
          ['E', 'F']
        ];
        const paramColors = themeColors.paramColors;
        return (
          <div className="grid grid-cols-2 gap-2.5">
            {rows.flat().map((pos) => {
              const value = targetValues[pos];
              if (!value) return null;
              return (
                <div
                  key={pos}
                  className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                  style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                >
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {value.min} - {value.max}
                  </div>
                </div>
              );
            })}
          </div>
        );
      };

      // „Éñ„Éº„É°„É©„É≥Ôºà„Ç≥„ÅÆÂ≠óÂûãÔºâ: A,B / D / E,FÔºàC„ÅåÊ¨†ÊêçÔºâ
      const renderBoomerang = (targetValues) => {
        const paramColors = themeColors.paramColors;
        return (
          <div className="space-y-2.5">
            <div className="grid grid-cols-2 gap-2.5">
              {['A', 'B'].map((pos) => {
                const value = targetValues[pos];
                if (!value) return null;
                return (
                  <div
                    key={pos}
                    className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                    style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                  >
                    <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
                    <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                      {value.min} - {value.max}
                    </div>
                  </div>
                );
              })}
            </div>
            <div className="grid grid-cols-2 gap-2.5">
              <div className="bg-white/10 backdrop-blur-sm p-4 rounded-xl opacity-30 border border-white/20"></div>
              {targetValues['D'] && (
                <div className={`bg-gradient-to-br ${paramColors['D']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}>
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">D</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {targetValues['D'].min} - {targetValues['D'].max}
                  </div>
                </div>
              )}
            </div>
            <div className="grid grid-cols-2 gap-2.5">
              {['E', 'F'].map((pos) => {
                const value = targetValues[pos];
                if (!value) return null;
                return (
                  <div
                    key={pos}
                    className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                    style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                  >
                    <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
                    <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                      {value.min} - {value.max}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        );
      };

      // ÈéåÔºàLÂ≠óÂèçËª¢ÂûãÔºâ: A,C,E,GÔºàÁ∏¶Ôºâ / BÔºà2Ë°åÁõÆ„ÅÆ„ÅøÔºâ
      const renderScythe = (targetValues) => {
        const paramColors = themeColors.paramColors;
        return (
          <div className="space-y-2.5">
            <div className="grid grid-cols-2 gap-2.5">
              {targetValues['A'] && (
                <div className={`bg-gradient-to-br ${paramColors['A']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}>
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">A</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {targetValues['A'].min} - {targetValues['A'].max}
                  </div>
                </div>
              )}
              {targetValues['B'] ? (
                <div className={`bg-gradient-to-br ${paramColors['B']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}>
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">B</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {targetValues['B'].min} - {targetValues['B'].max}
                  </div>
                </div>
              ) : (
                <div className="bg-white/10 backdrop-blur-sm p-4 rounded-xl opacity-30 border border-white/20"></div>
              )}
            </div>
            <div className="grid grid-cols-2 gap-2.5">
              {targetValues['C'] && (
                <div className={`bg-gradient-to-br ${paramColors['C']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}>
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">C</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {targetValues['C'].min} - {targetValues['C'].max}
                  </div>
                </div>
              )}
              <div className="bg-white/10 backdrop-blur-sm p-4 rounded-xl opacity-30 border border-white/20"></div>
            </div>
            <div className="grid grid-cols-2 gap-2.5">
              {targetValues['E'] && (
                <div className={`bg-gradient-to-br ${paramColors['E']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}>
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">E</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {targetValues['E'].min} - {targetValues['E'].max}
                  </div>
                </div>
              )}
              <div className="bg-white/10 backdrop-blur-sm p-4 rounded-xl opacity-30 border border-white/20"></div>
            </div>
            <div className="grid grid-cols-2 gap-2.5">
              {targetValues['G'] && (
                <div className={`bg-gradient-to-br ${paramColors['G']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}>
                  <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">G</div>
                  <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                    {targetValues['G'].min} - {targetValues['G'].max}
                  </div>
                </div>
              )}
              <div className="bg-white/10 backdrop-blur-sm p-4 rounded-xl opacity-30 border border-white/20"></div>
            </div>
          </div>
        );
      };

      // ABCD 4„Éë„É©„É°„Éº„ÇøË°®Á§∫
      const renderABCD = (targetValues) => {
        const paramColors = themeColors.paramColors;
        return (
          <div className="grid grid-cols-2 gap-2.5">
            {Object.entries(targetValues).map(([param, values]) => (
              <div
                key={param}
                className={`bg-gradient-to-br ${paramColors[param]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
              >
                <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{param}</div>
                <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                  {values.min} - {values.max}
                </div>
              </div>
            ))}
          </div>
        );
      };

      // „Ç∞„É™„ÉÉ„Éâ„Çø„Ç§„Éó„Å´Âøú„Åò„ÅüË°®Á§∫„ÅÆÊåØ„ÇäÂàÜ„Åë
      const renderTargetValues = (item) => {
        if (Object.keys(item.targetValues).length === 0) {
          return (
            <div className="text-center py-4 bg-gray-50 rounded-xl">
              <p className="text-gray-500 font-bold text-sm">„Éá„Éº„ÇøÂèéÈõÜ‰∏≠...</p>
            </div>
          );
        }

        // „Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™„Å´Âøú„Åò„Å¶Ë°®Á§∫„ÇíÂàá„ÇäÊõø„Åà
        if (item.subCategory === 'ÁâáÊâãÂâ£') {
          return renderOnHandSword(item.targetValues);
        } else if (item.subCategory === '‰∏°ÊâãÂâ£') {
          return renderTwoHandSword(item.targetValues);
        } else if (item.subCategory === 'Áü≠Ââ£') {
          return renderDagger(item.targetValues);
        } else if (item.subCategory === '„É§„É™') {
          return renderSpear(item.targetValues);
        } else if (item.subCategory === '„Ç™„Éé') {
          return renderAxe(item.targetValues);
        } else if (item.subCategory === '„É†„ÉÅ') {
          return renderWhip(item.targetValues);
        } else if (item.subCategory === '„Éè„É≥„Éû„Éº') {
          return renderHammer(item.targetValues);
        } else if (item.subCategory === '„Éñ„Éº„É°„É©„É≥') {
          return renderBoomerang(item.targetValues);
        } else if (item.subCategory === 'Èéå') {
          return renderScythe(item.targetValues);
        } else if (item.subCategory === '„Ç¶„Éá') {
          return renderOnHandSword(item.targetValues);
        } else if (item.subCategory === 'Ë∂≥') {
          return (
            <div className="space-y-2.5">
              <div className="grid grid-cols-2 gap-2.5">
                <div className="bg-white/10 backdrop-blur-sm p-4 rounded-xl opacity-30 border border-white/20"></div>
                {item.targetValues['B'] && (
                  <div className={`bg-gradient-to-br ${paramColors['B']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}>
                    <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">B</div>
                    <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                      {item.targetValues['B'].min} - {item.targetValues['B'].max}
                    </div>
                  </div>
                )}
              </div>
              <div className="grid grid-cols-2 gap-2.5">
                <div className="bg-white/10 backdrop-blur-sm p-4 rounded-xl opacity-30 border border-white/20"></div>
                {item.targetValues['D'] && (
                  <div className={`bg-gradient-to-br ${paramColors['D']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}>
                    <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">D</div>
                    <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                      {item.targetValues['D'].min} - {item.targetValues['D'].max}
                    </div>
                  </div>
                )}
              </div>
              <div className="grid grid-cols-2 gap-2.5">
                {['E', 'F'].map((pos) => {
                  const value = item.targetValues[pos];
                  if (!value) return null;
                  return (
                    <div
                      key={pos}
                      className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
                      style={{ boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)' }}
                    >
                      <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
                      <div className="text-2xl font-black mt-1 text-center" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>
                        {value.min} - {value.max}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          );
        } else if (item.gridType === '3x3') {
          return renderGrid(item.targetValues);
        } else if (item.gridType === '3x2') {
          return renderHammer(item.targetValues);
        } else {
          return renderABCD(item.targetValues);
        }
      };
      // Âà•„Ç¶„Ç£„É≥„Éâ„Ç¶„Åß„É¨„Ç∑„Éî„ÇíÈñã„ÅèÈñ¢Êï∞
      const openRecipeWindow = (item) => {
        const width = 450;
        const height = 700;
        const left = window.screen.width - width - 50;
        const top = 100;

        const recipeWindow = window.open(
          '',
          `recipe_${item.name}`,
          `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`
        );

        if (!recipeWindow) {
          alert('„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Éñ„É©„Ç¶„Ç∂„ÅÆË®≠ÂÆö„Åß„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÇíË®±ÂèØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
          return;
        }

        const totalCost = calculateTotal(item);
        const quantity = craftQuantity[item.name] || 1;

        // ÁõÆÊ®ôÊï∞ÂÄ§„ÅÆHTMLÁîüÊàêÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ
        let targetValuesHTML = '';
        if (Object.keys(item.targetValues).length === 0) {
          targetValuesHTML = '<div style="text-align: center; padding: 1rem; background: rgb(249, 250, 251); border-radius: 0.75rem; border: 2px solid rgb(229, 231, 235);"><p style="color: rgb(107, 114, 128); font-weight: bold;">„Éá„Éº„ÇøÂèéÈõÜ‰∏≠...</p></div>';
        } else {
          const paramColors = {
            A: 'background: linear-gradient(to bottom right, rgb(244, 63, 94), rgb(236, 72, 153)); border: 2px solid rgb(225, 29, 72);',
            B: 'background: linear-gradient(to bottom right, rgb(14, 165, 233), rgb(59, 130, 246)); border: 2px solid rgb(2, 132, 199);',
            C: 'background: linear-gradient(to bottom right, rgb(16, 185, 129), rgb(20, 184, 166)); border: 2px solid rgb(5, 150, 105);',
            D: 'background: linear-gradient(to bottom right, rgb(139, 92, 246), rgb(168, 85, 247)); border: 2px solid rgb(124, 58, 237);',
            E: 'background: linear-gradient(to bottom right, rgb(245, 158, 11), rgb(251, 146, 60)); border: 2px solid rgb(217, 119, 6);',
            F: 'background: linear-gradient(to bottom right, rgb(132, 204, 22), rgb(74, 222, 128)); border: 2px solid rgb(101, 163, 13);',
            G: 'background: linear-gradient(to bottom right, rgb(6, 182, 212), rgb(34, 211, 238)); border: 2px solid rgb(8, 145, 178);',
            H: 'background: linear-gradient(to bottom right, rgb(236, 72, 153), rgb(244, 63, 94)); border: 2px solid rgb(219, 39, 119);'
          };

          targetValuesHTML = '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;">';
          Object.entries(item.targetValues).forEach(([param, values]) => {
            targetValuesHTML += `
          <div style="${paramColors[param]} padding: 1rem; border-radius: 1rem; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <div style="font-size: 0.875rem; font-weight: bold; opacity: 0.9; text-align: center; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">${param}</div>
            <div style="font-size: 1.75rem; font-weight: 900; margin-top: 0.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.2); text-align: center;">${values.min} - ${values.max}</div>
          </div>
        `;
          });
          targetValuesHTML += '</div>';
        }

        recipeWindow.document.write(`
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${item.name} - „É¨„Ç∑„Éî</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: white;
  min-height: 100vh;
}
</style>
</head>
<body>

<div style="background: linear-gradient(to right, rgb(6, 182, 212), rgb(139, 92, 246), rgb(236, 72, 153)); padding: 1.5rem; color: white; border-bottom: 3px solid rgb(5, 150, 105); box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
  <div style="font-size: 0.75rem; font-weight: bold; background: rgba(255,255,255,0.3); padding: 0.375rem 0.875rem; border-radius: 9999px; display: inline-block; border: 2px solid rgba(255,255,255,0.4); box-shadow: 0 2px 4px rgba(0,0,0,0.1);">${item.category}</div>
  <div style="display: flex; align-items: center; gap: 0.75rem; margin-top: 0.75rem;">
    <h2 style="font-size: 1.75rem; font-weight: 900; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">${item.name}</h2>
    ${item.specialTrait ? `<span style="padding: 0.375rem 0.75rem; background: rgb(250, 204, 21); color: rgb(113, 63, 18); border-radius: 9999px; font-size: 0.875rem; font-weight: bold; border: 2px solid rgb(234, 179, 8); box-shadow: 0 2px 4px rgba(0,0,0,0.1);">${item.specialTrait}</span>` : ''}
  </div>
</div>

<div style="padding: 1.5rem;">
  <h3 style="font-size: 1.125rem; font-weight: 900; color: rgb(17, 24, 39); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
    <span style="font-size: 1.5rem;">üéØ</span>
    <span>ÁõÆÊ®ôÊï∞ÂÄ§</span>
  </h3>
  ${targetValuesHTML}
</div>

<div style="padding: 0 1.5rem 1.5rem 1.5rem;">
  <h3 style="font-size: 1.125rem; font-weight: 900; color: rgb(17, 24, 39); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
    <span style="font-size: 1.5rem;">üì¶</span>
    <span>ÂøÖË¶ÅÁ¥†Êùê</span>
  </h3>
  ${item.materials.map(m => `
    <div style="padding: 1rem; background: linear-gradient(to bottom right, rgb(238, 242, 255), rgb(243, 232, 255)); border-radius: 1rem; margin-bottom: 0.75rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 2px solid rgb(199, 210, 254);">
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <span style="font-weight: bold; color: rgb(17, 24, 39); font-size: 1rem;">${m.name}</span>
        <span style="padding: 0.375rem 1rem; background: linear-gradient(to right, rgb(236, 72, 153), rgb(168, 85, 247)); color: white; border-radius: 9999px; font-weight: 900; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">√ó${m.quantity}</span>
      </div>
    </div>
  `).join('')}
</div>

</body>
</html>
    `);

        recipeWindow.document.close();
        recipeWindow.focus();
      };

      // „É°„Ç§„É≥„Ç¢„Éó„É™
      return (
        <div className={`min-h-screen relative ${fontSize === 'large' ? 'text-lg' : ''}`}>
          {showBackgroundVideo && (
            <video
              key="main-video"
              autoPlay
              loop
              muted
              playsInline
              className="fixed inset-0 -z-10 w-full h-full object-cover"
              ref={(video) => {
                if (video) {
                  video.playbackRate = 0.5;
                }
              }}
            >
              <source src="assets/bg-image-v3.mp4" type="video/mp4" />
            </video>
          )}
          {!showBackgroundVideo && (
            <div className="fixed inset-0 -z-10 bg-gradient-to-br from-slate-700 via-slate-600 to-slate-700" />
          )}
          <div className="fixed inset-0 -z-10 bg-gradient-to-b from-black/40 via-black/30 to-black/50" />

          <header className="bg-white/10 backdrop-blur-md shadow-lg sticky top-0 z-10 border-b border-white/20" style={{ boxShadow: '0 0 30px rgba(56, 189, 248, 0.3), 0 4px 6px rgba(0,0,0,0.1)' }}>
            <div className="max-w-5xl mx-auto px-3 py-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <div
                    className="bg-white/20 backdrop-blur-sm p-2 rounded-xl border border-white/30"
                    style={{ boxShadow: '0 0 20px rgba(56, 189, 248, 0.4)' }}
                  >
                    <img
                      src="assets/main-icon.svg"
                      alt="DQXËÅ∑‰∫∫„ÉÑ„Éº„É´"
                      className="w-6 h-6"
                      style={{
                        filter: 'brightness(1.2) saturate(1.3) hue-rotate(10deg) drop-shadow(0 0 8px rgba(56, 189, 248, 0.5))'
                      }}
                    />
                  </div>
                  <h1
                    className="text-2xl font-black text-white"
                    style={{ textShadow: '0 0 30px rgba(56, 189, 248, 0.8), 0 0 60px rgba(168, 85, 247, 0.4)' }}
                  >
                    „Éâ„É©„ÇØ„Ç®10 ËÅ∑‰∫∫ÊîØÊè¥„ÉÑ„Éº„É´
                  </h1>
                </div>
              </div>

              <div className="mt-4 flex gap-2 px-1">
                <div className="relative flex-1">
                  <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-cyan-300" size={18} />
                  <input
                    type="text"
                    placeholder="ÂïÜÊùêÂêç„ÇíÊ§úÁ¥¢„Åó„Å¶„Åè„Å†„Åï„ÅÑ.."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    onKeyPress={handleKeyPress}
                    className="w-full pl-10 pr-3 py-3 rounded-xl bg-white/10 backdrop-blur-sm border border-white/30 focus:outline-none focus:ring-2 focus:ring-cyan-400/50 focus:border-cyan-400 shadow-md text-sm text-white placeholder-white/60"
                    style={{ boxShadow: '0 0 20px rgba(56, 189, 248, 0.2)' }}
                  />
                </div>
                <button
                  onClick={handleSearch}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.boxShadow = '0 0 40px rgba(56, 189, 248, 0.8), 0 0 60px rgba(56, 189, 248, 0.5)';
                    e.currentTarget.style.transform = 'scale(1.05)';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.boxShadow = '0 0 20px rgba(56, 189, 248, 0.4)';
                    e.currentTarget.style.transform = 'scale(1)';
                  }}
                  className="px-6 py-3 bg-gradient-to-r from-cyan-500/80 to-blue-500/80 backdrop-blur-sm text-white rounded-xl font-bold text-sm shadow-md transition-all whitespace-nowrap border border-cyan-300/50"
                  style={{ boxShadow: '0 0 20px rgba(56, 189, 248, 0.4)' }}
                >
                  Ê§úÁ¥¢
                </button>
                <button
                  onClick={handleReset}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.boxShadow = '0 0 40px rgba(168, 85, 247, 0.6)';
                    e.currentTarget.style.transform = 'scale(1.05)';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.boxShadow = '';
                    e.currentTarget.style.transform = 'scale(1)';
                  }}
                  className="px-6 py-3 bg-white/10 backdrop-blur-sm hover:bg-white/20 text-white rounded-xl font-bold text-sm shadow-md transition-all whitespace-nowrap border border-white/30"
                >
                  „É™„Çª„ÉÉ„Éà
                </button>


              </div>
            </div>
            <div className="h-3"></div>
          </header>

{activeCategory === 'Ë®≠ÂÆö' && (
  <div className="max-w-5xl mx-auto px-3 py-6">
              <div className="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 shadow-xl">
                <h2 className="text-xl font-black text-white mb-4 flex items-center gap-2">
                  <span className="text-2xl">‚öôÔ∏è</span>
                  <span>Ë°®Á§∫Ë®≠ÂÆö</span>
                </h2>

                <div className="space-y-4">
                  <div className="flex items-center justify-between p-4 bg-white/10 rounded-xl">
                    <div>
                      <div className="font-bold text-white">ËÉåÊôØÂãïÁîª</div>
                      <div className="text-xs text-white/60">ÂãïÁîª„ÇíÈùûË°®Á§∫„Å´„Åó„Å¶Âãï‰Ωú„ÇíËªΩ„Åè„Åô„Çã</div>
                    </div>
                    <button
                      onClick={toggleBackgroundVideo}
                      className={`px-6 py-2 rounded-lg font-bold transition-all ${showBackgroundVideo
                          ? 'bg-gradient-to-r from-cyan-500 to-blue-500 text-white'
                          : 'bg-white/20 text-white/60'
                        }`}
                    >
                      {showBackgroundVideo ? 'ON' : 'OFF'}
                    </button>
                  </div>

                  <div className="flex items-center justify-between p-4 bg-white/10 rounded-xl">
                    <div>
                      <div className="font-bold text-white">„Ç´„É©„Éº„ÉÜ„Éº„Éû</div>
                      <div className="text-xs text-white/60">„Ç∑„É≥„Éó„É´„Å™ÈÖçËâ≤„Å´Âàá„ÇäÊõø„Åà</div>
                    </div>
                    <button
                      onClick={toggleTheme}
                      className="px-6 py-2 rounded-lg font-bold transition-all bg-gradient-to-r from-purple-500 to-pink-500 text-white"
                    >
                      {theme === 'colorful' ? 'üé® „Ç´„É©„Éï„É´' : '‚ö™ „Ç∑„É≥„Éó„É´'}
                    </button>
                  </div>

                  <div className="flex items-center justify-between p-4 bg-white/10 rounded-xl">
                    <div>
                      <div className="font-bold text-white">ÊñáÂ≠ó„Çµ„Ç§„Ç∫</div>
                      <div className="text-xs text-white/60">ÊñáÂ≠ó„ÇíÂ§ß„Åç„ÅèË°®Á§∫„Åô„Çã</div>
                    </div>
                    <button
                      onClick={toggleFontSize}
                      className="px-6 py-2 rounded-lg font-bold transition-all bg-gradient-to-r from-green-500 to-emerald-500 text-white"
                    >
                      {fontSize === 'normal' ? 'A Ê®ôÊ∫ñ' : 'A+ Â§ß„Åç„ÇÅ'}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}





          <div className="max-w-5xl mx-auto px-3 py-4">
            <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
              {categories.map((cat, idx) => {
                const colors = themeColors.categories;
                const glowColors = themeColors.glowColors;
                const isActive = activeCategory === cat;

                return (
                  <button
                    key={cat}
                    onClick={() => {
                      setActiveCategory(cat);
                      setSelectedItem(null);
                      setMaterialPrices({});
                      setToolPrices({});
                      if (cat === 'Ê≠¶Âô®ÈçõÂÜ∂') setSelectedWeaponType('ÁâáÊâãÂâ£');
                      if (cat === 'Èò≤ÂÖ∑ÈçõÂÜ∂') setSelectedArmorType('Â∞èÁõæ');
                      if (cat === 'ÈÅìÂÖ∑ÈçõÂÜ∂') setSelectedToolType('Á¥†Êùê');
                      if (cat === 'Ë£ÅÁ∏´') setSelectedSewingType('„Ç¢„Çø„Éû');
                      if (cat === 'Êú®Â∑•') setSelectedWoodworkType('„Çπ„ÉÜ„Ç£„ÉÉ„ÇØ');
                      if (cat === 'ÊñôÁêÜ') setSelectedCookingType('ÊñôÁêÜÂÖ®ÈÉ®');
                    }}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.boxShadow = `0 0 40px ${glowColors[idx % glowColors.length]}, 0 0 60px ${glowColors[idx % glowColors.length]}`;
                      e.currentTarget.style.transform = 'scale(1.05)';
                    }}
                    onMouseLeave={(e) => {
                      if (isActive) {
                        e.currentTarget.style.boxShadow = `0 0 30px ${glowColors[idx % glowColors.length]}`;
                        e.currentTarget.style.transform = 'scale(1.05)';
                      } else {
                        e.currentTarget.style.boxShadow = '';
                        e.currentTarget.style.transform = 'scale(1)';
                      }
                    }}
                    className={`px-5 py-2 rounded-xl font-bold text-sm whitespace-nowrap transition-all cursor-pointer ${isActive
                      ? `bg-gradient-to-r ${colors[idx % colors.length]} text-white shadow-lg scale-105 border border-white/30`
                      : 'bg-white/10 backdrop-blur-sm text-white shadow-sm border border-white/30'
                      }`}
                    style={isActive ? { boxShadow: `0 0 30px ${glowColors[idx % glowColors.length]}` } : {}}
>
  {cat === 'Ê≠¶Âô®ÈçõÂÜ∂' && '‚öîÔ∏è Ê≠¶Âô®ÈçõÂÜ∂'}
  {cat === 'Èò≤ÂÖ∑ÈçõÂÜ∂' && 'üõ°Ô∏è Èò≤ÂÖ∑ÈçõÂÜ∂'}
  {cat === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && 'üîß ÈÅìÂÖ∑ÈçõÂÜ∂'}
  {cat === 'Ë£ÅÁ∏´' && 'üßµ Ë£ÅÁ∏´'}
  {cat === 'Êú®Â∑•' && 'ü™µ Êú®Â∑•'}
  {cat === 'ÊñôÁêÜ' && 'üç≥ ÊñôÁêÜ'}
  {cat === '„ÅäÊ∞ó„Å´ÂÖ•„Çä' && '‚≠ê „ÅäÊ∞ó„Å´ÂÖ•„Çä'}
  {cat === 'ÂèéÁõäÁÆ°ÁêÜ' && 'üí∞ ÂèéÁõäÁÆ°ÁêÜ'}
  {cat === 'Ë®≠ÂÆö' && '‚öôÔ∏è Ë®≠ÂÆö'}
</button>
                );
              })}
            </div>

            {/* „Çµ„Éñ„Ç´„ÉÜ„Ç¥„É™Ë°®Á§∫ */}
            {activeCategory === 'Ê≠¶Âô®ÈçõÂÜ∂' && (
              <div className="mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
                {weaponTypes.map((type) => (
                  <button
                    key={type}
                    onClick={() => setSelectedWeaponType(type)}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.boxShadow = '0 0 30px rgba(251, 146, 60, 0.6), 0 0 50px rgba(251, 146, 60, 0.4)';
                      e.currentTarget.style.transform = 'scale(1.05)';
                    }}
                    onMouseLeave={(e) => {
                      if (selectedWeaponType === type) {
                        e.currentTarget.style.boxShadow = '0 0 20px rgba(251, 146, 60, 0.5)';
                        e.currentTarget.style.transform = 'scale(1.05)';
                      } else {
                        e.currentTarget.style.boxShadow = '';
                        e.currentTarget.style.transform = 'scale(1)';
                      }
                    }}
                    className={`px-4 py-2 rounded-xl font-bold text-sm transition-all transform hover:scale-105 ${selectedWeaponType === type
                        ? 'bg-gradient-to-r from-orange-500 to-amber-500 text-white shadow-lg'
                        : 'bg-white/10 backdrop-blur-sm text-white/80 hover:bg-white/20'
                      }`}
                    style={selectedWeaponType === type ? { boxShadow: '0 0 20px rgba(251, 146, 60, 0.6)' } : {}}
                    style={selectedWeaponType === type ? { boxShadow: '0 0 20px rgba(251, 146, 60, 0.5)' } : {}}
                  >
                    {type}
                  </button>
                ))}
              </div>
            )}

            {activeCategory === 'Èò≤ÂÖ∑ÈçõÂÜ∂' && (
              <div className="mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
                {armorTypes.map((type) => (
                  <button
                    key={type}
                    onClick={() => setSelectedArmorType(type)}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.boxShadow = '0 0 30px rgba(168, 85, 247, 0.6), 0 0 50px rgba(168, 85, 247, 0.4)';
                      e.currentTarget.style.transform = 'scale(1.05)';
                    }}
                    onMouseLeave={(e) => {
                      if (selectedArmorType === type) {
                        e.currentTarget.style.boxShadow = '0 0 20px rgba(168, 85, 247, 0.5)';
                        e.currentTarget.style.transform = 'scale(1.05)';
                      } else {
                        e.currentTarget.style.boxShadow = '';
                        e.currentTarget.style.transform = 'scale(1)';
                      }
                    }}
                    className={`px-4 py-1.5 rounded-lg font-bold text-xs whitespace-nowrap transition-all cursor-pointer ${selectedArmorType === type
                      ? 'bg-gradient-to-r from-purple-500 to-violet-500 text-white shadow-lg border border-purple-300/50 scale-105'
                      : 'bg-white/10 backdrop-blur-sm text-white/80 border border-white/30 hover:bg-white/20'
                      }`}
                    style={selectedArmorType === type ? { boxShadow: '0 0 20px rgba(168, 85, 247, 0.5)' } : {}}
                  >
                    {type}
                  </button>
                ))}
              </div>
            )}

            {activeCategory === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && (
              <div className="mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
                {toolTypes.map((type) => (
                  <button
                    key={type}
                    onClick={() => setSelectedToolType(type)}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.boxShadow = '0 0 30px rgba(236, 72, 153, 0.6), 0 0 50px rgba(236, 72, 153, 0.4)';
                      e.currentTarget.style.transform = 'scale(1.05)';
                    }}
                    onMouseLeave={(e) => {
                      if (selectedToolType === type) {
                        e.currentTarget.style.boxShadow = '0 0 20px rgba(236, 72, 153, 0.5)';
                        e.currentTarget.style.transform = 'scale(1.05)';
                      } else {
                        e.currentTarget.style.boxShadow = '';
                        e.currentTarget.style.transform = 'scale(1)';
                      }
                    }}
                    className={`px-4 py-1.5 rounded-lg font-bold text-xs whitespace-nowrap transition-all cursor-pointer ${selectedToolType === type
                      ? 'bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow-lg border border-pink-300/50 scale-105'
                      : 'bg-white/10 backdrop-blur-sm text-white/80 border border-white/30 hover:bg-white/20'
                      }`}
                    style={selectedToolType === type ? { boxShadow: '0 0 20px rgba(236, 72, 153, 0.5)' } : {}}
                  >
                    {type}
                  </button>
                ))}
              </div>
            )}

            {activeCategory === 'Ë£ÅÁ∏´' && (
              <div className="mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
                {sewingTypes.map((type) => (
                  <button
                    key={type}
                    onClick={() => setSelectedSewingType(type)}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.boxShadow = '0 0 30px rgba(56, 189, 248, 0.6), 0 0 50px rgba(56, 189, 248, 0.4)';
                      e.currentTarget.style.transform = 'scale(1.05)';
                    }}
                    onMouseLeave={(e) => {
                      if (selectedSewingType === type) {
                        e.currentTarget.style.boxShadow = '0 0 20px rgba(56, 189, 248, 0.5)';
                        e.currentTarget.style.transform = 'scale(1.05)';
                      } else {
                        e.currentTarget.style.boxShadow = '';
                        e.currentTarget.style.transform = 'scale(1)';
                      }
                    }}
                    className={`px-4 py-1.5 rounded-lg font-bold text-xs whitespace-nowrap transition-all cursor-pointer ${selectedSewingType === type
                      ? 'bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-lg border border-cyan-300/50 scale-105'
                      : 'bg-white/10 backdrop-blur-sm text-white/80 border border-white/30 hover:bg-white/20'
                      }`}
                    style={selectedSewingType === type ? { boxShadow: '0 0 20px rgba(56, 189, 248, 0.5)' } : {}}
                  >
                    {type}
                  </button>
                ))}
              </div>
            )}

            {activeCategory === 'Êú®Â∑•' && (
              <div className="mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
                {woodworkTypes.map((type) => (
                  <button
                    key={type}
                    onClick={() => setSelectedWoodworkType(type)}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.boxShadow = '0 0 30px rgba(16, 185, 129, 0.6), 0 0 50px rgba(16, 185, 129, 0.4)';
                      e.currentTarget.style.transform = 'scale(1.05)';
                    }}
                    onMouseLeave={(e) => {
                      if (selectedWoodworkType === type) {
                        e.currentTarget.style.boxShadow = '0 0 20px rgba(16, 185, 129, 0.5)';
                        e.currentTarget.style.transform = 'scale(1.05)';
                      } else {
                        e.currentTarget.style.boxShadow = '';
                        e.currentTarget.style.transform = 'scale(1)';
                      }
                    }}
                    className={`px-4 py-1.5 rounded-lg font-bold text-xs whitespace-nowrap transition-all cursor-pointer ${selectedWoodworkType === type
                      ? 'bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg border border-emerald-300/50 scale-105'
                      : 'bg-white/10 backdrop-blur-sm text-white/80 border border-white/30 hover:bg-white/20'
                      }`}
                    style={selectedWoodworkType === type ? { boxShadow: '0 0 20px rgba(16, 185, 129, 0.5)' } : {}}
                  >
                    {type}
                  </button>
                ))}
              </div>
            )}

            {activeCategory === 'ÊñôÁêÜ' && (
              <div className="mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
                {cookingTypes.map((type) => (
                  <button
                    key={type}
                    onClick={() => setSelectedCookingType(type)}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.boxShadow = '0 0 30px rgba(99, 102, 241, 0.6), 0 0 50px rgba(99, 102, 241, 0.4)';
                      e.currentTarget.style.transform = 'scale(1.05)';
                    }}
                    onMouseLeave={(e) => {
                      if (selectedCookingType === type) {
                        e.currentTarget.style.boxShadow = '0 0 20px rgba(99, 102, 241, 0.5)';
                        e.currentTarget.style.transform = 'scale(1.05)';
                      } else {
                        e.currentTarget.style.boxShadow = '';
                        e.currentTarget.style.transform = 'scale(1)';
                      }
                    }}
                    className={`px-4 py-1.5 rounded-lg font-bold text-xs whitespace-nowrap transition-all cursor-pointer ${selectedCookingType === type
                      ? 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg border border-indigo-300/50 scale-105'
                      : 'bg-white/10 backdrop-blur-sm text-white/80 border border-white/30 hover:bg-white/20'
                      }`}
                    style={selectedCookingType === type ? { boxShadow: '0 0 20px rgba(99, 102, 241, 0.5)' } : {}}
                  >
                    {type}
                  </button>
                ))}
              </div>
            )}
          </div>

          {/* üÜï „Éî„É≥Áïô„ÇÅ„Çµ„Éû„É™„Éº */}
          {isPinned && activeCategory !== 'ÂèéÁõäÁÆ°ÁêÜ' && (
            <div className="max-w-5xl mx-auto px-3 pb-3">
              <div className="bg-gradient-to-r from-green-500/90 to-emerald-500/90 backdrop-blur-sm rounded-xl p-3 shadow-lg border border-green-300/50 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
                <div className="flex items-center gap-4">
                  <TrendingUp className="text-white" size={24} />
                  <div>
                    <div className="text-white text-xs font-bold opacity-90">
                      {profitView === 'today' ? '‰ªäÊó•„ÅÆÂèéÁõä' : '‰ªäÊúà„ÅÆÂèéÁõä'}
                    </div>
                    <div className="text-white text-xl font-black">
                      {calculateSummary(profitView).profit >= 0 ? '+' : ''}
                      {calculateSummary(profitView).profit.toLocaleString()} G
                    </div>
                  </div>
                </div>
                <button
                  onClick={togglePin}
                  className="px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-all text-white text-sm font-bold"
                >
                  üìå Ëß£Èô§
                </button>
              </div>
            </div>
          )}
          <div className="max-w-5xl mx-auto px-3 pb-6 pt-6">
            {/* üÜï ÂèéÁõäÁÆ°ÁêÜ„Ç´„ÉÜ„Ç¥„É™ */}
            {activeCategory === 'ÂèéÁõäÁÆ°ÁêÜ' ? (
              <div className="space-y-4">
                {/* ÂèéÁõä„Çµ„Éû„É™„Éº */}
                <div className="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 shadow-xl">
                  <div className="flex flex-col md:flex-row items-start md:items-center justify-between mb-4 gap-3">
                    <div className="flex items-center gap-3">
                      <TrendingUp className="text-amber-300" size={32} />
                      <h2 className="text-xl md:text-2xl font-black text-white">ÂèéÁõä„Çµ„Éû„É™„Éº</h2>
                    </div>
                    <div className="flex flex-wrap gap-2">
                      <button
                        onClick={() => setProfitView('today')}
                        className={`px-4 py-2 rounded-lg font-bold text-sm transition-all ${profitView === 'today'
                          ? 'bg-amber-500/90 text-white shadow-lg'
                          : 'bg-white/20 text-white/80'
                          }`}
                      >
                        ‰ªäÊó•
                      </button>
                      <button
                        onClick={() => setProfitView('month')}
                        className={`px-4 py-2 rounded-lg font-bold text-sm transition-all ${profitView === 'month'
                          ? 'bg-amber-500/90 text-white shadow-lg'
                          : 'bg-white/20 text-white/80'
                          }`}
                      >
                        ‰ªäÊúà
                      </button>
                      <button
                        onClick={togglePin}
                        className={`px-4 py-2 rounded-lg font-bold text-sm transition-all ${isPinned
                          ? 'bg-green-500/90 text-white shadow-lg'
                          : 'bg-white/20 text-white/80'
                          }`}
                      >
                        <Pin size={16} className="inline mr-1" />
                        {isPinned ? 'ON' : 'OFF'}
                      </button>
                    </div>
                  </div>

                  {(() => {
                    const summary = calculateSummary(profitView);
                    return (
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div className="bg-blue-500/20 backdrop-blur-sm rounded-xl p-4 border border-blue-300/30">
                          <div className="text-white/80 text-sm font-bold mb-1">Á∑èÂ£≤‰∏ä</div>
                          <div className="text-white text-2xl font-black">
                            {summary.totalIncome.toLocaleString()} G
                          </div>
                        </div>
                        <div className="bg-red-500/20 backdrop-blur-sm rounded-xl p-4 border border-red-300/30">
                          <div className="text-white/80 text-sm font-bold mb-1">Á∑è„Ç≥„Çπ„Éà</div>
                          <div className="text-white text-2xl font-black">
                            {summary.totalCost.toLocaleString()} G
                          </div>
                        </div>
                        <div className={`${summary.profit >= 0 ? 'bg-green-500/20 border-green-300/30' : 'bg-red-500/20 border-red-300/30'} backdrop-blur-sm rounded-xl p-4 border`}>
                          <div className="text-white/80 text-sm font-bold mb-1">Á¥îÂà©Áõä</div>
                          <div className={`text-3xl font-black ${summary.profit >= 0 ? 'text-green-300' : 'text-red-300'}`}>
                            {summary.profit >= 0 ? '+' : ''}{summary.profit.toLocaleString()} G
                          </div>
                        </div>
                      </div>
                    );
                  })()}

                  <div className="mt-4 text-white/60 text-sm text-center">
                    Ë®òÈå≤Êï∞: {calculateSummary(profitView).count} ‰ª∂
                  </div>
                </div>

                {/* üÜï „Éá„Éº„ÇøÁÆ°ÁêÜ„Éú„Çø„É≥ */}
                <div className="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 shadow-xl">
                  <h3 className="text-xl font-black text-white mb-4 flex items-center gap-2">
                    <span className="text-2xl">‚öôÔ∏è</span>
                    <span>„Éá„Éº„ÇøÁÆ°ÁêÜ</span>
                  </h3>

                  {/* „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Éú„Çø„É≥ */}
                  <div className="mb-6">
                    <h4 className="text-sm font-bold text-white/80 mb-3">üíæ „Ç®„ÇØ„Çπ„Éù„Éº„ÉàÔºà„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÔºâ</h4>
                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-2">
                      <button
                        onClick={() => exportToCSV('today')}
                        className="px-4 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white rounded-lg font-bold text-sm transition-all transform hover:scale-105"
                      >
                        üìÖ ‰ªäÊó•„ÅÆ„Éá„Éº„Çø
                      </button>
                      <button
                        onClick={() => exportToCSV('month')}
                        className="px-4 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white rounded-lg font-bold text-sm transition-all transform hover:scale-105"
                      >
                        üìÜ ‰ªäÊúà„ÅÆ„Éá„Éº„Çø
                      </button>
                      <button
                        onClick={() => exportToCSV('all')}
                        className="px-4 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white rounded-lg font-bold text-sm transition-all transform hover:scale-105"
                      >
                        üìä „Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø
                      </button>
                    </div>
                  </div>

                  {/* „Ç§„É≥„Éù„Éº„Éà„Éú„Çø„É≥ */}
                  <div className="mb-6">
                    <h4 className="text-sm font-bold text-white/80 mb-3">üì• „Ç§„É≥„Éù„Éº„ÉàÔºàÂæ©ÂÖÉÔºâ</h4>
                    <label className="block">
                      <input
                        type="file"
                        accept=".csv"
                        onChange={importFromCSV}
                        className="hidden"
                        id="csv-import"
                      />
                      <div className="px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white rounded-lg font-bold text-sm transition-all transform hover:scale-105 cursor-pointer text-center">
                        üìÇ CSV„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû
                      </div>
                    </label>
                  </div>

                  {/* ‰∏ÄÊã¨ÂâäÈô§„Éú„Çø„É≥ */}
                  <div>
                    <h4 className="text-sm font-bold text-white/80 mb-3">üóëÔ∏è ‰∏ÄÊã¨ÂâäÈô§</h4>
                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-2">
                      <button
                        onClick={() => bulkDelete('today')}
                        className="px-4 py-3 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white rounded-lg font-bold text-sm transition-all transform hover:scale-105"
                      >
                        üî• ‰ªäÊó•„ÅÆ„Éá„Éº„Çø
                      </button>
                      <button
                        onClick={() => bulkDelete('month')}
                        className="px-4 py-3 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white rounded-lg font-bold text-sm transition-all transform hover:scale-105"
                      >
                        üî• ‰ªäÊúà„ÅÆ„Éá„Éº„Çø
                      </button>
                      <button
                        onClick={() => bulkDelete('all')}
                        className="px-4 py-3 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white rounded-lg font-bold text-sm transition-all transform hover:scale-105"
                      >
                        ‚ö†Ô∏è „Åô„Åπ„Å¶ÂâäÈô§
                      </button>
                    </div>
                    <p className="text-xs text-white/50 mt-2 text-center">
                      ‚Äª ÂâäÈô§Ââç„Å´„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åß„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÇíÂèñ„Çã„Åì„Å®„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô
                    </p>
                  </div>
                </div>

                {/* ‰øùÂ≠ò„Åï„Çå„ÅüË®òÈå≤‰∏ÄË¶ß */}
                <div className="space-y-3">
                  {savedRecords.map((record) => (
                    <div
                      key={record.id}
                      className="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20 shadow-lg"
                    >
                      <div className="flex flex-col sm:flex-row items-start justify-between gap-3">
                        <div className="flex-1 w-full">
                          <div className="flex items-center gap-2 mb-2">
                            <span className="text-xs font-bold bg-amber-500/80 text-white px-2 py-0.5 rounded-full">
                              {record.category}
                            </span>
                            <span className="text-white font-bold">{record.itemName}</span>
                            <span className="text-white/60 text-xs">
                              √ó{record.quantity}Âõû
                            </span>
                          </div>

                          <div className="text-white/80 text-sm mb-2">
                            {new Date(record.timestamp).toLocaleString('ja-JP', {
                              month: '2-digit',
                              day: '2-digit',
                              hour: '2-digit',
                              minute: '2-digit'
                            })}
                          </div>

                          <div className="grid grid-cols-1 sm:grid-cols-3 gap-2 text-sm">
                            <div>
                              <span className="text-white/60">Â£≤‰∏ä: </span>
                              <span className="text-blue-300 font-bold">
                                {record.totalIncome.toLocaleString()}G
                              </span>
                            </div>
                            <div>
                              <span className="text-white/60">„Ç≥„Çπ„Éà: </span>
                              <span className="text-red-300 font-bold">
                                {record.totalCost.toLocaleString()}G
                              </span>
                            </div>
                            <div>
                              <span className="text-white/60">Âà©Áõä: </span>
                              <span className={`font-black ${record.profit >= 0 ? 'text-green-300' : 'text-red-300'}`}>
                                {record.profit >= 0 ? '+' : ''}{record.profit.toLocaleString()}G
                              </span>
                            </div>
                          </div>
                        </div>

                        <button
                          onClick={() => deleteRecord(record.id)}
                          className="w-full sm:w-auto sm:ml-4 px-3 py-1.5 bg-red-500/80 hover:bg-red-600/80 text-white rounded-lg text-xs font-bold transition-all"
                        >
                          ÂâäÈô§
                        </button>
                      </div>
                    </div>
                  ))}

                  {savedRecords.length === 0 && (
                    <div className="text-center py-12">
                      <div className="text-4xl mb-3">üìä</div>
                      <p className="text-lg font-bold text-white/60">„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                      <p className="text-white/40 mt-1 text-sm">ÊàêÊûú„Çí‰øùÂ≠ò„Åô„Çã„Å®„ÄÅ„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</p>
                    </div>
                  )}
                </div>
              </div>
            ) : filteredItems.length === 0 ? (
              <div className="text-center py-12">
                <div className="text-4xl mb-3">üîç</div>
                <p className="text-lg font-bold text-white/60">Ë©≤ÂΩì„Åô„Çã„Ç¢„Ç§„ÉÜ„É†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</p>
                <p className="text-white/40 mt-1 text-sm">Âà•„ÅÆ„Ç≠„Éº„ÉØ„Éº„Éâ„ÅßÊ§úÁ¥¢„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ</p>
              </div>
            ) : (
              <div className="grid gap-12">
                {filteredItems.map((item, index) => {
                  const isSelected = selectedItem === item.name;
                  return (
                    <div
                      key={index}
                      onClick={() => {
                        setSelectedItem(isSelected ? null : item.name);
                      }}
                      style={{
                        transition: 'all 0.3s ease',
                        boxShadow: isSelected ? '0 0 40px rgba(56, 189, 248, 0.6)' : '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                        transform: isSelected ? 'scale(1.02)' : 'scale(1)',
                        outline: isSelected ? '2px solid rgb(56, 189, 248)' : 'none'
                      }}
                      onMouseEnter={(e) => {
                        e.currentTarget.style.boxShadow = '0 0 40px rgba(56, 189, 248, 0.6)';
                        e.currentTarget.style.transform = 'scale(1.02)';
                        e.currentTarget.style.outline = '2px solid rgb(56, 189, 248)';
                      }}
                      onMouseLeave={(e) => {
                        if (!isSelected) {
                          e.currentTarget.style.boxShadow = '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)';
                          e.currentTarget.style.transform = 'scale(1)';
                          e.currentTarget.style.outline = 'none';
                        } else {
                          e.currentTarget.style.boxShadow = '0 0 40px rgba(56, 189, 248, 0.6)';
                          e.currentTarget.style.transform = 'scale(1.02)';
                          e.currentTarget.style.outline = '2px solid rgb(56, 189, 248)';
                        }
                      }}
                      className="bg-white/10 backdrop-blur-md rounded-2xl overflow-hidden cursor-pointer relative border border-white/20 shadow-xl"
                    >
                      <div className="bg-gradient-to-r from-cyan-500/80 via-purple-500/80 to-pink-500/80 backdrop-blur-sm p-4 text-white relative overflow-hidden border-b border-white/30" style={{ boxShadow: '0 0 30px rgba(56, 189, 248, 0.4), 0 0 50px rgba(168, 85, 247, 0.3)' }}>
                        <div className="absolute top-0 right-0 w-24 h-24 bg-white/10 rounded-full -mr-12 -mt-12"></div>
                        <div className="absolute bottom-0 left-0 w-20 h-20 bg-white/10 rounded-full -ml-10 -mb-10"></div>
                        <div className="relative flex items-center justify-between">
                          <div>
                            <span className="text-xs font-bold bg-white/30 px-3 py-0.5 rounded-full backdrop-blur-sm">{item.category}</span>
                            <div className="flex items-center gap-2 mt-2">
                              <h2 className="text-2xl font-black drop-shadow-lg" style={{ textShadow: '0 0 20px rgba(255, 255, 255, 0.5)' }}>{item.name}</h2>
                              {item.specialTrait && (
                                <span className="px-3 py-1 bg-yellow-400 text-yellow-900 rounded-full text-xs font-bold shadow-md">
                                  {item.specialTrait}
                                </span>
                              )}
                              <button
                                onClick={(e) => {
                                  e.stopPropagation();
                                  openRecipeWindow(item);
                                }}
                                className="hidden md:block ml-2 px-3 py-1 bg-white/20 hover:bg-white/30 rounded-lg font-bold text-xs transition-all backdrop-blur-sm border border-white/30 transform hover:scale-105"
                                style={{ boxShadow: '0 0 10px rgba(255, 255, 255, 0.2)' }}
                              >
                                üìã „É¨„Ç∑„Éî
                              </button>
                              <button
                                onClick={(e) => {
                                  e.stopPropagation();
                                  toggleFavorite(item);
                                }}
                                className={`ml-2 px-3 py-1 rounded-lg font-bold text-xs transition-all backdrop-blur-sm border transform hover:scale-105 ${isFavorite(item)
                                  ? 'bg-yellow-500/90 text-white border-yellow-400/50 shadow-lg'
                                  : 'bg-white/20 hover:bg-white/30 text-white border-white/30'
                                  }`}
                                style={isFavorite(item) ? { boxShadow: '0 0 15px rgba(234, 179, 8, 0.6)' } : { boxShadow: '0 0 10px rgba(255, 255, 255, 0.2)' }}
                              >
                                {isFavorite(item) ? '‚≠ê „ÅäÊ∞ó„Å´ÂÖ•„Çä' : '‚òÜ „ÅäÊ∞ó„Å´ÂÖ•„Çä'}
                              </button>
                            </div>
                          </div>
                          {item.category === 'ÊñôÁêÜ' ? (
                            <UtensilsCrossed size={32} className="opacity-90 drop-shadow-lg" />
                          ) : (
                            <Package size={32} className="opacity-90 drop-shadow-lg" />
                          )}
                        </div>
                      </div>

                      <div className="p-4">
                        <h3 className="text-sm font-black text-white drop-shadow-lg mb-3 flex items-center gap-2" style={{ textShadow: '0 0 20px rgba(56, 189, 248, 0.6)' }}>
                          <span className="text-xl">üéØ</span>
                          <span>ÁõÆÊ®ôÊï∞ÂÄ§</span>
                        </h3>
                        {renderTargetValues(item)}
                      </div>

                      <div className="px-4 pb-4">
                        <h3 className="text-sm font-black text-white drop-shadow-lg mb-3 flex items-center gap-2" style={{ textShadow: '0 0 20px rgba(168, 85, 247, 0.6)' }}>
                          <span className="text-xl">üì¶</span>
                          <span>ÂøÖË¶ÅÁ¥†Êùê</span>
                        </h3>
                        <div className="space-y-2">
                          {item.materials.map((material, idx) => (
                            <div
                              key={idx}
                              className="p-4 bg-white/10 backdrop-blur-md rounded-xl border border-white/30"
                              style={{ boxShadow: '0 0 20px rgba(168, 85, 247, 0.2)' }}
                            >
                              <div className="flex items-center justify-between">
                                <div className="flex items-center gap-2">
                                  <span className="font-bold text-white text-sm drop-shadow">{material.name}</span>
                                  <span
                                    className="px-2.5 py-0.5 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-full font-black shadow-md text-xs"
                                    style={{ boxShadow: '0 0 15px rgba(236, 72, 153, 0.5)' }}
                                  >
                                    √ó{material.quantity}
                                  </span>
                                </div>
                                {isSelected && (
                                  <div className="flex items-center gap-1.5">
                                    <input
                                      type="text"
                                      inputMode="numeric"
                                      placeholder="Âçò‰æ°"
                                      value={formatNumber(materialPrices[`${item.name}-${material.name}`] || '')}
                                      onClick={(e) => e.stopPropagation()}
                                      onChange={(e) => {
                                        const value = e.target.value.replace(/[^0-9]/g, '');
                                        updatePrice(item.name, material.name, value);
                                      }}
                                      className="w-24 px-3 py-2 rounded-lg border-2 border-purple-400/50 bg-white/10 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400 font-bold text-right text-base text-white placeholder-white/50"
                                      style={{ boxShadow: '0 0 15px rgba(168, 85, 247, 0.3)' }}
                                    />
                                    <span className="text-white/80 font-bold text-sm drop-shadow">G</span>
                                  </div>
                                )}
                              </div>
                            </div>
                          ))}
                        </div>

                        {isSelected && (
                          <div className="mt-3 p-4 bg-white/10 backdrop-blur-md rounded-xl border border-white/30" style={{ boxShadow: '0 0 20px rgba(168, 85, 247, 0.3)' }}>
                            <div className="flex items-center justify-between">
                              <div className="flex items-center gap-2">
                                <span className="font-bold text-white text-sm drop-shadow">üîß ËÅ∑‰∫∫ÈÅìÂÖ∑‰ª£</span>
                                <span className="text-xs text-white/60">(Ëá™Âãï„Åß√∑30)</span>
                              </div>
                              <div className="flex items-center gap-2">
                                <input
                                  type="text"
                                  inputMode="numeric"
                                  placeholder="ÈÅìÂÖ∑‰ª£"
                                  value={formatNumber(toolPrices[item.name] || '')}
                                  onClick={(e) => e.stopPropagation()}
                                  onChange={(e) => {
                                    const value = e.target.value.replace(/[^0-9]/g, '');
                                    setToolPrices(prev => ({
                                      ...prev,
                                      [item.name]: value === '' ? 0 : parseInt(value) || 0
                                    }));
                                  }}
                                  className="w-28 px-3 py-2 rounded-lg border-2 border-purple-400/50 bg-white/10 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400 font-bold text-right text-base text-white placeholder-white/50"
                                  style={{ boxShadow: '0 0 15px rgba(168, 85, 247, 0.3)' }}
                                />
                                <span className="text-white/80 font-bold text-sm drop-shadow">G</span>
                              </div>
                            </div>
                            {toolPrices[item.name] > 0 && (
                              <div className="mt-2 text-right text-xs text-white/60">
                                <span className="font-bold">1Âõû„ÅÇ„Åü„Çä: {Math.floor(toolPrices[item.name] / 30).toLocaleString()} G</span>
                              </div>
                            )}
                          </div>
                        )}
                        {isSelected && (
                          <div className="mt-3 p-4 bg-white/10 backdrop-blur-md rounded-xl border border-white/30" style={{ boxShadow: '0 0 20px rgba(56, 189, 248, 0.3)' }}>
                            <div className="flex items-center justify-between mb-3">
                              <span className="font-bold text-white text-sm flex items-center gap-2 drop-shadow">
                                <span className="text-xl">üî¢</span>
                                <span>‰ΩúÊàêÂõûÊï∞</span>
                              </span>
                              <div className="flex items-center gap-2">
                                <input
                                  type="text"
                                  inputMode="numeric"
                                  placeholder="ÂõûÊï∞"
                                  value={craftQuantity[item.name] || 1}
                                  onClick={(e) => e.stopPropagation()}
                                  onFocus={(e) => {
                                    if ((craftQuantity[item.name] || 1) === 1) {
                                      e.target.value = '';
                                    }
                                  }}
                                  onBlur={(e) => {
                                    if (e.target.value === '') {
                                      setCraftQuantity(prev => ({
                                        ...prev,
                                        [item.name]: 1
                                      }));
                                    }
                                  }}
                                  onChange={(e) => {
                                    const value = e.target.value.replace(/[^0-9]/g, '');
                                    setCraftQuantity(prev => ({
                                      ...prev,
                                      [item.name]: value === '' ? '' : parseInt(value) || 1
                                    }));
                                  }}
                                  className="w-20 px-3 py-2 rounded-lg border-2 border-cyan-400/50 bg-white/10 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 font-bold text-right text-base text-white placeholder-white/50"
                                  style={{ boxShadow: '0 0 15px rgba(56, 189, 248, 0.3)' }}
                                />
                                <span className="text-white/80 font-bold text-sm drop-shadow">Âõû</span>
                              </div>
                            </div>
                            <div className="flex gap-2">
                              {[1, 5, 10, 30].map((num) => (
                                <button
                                  key={num}
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    setCraftQuantity(prev => ({
                                      ...prev,
                                      [item.name]: num
                                    }));
                                  }}
                                  className={`flex-1 px-3 py-2 rounded-lg font-bold text-sm transition-all transform hover:scale-105 cursor-pointer ${(craftQuantity[item.name] || 1) === num
                                    ? 'bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-lg border border-cyan-300/50'
                                    : 'bg-white/10 backdrop-blur-sm text-white border border-white/30 hover:bg-white/20'
                                    }`}
                                  style={(craftQuantity[item.name] || 1) === num ? { boxShadow: '0 0 20px rgba(56, 189, 248, 0.5)' } : {}}
                                >
                                  √ó{num}
                                </button>
                              ))}
                            </div>
                          </div>
                        )}

                        {isSelected && (
                          <div className="mt-3 p-4 bg-gradient-to-br from-pink-500/80 via-rose-500/80 to-fuchsia-500/80 backdrop-blur-sm rounded-xl border border-pink-300/50" style={{ boxShadow: '0 0 30px rgba(236, 72, 153, 0.6), 0 0 50px rgba(236, 72, 153, 0.3)' }}>
                            <div className="flex items-center justify-between text-white">
                              <span className="text-lg font-black drop-shadow" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>Total Cost:</span>
                              <div className="flex items-center gap-3">
                                <span className="text-2xl font-black drop-shadow" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.3)' }}>{calculateTotal(item).toLocaleString()} G</span>
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    const newMaterialPrices = { ...materialPrices };
                                    item.materials.forEach(material => {
                                      delete newMaterialPrices[`${item.name}-${material.name}`];
                                    });
                                    setMaterialPrices(newMaterialPrices);

                                    const newToolPrices = { ...toolPrices };
                                    delete newToolPrices[item.name];
                                    setToolPrices(newToolPrices);

                                    const newCraftQuantity = { ...craftQuantity };
                                    delete newCraftQuantity[item.name];
                                    setCraftQuantity(newCraftQuantity);

                                    const newSellPrices = { ...sellPrices };
                                    delete newSellPrices[item.name];
                                    setSellPrices(newSellPrices);

                                    const newCraftResults = { ...craftResults };
                                    delete newCraftResults[item.name];
                                    setCraftResults(newCraftResults);

                                    const newBazaarMode = { ...bazaarMode };
                                    delete newBazaarMode[item.name];
                                    setBazaarMode(newBazaarMode);
                                  }}
                                  className="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg font-bold text-sm transition-all backdrop-blur-sm border border-white/30 transform hover:scale-105 cursor-pointer"
                                  style={{ boxShadow: '0 0 10px rgba(255, 255, 255, 0.2)' }}
                                >
                                  „ÇØ„É™„Ç¢
                                </button>
                              </div>
                            </div>
                          </div>
                        )}

                        {isSelected && (
                          <div className="mt-3 p-4 bg-white/10 backdrop-blur-md rounded-xl border border-white/30" style={{ boxShadow: '0 0 20px rgba(251, 191, 36, 0.3)' }}>
                            <div className="flex items-center justify-between mb-3">
                              <h4 className="text-sm font-black text-white flex items-center gap-2 drop-shadow" style={{ textShadow: '0 0 20px rgba(251, 191, 36, 0.6)' }}>
                                <span className="text-xl">üí∞</span>
                                <span>Â£≤Âç¥‰∫àÂÆöÈ°ç</span>
                              </h4>
                              <div className="flex gap-1 bg-white/10 backdrop-blur-sm rounded-lg p-1 shadow-sm border border-white/20">
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    setBazaarMode(prev => ({ ...prev, [item.name]: true }));
                                  }}
                                  className={`px-3 py-1 rounded-md text-xs font-bold transition-all ${(bazaarMode[item.name] ?? true)
                                    ? 'bg-gradient-to-r from-amber-500 to-yellow-500 text-white shadow-md'
                                    : 'text-white/80 hover:bg-white/20'
                                    }`}
                                  style={(bazaarMode[item.name] ?? true) ? { boxShadow: '0 0 15px rgba(251, 191, 36, 0.5)' } : {}}
                                >
                                  „Éê„Ç∂„Éº
                                </button>
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    setBazaarMode(prev => ({ ...prev, [item.name]: false }));
                                  }}
                                  className={`px-3 py-1 rounded-md text-xs font-bold transition-all ${(bazaarMode[item.name] ?? true) === false
                                    ? 'bg-gradient-to-r from-amber-500 to-yellow-500 text-white shadow-md'
                                    : 'text-white/80 hover:bg-white/20'
                                    }`}
                                  style={(bazaarMode[item.name] ?? true) === false ? { boxShadow: '0 0 15px rgba(251, 191, 36, 0.5)' } : {}}
                                >
                                  „É¢„Éº„É¢„É≥
                                </button>
                              </div>
                            </div>

                            {item.category === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && item.subCategory === 'Á¥†Êùê' ? (
                              <div className="flex flex-col">
                                <label className="text-xs font-bold text-white/80 mb-1 drop-shadow">Á¥†Êùê„ÅÆÂçò‰æ°</label>
                                <div className="flex items-center gap-1">
                                  <input
                                    type="text"
                                    inputMode="numeric"
                                    placeholder="0"
                                    value={formatNumber(sellPrices[item.name]?.unitPrice || '')}
                                    onClick={(e) => e.stopPropagation()}
                                    onChange={(e) => {
                                      const value = e.target.value.replace(/[^0-9]/g, '');
                                      setSellPrices(prev => ({
                                        ...prev,
                                        [item.name]: {
                                          ...prev[item.name],
                                          unitPrice: value === '' ? 0 : parseInt(value) || 0
                                        }
                                      }));
                                    }}
                                    className="flex-1 px-3 py-2 rounded-lg border-2 border-yellow-400/50 bg-white/10 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 font-bold text-right text-base text-white placeholder-white/50"
                                    style={{ boxShadow: '0 0 15px rgba(251, 191, 36, 0.3)' }}
                                  />
                                  <span className="text-white/80 font-bold text-sm drop-shadow">G</span>
                                </div>
                                {sellPrices[item.name]?.unitPrice > 0 && (
                                  <span className="text-xs text-white/60 mt-0.5 text-right">
                                    {(bazaarMode[item.name] ?? true)
                                      ? `ÊâãÂèñ„Çä: ${Math.floor(sellPrices[item.name].unitPrice * 0.95).toLocaleString()}G`
                                      : `ÊâãÂèñ„Çä: ${sellPrices[item.name].unitPrice.toLocaleString()}G`
                                    }
                                  </span>
                                )}
                              </div>
                            ) : (
                              <div className="grid grid-cols-1 gap-2">
                                {[
                                  { key: 'star3', label: '‚òÜ‚òÜ‚òÜ', color: 'yellow' },
                                  { key: 'star2', label: '‚òÜ‚òÜ', color: 'gray' },
                                  { key: 'star1', label: '‚òÜ', color: 'orange' },
                                  { key: 'star0', label: '‚òÜ„Å™„Åó', color: 'gray' }
                                ].map(({ key, label }) => (
                                  <div key={key} className="flex flex-col">
                                    <label className="text-xs font-bold text-white/80 mb-1 drop-shadow">{label}</label>
                                    <div className="flex items-center gap-1">
                                      <input
                                        type="text"
                                        inputMode="numeric"
                                        placeholder="0"
                                        value={formatNumber(sellPrices[item.name]?.[key] || '')}
                                        onClick={(e) => e.stopPropagation()}
                                        onChange={(e) => {
                                          const value = e.target.value.replace(/[^0-9]/g, '');
                                          setSellPrices(prev => ({
                                            ...prev,
                                            [item.name]: {
                                              ...prev[item.name],
                                              [key]: value === '' ? 0 : parseInt(value) || 0
                                            }
                                          }));
                                        }}
                                        className="flex-1 px-3 py-2 rounded-lg border-2 border-yellow-400/50 bg-white/10 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 font-bold text-right text-base text-white placeholder-white/50"
                                        style={{ boxShadow: '0 0 15px rgba(251, 191, 36, 0.3)' }}
                                      />
                                      <span className="text-white/80 font-bold text-sm drop-shadow">G</span>
                                    </div>
                                    {sellPrices[item.name]?.[key] > 0 && (
                                      <span className="text-xs text-white/60 mt-0.5 text-right">
                                        {(bazaarMode[item.name] ?? true)
                                          ? `ÊâãÂèñ„Çä: ${Math.floor(sellPrices[item.name][key] * 0.95).toLocaleString()}G`
                                          : `ÊâãÂèñ„Çä: ${sellPrices[item.name][key].toLocaleString()}G`
                                        }
                                      </span>
                                    )}
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        )}

                        {(() => {
                          const prices = sellPrices[item.name] || {};
                          const isMaterial = item.category === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && item.subCategory === 'Á¥†Êùê';
                          const hasAnyPrice = isMaterial
                            ? prices.unitPrice
                            : (prices.star3 || prices.star2 || prices.star1 || prices.star0);

                          if (!hasAnyPrice) return null;

                          const totalCost = calculateTotal(item);
                          const quantity = craftQuantity[item.name] || 1;
                          const feeRate = (bazaarMode[item.name] ?? true) ? 0.95 : 1.0;

                          if (isMaterial) {
                            const unitPrice = Math.floor((prices.unitPrice || 0) * feeRate);
                            const worstIncome = quantity * 3 * unitPrice;
                            const needStar3 = Math.ceil((totalCost - worstIncome) / Math.max((10 - 3) * unitPrice, 1));
                            const actualNeedStar3 = Math.max(0, Math.min(needStar3, quantity));
                            const needPercentage = ((actualNeedStar3 / quantity) * 100).toFixed(1);
                            const bestIncome = quantity * 10 * unitPrice;
                            const isDefiniteLoss = bestIncome < totalCost;

                            return (
                              <div className="mt-3 p-3 bg-white/10 backdrop-blur-md rounded-lg border border-white/30" style={{ boxShadow: '0 0 20px rgba(251, 146, 60, 0.3)' }}>
                                <div className="text-xs font-bold text-white mb-2 flex items-center gap-2 drop-shadow" style={{ textShadow: '0 0 15px rgba(251, 146, 60, 0.6)' }}>
                                  <span className="text-lg">üìä</span>
                                  <span>ÈªíÂ≠ó„É©„Ç§„É≥Ôºà‚òÜ‚òÜ‚òÜ ÂøÖË¶ÅÊï∞Ôºâ</span>
                                </div>
                                {isDefiniteLoss ? (
                                  <div className="text-sm text-red-400 font-bold drop-shadow">
                                    ‚ö†Ô∏è „Åì„ÅÆ‰æ°Ê†º„Åß„ÅØÂÖ®„Å¶‚òÜ‚òÜ‚òÜ„Åß„ÇÇËµ§Â≠óÁ¢∫ÂÆö„Åß„Åô
                                  </div>
                                ) : (
                                  <div className="text-sm">
                                    <div className="flex items-center justify-between">
                                      <span className="text-white/80 drop-shadow">ÊúÄ‰Ωé</span>
                                      <span className={`font-black drop-shadow ${actualNeedStar3 > quantity ? 'text-red-400' : 'text-green-400'}`}>
                                        {actualNeedStar3} Âõû / {quantity} Âõû
                                      </span>
                                    </div>
                                    <div className="flex items-center justify-between mt-1">
                                      <span className="text-white/80 drop-shadow">ÊàêÂäüÁéá</span>
                                      <span className={`font-black drop-shadow ${parseFloat(needPercentage) > 100 ? 'text-red-400' : 'text-green-400'}`}>
                                        {needPercentage}% ‰ª•‰∏ä
                                      </span>
                                    </div>
                                    <div className="mt-2 text-xs text-white/50">
                                      ‚Äª ‚òÜ‚òÜ‚òÜ‰ª•Â§ñ„ÅØÂÖ®„Å¶‚òÜ‚òÜÔºà3ÂÄãÔºâ„Å®‰ªÆÂÆö
                                    </div>
                                  </div>
                                )}
                              </div>
                            );
                          }

                          const income3 = Math.floor((prices.star3 || 0) * feeRate);
                          const income2 = Math.floor((prices.star2 || 0) * feeRate);
                          const income1 = Math.floor((prices.star1 || 0) * feeRate);
                          const income0 = Math.floor((prices.star0 || 0) * feeRate);
                          const worstIncome = income0 * quantity;
                          const needStar3 = Math.ceil((totalCost - worstIncome) / Math.max(income3 - income0, 1));
                          const actualNeedStar3 = Math.max(0, Math.min(needStar3, quantity));
                          const needPercentage = ((actualNeedStar3 / quantity) * 100).toFixed(1);
                          const bestIncome = income3 * quantity;
                          const isDefiniteLoss = bestIncome < totalCost;

                          return (
                            <div className="mt-3 p-3 bg-white/10 backdrop-blur-md rounded-lg border border-white/30" style={{ boxShadow: '0 0 20px rgba(251, 146, 60, 0.3)' }}>
                              <div className="text-xs font-bold text-white mb-2 flex items-center gap-2 drop-shadow" style={{ textShadow: '0 0 15px rgba(251, 146, 60, 0.6)' }}>
                                <span className="text-lg">üìä</span>
                                <span>ÈªíÂ≠ó„É©„Ç§„É≥Ôºà‚òÜ‚òÜ‚òÜ ÂøÖË¶ÅÊï∞Ôºâ</span>
                              </div>
                              {isDefiniteLoss ? (
                                <div className="text-sm text-red-400 font-bold drop-shadow">
                                  ‚ö†Ô∏è „Åì„ÅÆ‰æ°Ê†º„Åß„ÅØÂÖ®„Å¶‚òÜ‚òÜ‚òÜ„Åß„ÇÇËµ§Â≠óÁ¢∫ÂÆö„Åß„Åô
                                </div>
                              ) : (
                                <div className="text-sm">
                                  <div className="flex items-center justify-between">
                                    <span className="text-white/80 drop-shadow">ÊúÄ‰Ωé</span>
                                    <span className={`font-black drop-shadow ${actualNeedStar3 > quantity ? 'text-red-400' : 'text-green-400'}`}>
                                      {actualNeedStar3} ÂÄã / {quantity} Âõû
                                    </span>
                                  </div>
                                  <div className="flex items-center justify-between mt-1">
                                    <span className="text-white/80 drop-shadow">ÊàêÂäüÁéá</span>
                                    <span className={`font-black drop-shadow ${parseFloat(needPercentage) > 100 ? 'text-red-400' : 'text-green-400'}`}>
                                      {needPercentage}% ‰ª•‰∏ä
                                    </span>
                                  </div>
                                  <div className="mt-2 text-xs text-white/50">
                                    ‚Äª ‚òÜ‚òÜ‚òÜ‰ª•Â§ñ„ÅØÂÖ®„Å¶‚òÜ„Å™„Åó„Å®‰ªÆÂÆö
                                  </div>
                                </div>
                              )}
                            </div>
                          );
                        })()}

                        {isSelected && (
                          <div className="mt-3 p-4 bg-white/10 backdrop-blur-md rounded-xl border border-white/30" style={{ boxShadow: '0 0 20px rgba(16, 185, 129, 0.3)' }}>
                            <div className="flex items-center justify-between mb-3">
                              <h4 className="text-sm font-black text-white flex items-center gap-2 drop-shadow" style={{ textShadow: '0 0 20px rgba(16, 185, 129, 0.6)' }}>
                                <span className="text-xl">üìù</span>
                                <span>ÊàêÊûúË®òÈå≤</span>
                              </h4>

                              {item.category === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && item.subCategory === 'Á¥†Êùê' && (
                                <div className="flex gap-1 bg-white/10 backdrop-blur-sm rounded-lg p-1 shadow-sm border border-white/20">
                                  <button
                                    onClick={(e) => {
                                      e.stopPropagation();
                                      setCraftResults(prev => ({
                                        ...prev,
                                        [`${item.name}_mode`]: 'simple'
                                      }));
                                    }}
                                    className={`px-3 py-1 rounded-md text-xs font-bold transition-all ${(craftResults[`${item.name}_mode`] || 'simple') === 'simple'
                                      ? 'bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-md'
                                      : 'text-white/80 hover:bg-white/20'
                                      }`}
                                    style={(craftResults[`${item.name}_mode`] || 'simple') === 'simple' ? { boxShadow: '0 0 15px rgba(16, 185, 129, 0.5)' } : {}}
                                  >
                                    ÂÄãÊï∞ÂÖ•Âäõ
                                  </button>
                                  <button
                                    onClick={(e) => {
                                      e.stopPropagation();
                                      setCraftResults(prev => ({
                                        ...prev,
                                        [`${item.name}_mode`]: 'detail'
                                      }));
                                    }}
                                    className={`px-3 py-1 rounded-md text-xs font-bold transition-all ${(craftResults[`${item.name}_mode`] || 'simple') === 'detail'
                                      ? 'bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-md'
                                      : 'text-white/80 hover:bg-white/20'
                                      }`}
                                    style={(craftResults[`${item.name}_mode`] || 'simple') === 'detail' ? { boxShadow: '0 0 15px rgba(16, 185, 129, 0.5)' } : {}}
                                  >
                                    Ë©≥Á¥∞ÂÖ•Âäõ
                                  </button>
                                </div>
                              )}
                            </div>

                            {item.category === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && item.subCategory === 'Á¥†Êùê' && (craftResults[`${item.name}_mode`] || 'simple') === 'simple' ? (
                              <div className="flex flex-col">
                                <label className="text-xs font-bold text-white/80 mb-1 drop-shadow">‰ΩúÊàê„Åß„Åç„ÅüÂÄãÊï∞</label>
                                <div className="flex items-center gap-1">
                                  <input
                                    type="text"
                                    inputMode="numeric"
                                    placeholder="0"
                                    value={craftResults[item.name]?.totalItems || ''}
                                    onClick={(e) => e.stopPropagation()}
                                    onChange={(e) => {
                                      const value = e.target.value.replace(/[^0-9]/g, '');
                                      setCraftResults(prev => ({
                                        ...prev,
                                        [item.name]: {
                                          ...prev[item.name],
                                          totalItems: value === '' ? 0 : parseInt(value) || 0
                                        }
                                      }));
                                    }}
                                    className="flex-1 px-3 py-2 rounded-lg border-2 border-emerald-400/50 bg-white/10 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-emerald-400 font-bold text-right text-base text-white placeholder-white/50"
                                    style={{ boxShadow: '0 0 15px rgba(16, 185, 129, 0.3)' }}
                                  />
                                  <span className="text-white/80 font-bold text-sm drop-shadow">ÂÄã</span>
                                </div>
                              </div>
                            ) : (
                              <>
                                <div className="grid grid-cols-1 gap-2">
                                  {[
                                    { key: 'star3', label: item.category === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && item.subCategory === 'Á¥†Êùê' ? '‚òÜ‚òÜ‚òÜ(10ÂÄã)' : '‚òÜ‚òÜ‚òÜ' },
                                    { key: 'star2', label: item.category === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && item.subCategory === 'Á¥†Êùê' ? '‚òÜ‚òÜ(3ÂÄã)' : '‚òÜ‚òÜ' },
                                    { key: 'star1', label: item.category === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && item.subCategory === 'Á¥†Êùê' ? '‚òÜ(2ÂÄã)' : '‚òÜ' },
                                    { key: 'star0', label: item.category === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && item.subCategory === 'Á¥†Êùê' ? '‚òÜ„Å™„Åó(1ÂÄã)' : '‚òÜ„Å™„Åó' },
                                    { key: 'fail', label: item.category === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && item.subCategory === 'Á¥†Êùê' ? 'Â§±Êïó(0ÂÄã)' : 'Â§±Êïó' }
                                  ].map(({ key, label }) => (
                                    <div key={key} className="flex flex-col">
                                      <label className="text-xs font-bold text-white/80 mb-1 drop-shadow">{label}</label>
                                      <div className="flex items-center gap-1">
                                        <input
                                          type="text"
                                          inputMode="numeric"
                                          placeholder="0"
                                          value={craftResults[item.name]?.[key] || ''}
                                          onClick={(e) => e.stopPropagation()}
                                          onChange={(e) => {
                                            const value = e.target.value.replace(/[^0-9]/g, '');
                                            setCraftResults(prev => ({
                                              ...prev,
                                              [item.name]: {
                                                ...prev[item.name],
                                                [key]: value === '' ? 0 : parseInt(value) || 0
                                              }
                                            }));
                                          }}
                                          className="flex-1 px-2 py-1.5 rounded-lg border-2 border-emerald-400/50 bg-white/10 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-emerald-400 font-bold text-right text-sm text-white placeholder-white/50"
                                          style={{ boxShadow: '0 0 15px rgba(16, 185, 129, 0.3)' }}
                                        />
                                        <span className="text-white/80 font-bold text-xs drop-shadow">Âõû</span>
                                      </div>
                                    </div>
                                  ))}
                                </div>

                                {(() => {
                                  const results = craftResults[item.name] || {};
                                  const total = (results.star3 || 0) + (results.star2 || 0) + (results.star1 || 0) + (results.star0 || 0) + (results.fail || 0);
                                  const expected = craftQuantity[item.name] || 1;

                                  if (total > 0) {
                                    return (
                                      <div className={`mt-2 text-xs font-bold drop-shadow ${total === expected ? 'text-green-400' : 'text-orange-400'}`}>
                                        ÂêàË®à: {total} Âõû {total === expected ? '‚úì' : `(‰∫àÂÆö: ${expected}Âõû)`}
                                      </div>
                                    );
                                  }
                                  return null;
                                })()}
                              </>
                            )}
                          </div>
                        )}

                        {(() => {
                          const results = craftResults[item.name] || {};
                          const prices = sellPrices[item.name] || {};
                          const isMaterial = item.category === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && item.subCategory === 'Á¥†Êùê';
                          const isSimpleMode = isMaterial && (craftResults[`${item.name}_mode`] || 'simple') === 'simple';

                          let hasData = false;
                          if (isMaterial && isSimpleMode) {
                            hasData = (results.totalItems > 0);
                          } else {
                            hasData = ((results.star3 || 0) + (results.star2 || 0) + (results.star1 || 0) + (results.star0 || 0) + (results.fail || 0) > 0);
                          }

                          const hasPrice = isMaterial ? prices.unitPrice : (prices.star3 || prices.star2 || prices.star1 || prices.star0);

                          if (hasData && hasPrice) {
                            const feeRate = (bazaarMode[item.name] ?? true) ? 0.95 : 1.0;

                            let totalIncome;

                            if (isMaterial) {
                              const unitPrice = Math.floor((prices.unitPrice || 0) * feeRate);

                              if (isSimpleMode) {
                                totalIncome = (results.totalItems || 0) * unitPrice;
                              } else {
                                const totalItems =
                                  (results.star3 || 0) * 10 +
                                  (results.star2 || 0) * 3 +
                                  (results.star1 || 0) * 2 +
                                  (results.star0 || 0) * 1 +
                                  (results.fail || 0) * 0;
                                totalIncome = totalItems * unitPrice;
                              }
                            } else {
                              totalIncome =
                                Math.floor((results.star3 || 0) * (prices.star3 || 0) * feeRate) +
                                Math.floor((results.star2 || 0) * (prices.star2 || 0) * feeRate) +
                                Math.floor((results.star1 || 0) * (prices.star1 || 0) * feeRate) +
                                Math.floor((results.star0 || 0) * (prices.star0 || 0) * feeRate);
                            }

                            const totalCost = calculateTotal(item);
                            const profit = totalIncome - totalCost;
                            const profitRate = totalCost > 0 ? ((profit / totalCost) * 100).toFixed(1) : 0;

                            return (
                              <div className="mt-3 p-3 bg-white/10 backdrop-blur-md rounded-lg border border-white/30" style={{ boxShadow: '0 0 20px rgba(16, 185, 129, 0.3)' }}>
                                <div className="text-xs font-bold text-white mb-2 flex items-center gap-2 drop-shadow" style={{ textShadow: '0 0 20px rgba(16, 185, 129, 0.6)' }}>
                                  <span className="text-lg">üíµ</span>
                                  <span>ÂèéÊîØË®àÁÆó</span>
                                </div>
                                <div className="space-y-1 text-sm">
                                  <div className="flex justify-between">
                                    <span className="text-white/80 drop-shadow">Á∑èÂ£≤‰∏ä</span>
                                    <span className="font-bold text-blue-400 drop-shadow">{totalIncome.toLocaleString()} G</span>
                                  </div>
                                  <div className="flex justify-between">
                                    <span className="text-white/80 drop-shadow">Á∑è„Ç≥„Çπ„Éà</span>
                                    <span className="font-bold text-red-400 drop-shadow">{totalCost.toLocaleString()} G</span>
                                  </div>
                                  <div className="border-t border-white/30 my-1"></div>
                                  <div className="flex justify-between items-center">
                                    <span className="text-lg font-black text-white drop-shadow">Á¥îÂà©Áõä:</span>
                                    <div className="text-right">
                                      <div className={`font-black text-2xl drop-shadow ${profit >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                        {profit >= 0 ? '+' : ''}{profit.toLocaleString()} G
                                      </div>
                                      <div className={`text-xs font-bold ${profit >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                        {profit >= 0 ? 'üìà' : 'üìâ'} {profitRate}%
                                      </div>
                                    </div>
                                  </div>
                                  {!isSimpleMode && results.fail > 0 && (
                                    <div className="text-xs text-white/50 mt-2">
                                      ‚Äª Â§±ÊïóÂìÅ{results.fail}Âõû„ÅØÂ£≤Âç¥‰∏çÂèØ„ÅÆ„Åü„ÇÅÂèéÁõä„Å´Âê´„Åø„Åæ„Åõ„Çì
                                    </div>
                                  )}
                                </div>
                              </div>
                            );
                          }
                          return null;
                        })()}

                        {/* üÜï ÊàêÊûú‰øùÂ≠ò„Éú„Çø„É≥ */}
                        {(() => {
                          const results = craftResults[item.name] || {};
                          const prices = sellPrices[item.name] || {};
                          const isMaterial = item.category === 'ÈÅìÂÖ∑ÈçõÂÜ∂' && item.subCategory === 'Á¥†Êùê';
                          const isSimpleMode = isMaterial && (craftResults[`${item.name}_mode`] || 'simple') === 'simple';

                          let hasData = false;
                          if (isMaterial && isSimpleMode) {
                            hasData = (results.totalItems > 0);
                          } else {
                            hasData = ((results.star3 || 0) + (results.star2 || 0) + (results.star1 || 0) + (results.star0 || 0) + (results.fail || 0) > 0);
                          }

                          const hasPrice = isMaterial ? prices.unitPrice : (prices.star3 || prices.star2 || prices.star1 || prices.star0);

                          if (hasData && hasPrice) {
                            return (
                              <button
                                onClick={(e) => {
                                  e.stopPropagation();
                                  saveRecord(item);
                                }}
                                className="mt-3 w-full px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl font-bold shadow-lg hover:shadow-xl transition-all transform hover:scale-105"
                              >
                                üíæ ÊàêÊûú„Çí‰øùÂ≠ò„Åô„Çã
                              </button>
                            );
                          }
                          return null;
                        })()}
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>

          <footer className="bg-white/80 backdrop-blur-md mt-8 py-4">
            <div className="max-w-5xl mx-auto px-3 text-center text-gray-600 text-xs">
              <p className="font-bold">„Éâ„É©„ÇØ„Ç®10 ËÅ∑‰∫∫ÊîØÊè¥„ÉÑ„Éº„É´</p>
              <p className="mt-0.5 text-xs">„Éó„É≠„Éà„Çø„Ç§„ÉóÁâà with ÂèéÁõäÁÆ°ÁêÜ</p>
            </div>
          </footer>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<CraftsmanApp />);
  </script>
</body>

</html>

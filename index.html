<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ‰ãƒ©ã‚¯ã‚¨10 è·äººæ”¯æ´ãƒ„ãƒ¼ãƒ«</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
<style>
  .page-flip-enter {
    animation: pageFlipIn 0.6s ease-out;
  }
  
  @keyframes pageFlipIn {
    0% {
      transform: perspective(1000px) rotateY(-90deg);
      opacity: 0;
    }
    100% {
      transform: perspective(1000px) rotateY(0deg);
      opacity: 1;
    }
  }
  
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes spin-slow {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
  
  .animate-fade-in {
    animation: fade-in 0.8s ease-out forwards;
    opacity: 0;
  }
  
  .animate-spin-slow {
    animation: spin-slow 3s linear infinite;
  }
</style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    // SVGã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    const Search = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
    );
    
    const Package = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M16.5 9.4 7.55 4.24"></path>
        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
        <line x1="12" y1="22.08" x2="12" y2="12"></line>
      </svg>
    );
    
    const Sparkles = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
        <path d="M5 3v4"></path>
        <path d="M19 17v4"></path>
        <path d="M3 5h4"></path>
        <path d="M17 19h4"></path>
      </svg>
    );
    
    const UtensilsCrossed = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8"></path>
        <path d="M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7"></path>
        <path d="m2.1 21.8 6.4-6.3"></path>
        <path d="m19 5-7 7"></path>
      </svg>
    );
    
    const Pin = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <line x1="12" x2="12" y1="17" y2="22"></line>
        <path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z"></path>
      </svg>
    );
    
    const TrendingUp = ({size = 24, className = ""}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
        <polyline points="16 7 22 7 22 13"></polyline>
      </svg>
    );

const { useState, useEffect } = React;

const CraftsmanApp = () => {
  const [showWelcome, setShowWelcome] = useState(true);
  const [activeCategory, setActiveCategory] = useState('æ­¦å™¨é›å†¶');
  
  // Enterã‚­ãƒ¼ã§ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢ã‚’é–‰ã˜ã‚‹
  useEffect(() => {
    const handleKeyPress = (e) => {
      if (e.key === 'Enter' && showWelcome) {
        setShowWelcome(false);
      }
    };
    window.addEventListener('keydown', handleKeyPress);
    return () => window.removeEventListener('keydown', handleKeyPress);
  }, [showWelcome]);
  
  const [searchQuery, setSearchQuery] = useState('');
  const [searchActive, setSearchActive] = useState('');
  const [selectedItem, setSelectedItem] = useState(null);
  const [materialPrices, setMaterialPrices] = useState({});
  const [toolPrices, setToolPrices] = useState({});
  const [selectedArmorType, setSelectedArmorType] = useState('å°ç›¾');
  const [selectedWeaponType, setSelectedWeaponType] = useState('ç‰‡æ‰‹å‰£');
  const [selectedToolType, setSelectedToolType] = useState('ç´ æ');
  const [selectedSewingType, setSelectedSewingType] = useState('ã‚¢ã‚¿ãƒ');
  const [selectedWoodworkType, setSelectedWoodworkType] = useState('ã‚¹ãƒ†ã‚£ãƒƒã‚¯');
  const [selectedCookingType, setSelectedCookingType] = useState('æ–™ç†å…¨éƒ¨');
  const [craftQuantity, setCraftQuantity] = useState({});
  const [sellPrices, setSellPrices] = useState({});
  const [craftResults, setCraftResults] = useState({});
  const [bazaarMode, setBazaarMode] = useState({});
  const [pageTransition, setPageTransition] = useState(false);
  
  // ğŸ†• åç›Šç®¡ç†ç”¨ã®state
  const [savedRecords, setSavedRecords] = useState([]);
  const [profitView, setProfitView] = useState('today'); // 'today' or 'month'
  const [isPinned, setIsPinned] = useState(false);
  
  // ğŸ†• LocalStorageã‹ã‚‰åç›Šãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
  useEffect(() => {
    const saved = localStorage.getItem('dqx_profit_records');
    if (saved) {
      setSavedRecords(JSON.parse(saved));
    }
    const pinned = localStorage.getItem('dqx_profit_pinned');
    if (pinned) {
      setIsPinned(JSON.parse(pinned));
    }
  }, []);
  
  // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‹ã‚‰æˆæœè¨˜éŒ²ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹ï¼‰
  useEffect(() => {
    window.updateCraftResults = (itemName, results) => {
      setCraftResults(prev => ({
        ...prev,
        [itemName]: results
      }));
    };
    
    return () => {
      delete window.updateCraftResults;
    };
  }, []);
// ğŸ†• æˆæœã‚’ä¿å­˜ã™ã‚‹é–¢æ•°
  const saveRecord = (item) => {
    const record = {
      id: Date.now(),
      timestamp: new Date().toISOString(),
      itemName: item.name,
      category: item.category,
      subCategory: item.subCategory,
      materialPrices: {},
      toolPrice: toolPrices[item.name] || 0,
      quantity: craftQuantity[item.name] || 1,
      sellPrices: sellPrices[item.name] || {},
      craftResults: craftResults[item.name] || {},
      bazaarMode: bazaarMode[item.name] ?? true,
      totalCost: calculateTotal(item),
      totalIncome: 0,
      profit: 0
    };
    
    // ç´ æä¾¡æ ¼ã‚’ã‚³ãƒ”ãƒ¼
    item.materials.forEach(material => {
      const key = `${item.name}-${material.name}`;
      if (materialPrices[key]) {
        record.materialPrices[material.name] = materialPrices[key];
      }
    });
    
    // åå…¥ã¨åˆ©ç›Šã‚’è¨ˆç®—
    const results = craftResults[item.name] || {};
    const prices = sellPrices[item.name] || {};
    const feeRate = (bazaarMode[item.name] ?? true) ? 0.95 : 1.0;
    const isMaterial = item.category === 'é“å…·é›å†¶' && item.subCategory === 'ç´ æ';
    const isSimpleMode = isMaterial && (craftResults[`${item.name}_mode`] || 'simple') === 'simple';
    
    if (isMaterial) {
      const unitPrice = Math.floor((prices.unitPrice || 0) * feeRate);
      if (isSimpleMode) {
        record.totalIncome = (results.totalItems || 0) * unitPrice;
      } else {
        const totalItems = 
          (results.star3 || 0) * 10 +
          (results.star2 || 0) * 3 +
          (results.star1 || 0) * 2 +
          (results.star0 || 0) * 1;
        record.totalIncome = totalItems * unitPrice;
      }
    } else {
      record.totalIncome = 
        Math.floor((results.star3 || 0) * (prices.star3 || 0) * feeRate) +
        Math.floor((results.star2 || 0) * (prices.star2 || 0) * feeRate) +
        Math.floor((results.star1 || 0) * (prices.star1 || 0) * feeRate) +
        Math.floor((results.star0 || 0) * (prices.star0 || 0) * feeRate);
    }
    
    record.profit = record.totalIncome - record.totalCost;
    
    const newRecords = [record, ...savedRecords];
    setSavedRecords(newRecords);
    localStorage.setItem('dqx_profit_records', JSON.stringify(newRecords));
    
    alert('æˆæœã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
  };
  
  // ğŸ†• åç›Šã‚µãƒãƒªãƒ¼ã‚’è¨ˆç®—
  const calculateSummary = (period) => {
    const now = new Date();
    let filteredRecords = savedRecords;
    
    if (period === 'today') {
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      filteredRecords = savedRecords.filter(r => {
        const recordDate = new Date(r.timestamp);
        return recordDate >= today;
      });
    } else if (period === 'month') {
      const thisMonth = new Date(now.getFullYear(), now.getMonth(), 1);
      filteredRecords = savedRecords.filter(r => {
        const recordDate = new Date(r.timestamp);
        return recordDate >= thisMonth;
      });
    }
    
    const totalIncome = filteredRecords.reduce((sum, r) => sum + r.totalIncome, 0);
    const totalCost = filteredRecords.reduce((sum, r) => sum + r.totalCost, 0);
    const profit = totalIncome - totalCost;
    
    return { totalIncome, totalCost, profit, count: filteredRecords.length };
  };
  
  // ğŸ†• ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤
  const deleteRecord = (id) => {
    if (confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
      const newRecords = savedRecords.filter(r => r.id !== id);
      setSavedRecords(newRecords);
      localStorage.setItem('dqx_profit_records', JSON.stringify(newRecords));
    }
  };
  
  // ğŸ†• ãƒ”ãƒ³ç•™ã‚åˆ‡ã‚Šæ›¿ãˆ
  const togglePin = () => {
    const newPinned = !isPinned;
    setIsPinned(newPinned);
    localStorage.setItem('dqx_profit_pinned', JSON.stringify(newPinned));
  };
  
  // åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ãƒ¬ã‚·ãƒ”ã‚’é–‹ãé–¢æ•°
  const openRecipeWindow = (item) => {
    const width = 450;
    const height = 700;
    const left = window.screen.width - width - 50;
    const top = 100;
    
    const recipeWindow = window.open(
      '',
      `recipe_${item.name}`,
      `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`
    );
    
    if (!recipeWindow) {
      alert('ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚');
      return;
    }
    
    const totalCost = calculateTotal(item);
    const quantity = craftQuantity[item.name] || 1;
    
    // ç›®æ¨™æ•°å€¤ã®HTMLç”Ÿæˆ
    let targetValuesHTML = '';
    if (Object.keys(item.targetValues).length === 0) {
      targetValuesHTML = '<div style="text-align: center; padding: 1rem; background: rgb(249, 250, 251); border-radius: 0.75rem;"><p style="color: rgb(107, 114, 128); font-weight: bold;">ãƒ‡ãƒ¼ã‚¿åé›†ä¸­...</p></div>';
    } else {
      const paramColors = {
  A: 'background: linear-gradient(to bottom right, rgb(244, 63, 94), rgb(236, 72, 153), rgb(239, 68, 68)); box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.3);',
  B: 'background: linear-gradient(to bottom right, rgb(14, 165, 233), rgb(59, 130, 246), rgb(99, 102, 241)); box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.3);',
  C: 'background: linear-gradient(to bottom right, rgb(16, 185, 129), rgb(20, 184, 166), rgb(6, 182, 212)); box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.3);',
  D: 'background: linear-gradient(to bottom right, rgb(139, 92, 246), rgb(168, 85, 247), rgb(217, 70, 239)); box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.3);',
  E: 'background: linear-gradient(to bottom right, rgb(245, 158, 11), rgb(251, 146, 60), rgb(234, 179, 8)); box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.3);',
  F: 'background: linear-gradient(to bottom right, rgb(132, 204, 22), rgb(74, 222, 128), rgb(34, 197, 94)); box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.3);',
  G: 'background: linear-gradient(to bottom right, rgb(6, 182, 212), rgb(34, 211, 238), rgb(14, 165, 233)); box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.3);',
  H: 'background: linear-gradient(to bottom right, rgb(236, 72, 153), rgb(244, 63, 94), rgb(217, 70, 239)); box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.3);'
};
      
      targetValuesHTML = '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;">';
Object.entries(item.targetValues).forEach(([param, values]) => {
  targetValuesHTML += `
    <div style="${paramColors[param]} padding: 1rem; border-radius: 1rem; color: white;">
      <div style="font-size: 0.875rem; font-weight: bold; opacity: 0.9; text-align: center;">${param}</div>
      <div style="font-size: 1.75rem; font-weight: 900; margin-top: 0.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">${values.min} - ${values.max}</div>
    </div>
  `;
});
targetValuesHTML += '</div>';
    }
    
    recipeWindow.document.write(`
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${item.name} - ãƒ¬ã‚·ãƒ”</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: white;
  min-height: 100vh;
}
</style>
</head>
<body>

<div style="background: linear-gradient(to right, rgb(217, 119, 6), rgb(245, 158, 11), rgb(251, 191, 36)); padding: 1rem; color: white; border-bottom: 2px solid rgb(217, 119, 6);">
  <div style="font-size: 0.75rem; font-weight: bold; background: rgba(255,255,255,0.3); padding: 0.25rem 0.75rem; border-radius: 9999px; display: inline-block; border: 1px solid rgba(255,255,255,0.3);">${item.category}</div>
  <div style="display: flex; align-items: center; gap: 0.75rem; margin-top: 0.5rem;">
    <h2 style="font-size: 1.5rem; font-weight: 900; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">${item.name}</h2>
    ${item.specialTrait ? `<span style="padding: 0.25rem 0.5rem; background: rgba(250, 204, 21, 1); color: rgb(113, 63, 18); border-radius: 9999px; font-size: 0.75rem; font-weight: bold; border: 1px solid rgb(234, 179, 8); box-shadow: 0 2px 4px rgba(0,0,0,0.1);">${item.specialTrait}</span>` : ''}
  </div>
</div>

<div style="padding: 1rem;">
  <h3 style="font-size: 1rem; font-weight: 900; color: rgb(17, 24, 39); margin-bottom: 1rem;">ğŸ¯ ç›®æ¨™æ•°å€¤</h3>
  ${targetValuesHTML}
</div>

<div style="padding: 0 1rem 1rem 1rem;">
  <h3 style="font-size: 1rem; font-weight: 900; color: rgb(17, 24, 39); margin-bottom: 1rem;">ğŸ“¦ å¿…è¦ç´ æ</h3>
  ${item.materials.map(m => `
    <div style="padding: 1rem; background: linear-gradient(to bottom right, rgb(238, 242, 255), rgb(243, 232, 255), rgb(252, 231, 243)); border-radius: 1rem; margin-bottom: 0.75rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid rgb(199, 210, 254);">
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <span style="font-weight: bold; color: rgb(17, 24, 39); font-size: 1rem;">${m.name}</span>
        <span style="padding: 0.25rem 1rem; background: linear-gradient(to right, rgb(236, 72, 153), rgb(168, 85, 247)); color: white; border-radius: 9999px; font-weight: 900; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">Ã—${m.quantity}</span>
      </div>
    </div>
  `).join('')}
</div>

</body>
</html>
    `);
    
    recipeWindow.document.close();
    recipeWindow.focus();
  };
  
  // JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
  const [allItems, setAllItems] = useState([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    fetch('data/items.json')
      .then(res => res.json())
      .then(data => {
        setAllItems(data);
        setLoading(false);
      })
      .catch(error => {
        console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        setLoading(false);
      });
  }, []);
  
  const handleReset = () => {
    setSearchQuery('');
    setSearchActive('');
    setSelectedItem(null);
    setMaterialPrices({});
    setToolPrices({});
  };

  const handleSearch = () => {
    setSearchActive(searchQuery);
    setSelectedItem(null);
    setMaterialPrices({});
    setToolPrices({});
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter') {
      handleSearch();
    }
  };

  const filteredItems = allItems.filter(item => {
    const categoryMatch = item.category === activeCategory;
    const searchMatch = searchActive === '' || item.name.toLowerCase().includes(searchActive.toLowerCase());
    
    let subCategoryMatch = true;
    
    if (activeCategory === 'æ­¦å™¨é›å†¶') {
      subCategoryMatch = item.subCategory === selectedWeaponType;
    }
    
    if (activeCategory === 'é˜²å…·é›å†¶') {
      subCategoryMatch = item.subCategory === selectedArmorType;
    }
    
    if (activeCategory === 'é“å…·é›å†¶') {
      subCategoryMatch = item.subCategory === selectedToolType;
    }
    
    if (activeCategory === 'è£ç¸«') {
      subCategoryMatch = item.subCategory === selectedSewingType;
    }
    
    if (activeCategory === 'æœ¨å·¥') {
      subCategoryMatch = item.subCategory === selectedWoodworkType;
    }
    
    if (activeCategory === 'æ–™ç†' && selectedCookingType !== 'æ–™ç†å…¨éƒ¨') {
      subCategoryMatch = item.subCategory === selectedCookingType;
    }
    
    return categoryMatch && searchMatch && subCategoryMatch;
  });

  // ğŸ†• åç›Šç®¡ç†ã‚’è¿½åŠ 
  const categories = ['æ­¦å™¨é›å†¶', 'é˜²å…·é›å†¶', 'é“å…·é›å†¶', 'è£ç¸«', 'æœ¨å·¥', 'æ–™ç†', 'åç›Šç®¡ç†'];
  
  const weaponTypes = ['ç‰‡æ‰‹å‰£', 'ä¸¡æ‰‹å‰£', 'çŸ­å‰£', 'ãƒ¤ãƒª', 'ã‚ªãƒ', 'ãƒ„ãƒ¡', 'ãƒ ãƒ', 'ãƒãƒ³ãƒãƒ¼', 'ãƒ–ãƒ¼ãƒ¡ãƒ©ãƒ³', 'éŒ', 'å®¶å…·', 'åº­å…·'];
  
  const armorTypes = ['å°ç›¾', 'å¤§ç›¾', 'ã‚¢ã‚¿ãƒ', 'ã‹ã‚‰ã ä¸Š', 'ã‹ã‚‰ã ä¸‹', 'ã‚¦ãƒ‡', 'è¶³'];
  
  const toolTypes = ['é“å…·', 'ç´ æ', 'å®¶å…·', 'åº­å…·'];
  
  const sewingTypes = ['ã‚¢ã‚¿ãƒ', 'ã‹ã‚‰ã ä¸Š', 'ã‹ã‚‰ã ä¸‹', 'ã‚¦ãƒ‡', 'è¶³', 'å®¶å…·'];
  
  const woodworkTypes = ['ã‚¹ãƒ†ã‚£ãƒƒã‚¯', 'ä¸¡æ‰‹æ–', 'æ£', 'æ‰‡', 'å¼“', 'å®¶å…·', 'åº­å…·', 'é‡£ã‚Šã–ãŠ'];
  
  const cookingTypes = ['æ–™ç†å…¨éƒ¨', 'è‚‰æ–™ç†', 'é­šæ–™ç†', 'ãƒ‘ã‚¹ã‚¿&ãƒ©ã‚¤ã‚¹', 'ã‚¹ã‚¤ãƒ¼ãƒ„'];
  
const paramColors = {
  A: 'from-rose-500 via-pink-500 to-red-500',
  B: 'from-sky-500 via-blue-500 to-indigo-500',
  C: 'from-emerald-500 via-teal-500 to-cyan-500',
  D: 'from-purple-500 via-violet-500 to-fuchsia-500',
  E: 'from-amber-500 via-orange-500 to-yellow-500',
  F: 'from-lime-500 via-green-500 to-emerald-500',
  G: 'from-cyan-500 via-sky-500 to-blue-500',
  H: 'from-fuchsia-500 via-pink-500 to-rose-500'
};

const gridColors = {
  A: 'from-rose-500 via-pink-500 to-red-500',
  B: 'from-sky-500 via-blue-500 to-indigo-500',
  C: 'from-emerald-500 via-teal-500 to-cyan-500',
  D: 'from-purple-500 via-violet-500 to-fuchsia-500',
  E: 'from-amber-500 via-orange-500 to-yellow-500',
  F: 'from-lime-500 via-green-500 to-emerald-500',
  G: 'from-cyan-500 via-sky-500 to-blue-500',
  H: 'from-fuchsia-500 via-pink-500 to-rose-500',
  I: 'from-violet-500 via-purple-500 to-indigo-500'
};
// 3x3ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º
const renderGrid = (targetValues) => {
  const gridPositions = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'];
  
  return (
    <div className="grid grid-cols-3 gap-2.5">
      {gridPositions.map((pos) => {
        const value = targetValues[pos];
        const isEmpty = !value;
        
        return (
          <div
            key={pos}
            className={`p-4 rounded-xl text-white shadow-lg flex flex-col items-center justify-center ${
              isEmpty ? 'bg-white/10 backdrop-blur-sm border border-white/20' : `bg-gradient-to-br ${gridColors[pos]} backdrop-blur-sm border border-white/30`
            }`}
            style={isEmpty ? {} : {boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
          >
            <div className={`text-xs font-bold tracking-wider ${isEmpty ? 'text-white/40' : 'opacity-90 drop-shadow'}`}>
              {pos}
            </div>
            {isEmpty ? (
              <div className="text-2xl font-black text-white/40 mt-1 text-center">-</div>
            ) : (
              <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
                {value.min}-{value.max}
              </div>
            )}
          </div>
        );
      })}
    </div>
  );
};

// ç‰‡æ‰‹å‰£ï¼ˆç¸¦3ï¼‰: A, B, C
const renderOnHandSword = (targetValues) => {
  const positions = ['A', 'B', 'C'];
  return (
    <div className="grid grid-cols-1 gap-2.5 max-w-xs mx-auto">
      {positions.map((pos) => {
        const value = targetValues[pos];
        return (
          <div
            key={pos}
            className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
            style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
          >
            <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
            <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
              {value.min} - {value.max}
            </div>
          </div>
        );
      })}
    </div>
  );
};

// ä¸¡æ‰‹å‰£ï¼ˆç¸¦4Ã—æ¨ª2ï¼‰: A,B / C,D / E,F / G,H
const renderTwoHandSword = (targetValues) => {
  const rows = [
    ['A', 'B'],
    ['C', 'D'],
    ['E', 'F'],
    ['G', 'H']
  ];
  return (
    <div className="grid grid-cols-2 gap-2.5">
      {rows.flat().map((pos) => {
        const value = targetValues[pos];
        if (!value) return null;
        return (
          <div
            key={pos}
            className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
            style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
          >
            <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
            <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
              {value.min} - {value.max}
            </div>
          </div>
        );
      })}
    </div>
  );
};

// çŸ­å‰£ï¼ˆç¸¦2ï¼‰: A, B
const renderDagger = (targetValues) => {
  const positions = ['A', 'B'];
  return (
    <div className="grid grid-cols-1 gap-2.5 max-w-xs mx-auto">
      {positions.map((pos) => {
        const value = targetValues[pos];
        return (
          <div
            key={pos}
            className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
            style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
          >
            <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
            <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
              {value.min} - {value.max}
            </div>
          </div>
        );
      })}
    </div>
  );
};
// ãƒ¤ãƒªï¼ˆç¸¦4ï¼‰: A, B, C, D
const renderSpear = (targetValues) => {
  const positions = ['A', 'B', 'C', 'D'];
  return (
    <div className="grid grid-cols-1 gap-2.5 max-w-xs mx-auto">
      {positions.map((pos) => {
        const value = targetValues[pos];
        return (
          <div
            key={pos}
            className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
            style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
          >
            <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
            <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
              {value.min} - {value.max}
            </div>
          </div>
        );
      })}
    </div>
  );
};

  // ã‚ªãƒ: A,B / C,D / E / Gï¼ˆFã¨Hæ¬ æï¼‰
const renderAxe = (targetValues) => {
  return (
    <div className="space-y-2.5">
      <div className="grid grid-cols-2 gap-2.5">
        {['A', 'B'].map((pos) => {
          const value = targetValues[pos];
          if (!value) return null;
          return (
            <div
              key={pos}
              className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
              style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
            >
              <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
              <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
                {value.min} - {value.max}
              </div>
            </div>
          );
        })}
      </div>
      <div className="grid grid-cols-2 gap-2.5">
        {['C', 'D'].map((pos) => {
          const value = targetValues[pos];
          if (!value) return null;
          return (
            <div
              key={pos}
              className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
              style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
            >
              <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
              <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
                {value.min} - {value.max}
              </div>
            </div>
          );
        })}
      </div>
      <div className="grid grid-cols-2 gap-2.5">
        <div className={`bg-gradient-to-br ${paramColors['E']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}>
          <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">E</div>
          <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
            {targetValues['E'].min} - {targetValues['E'].max}
          </div>
        </div>
      </div>
      <div className="grid grid-cols-2 gap-2.5">
        <div className={`bg-gradient-to-br ${paramColors['G']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}>
          <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">G</div>
          <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
            {targetValues['G'].min} - {targetValues['G'].max}
          </div>
        </div>
      </div>
    </div>
  );
};

  // ãƒ ãƒ: A,B / C,D / E,F / Gï¼ˆHæ¬ æï¼‰
const renderWhip = (targetValues) => {
  return (
    <div className="space-y-2.5">
      <div className="grid grid-cols-2 gap-2.5">
        {['A', 'B'].map((pos) => {
          const value = targetValues[pos];
          if (!value) return null;
          return (
            <div
              key={pos}
              className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
              style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
            >
              <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
              <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
                {value.min} - {value.max}
              </div>
            </div>
          );
        })}
      </div>
      <div className="grid grid-cols-2 gap-2.5">
        {['C', 'D'].map((pos) => {
          const value = targetValues[pos];
          if (!value) return null;
          return (
            <div
              key={pos}
              className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
              style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
            >
              <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
              <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
                {value.min} - {value.max}
              </div>
            </div>
          );
        })}
      </div>
      <div className="grid grid-cols-2 gap-2.5">
        {['E', 'F'].map((pos) => {
          const value = targetValues[pos];
          if (!value) return null;
          return (
            <div
              key={pos}
              className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
              style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
            >
              <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
              <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
                {value.min} - {value.max}
              </div>
            </div>
          );
        })}
      </div>
      <div className="grid grid-cols-2 gap-2.5">
        {['G'].map((pos) => {
          const value = targetValues[pos];
          if (!value) return null;
          return (
            <div
              key={pos}
              className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
              style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
            >
              <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
              <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
                {value.min} - {value.max}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
};

 // ãƒãƒ³ãƒãƒ¼ï¼ˆ3x2ï¼‰: A,B / C,D / E,F
const renderHammer = (targetValues) => {
  const rows = [
    ['A', 'B'],
    ['C', 'D'],
    ['E', 'F']
  ];
  return (
    <div className="grid grid-cols-2 gap-2.5">
      {rows.flat().map((pos) => {
        const value = targetValues[pos];
        if (!value) return null;
        return (
          <div
            key={pos}
            className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
            style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
          >
            <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
            <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
              {value.min} - {value.max}
            </div>
          </div>
        );
      })}
    </div>
  );
};
  // ãƒ–ãƒ¼ãƒ¡ãƒ©ãƒ³ï¼ˆã‚³ã®å­—å‹ï¼‰: A,B / D / E,Fï¼ˆCãŒæ¬ æï¼‰
const renderBoomerang = (targetValues) => {
  return (
    <div className="space-y-2.5">
      <div className="grid grid-cols-2 gap-2.5">
        {['A', 'B'].map((pos) => {
          const value = targetValues[pos];
          if (!value) return null;
          return (
            <div
              key={pos}
              className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
              style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
            >
              <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
              <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
                {value.min} - {value.max}
              </div>
            </div>
          );
        })}
      </div>
      <div className="grid grid-cols-2 gap-2.5">
        <div className="col-start-2">
          {targetValues['D'] && (
            <div className={`bg-gradient-to-br ${paramColors['D']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}>
              <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">D</div>
              <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
                {targetValues['D'].min} - {targetValues['D'].max}
              </div>
            </div>
          )}
        </div>
      </div>
      <div className="grid grid-cols-2 gap-2.5">
        {['E', 'F'].map((pos) => {
          const value = targetValues[pos];
          if (!value) return null;
          return (
            <div
              key={pos}
              className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
              style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
            >
              <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
              <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
                {value.min} - {value.max}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
};

  // éŒï¼ˆLå­—åè»¢å‹ï¼‰: A,C,E,Gï¼ˆç¸¦ï¼‰ / Bï¼ˆ2è¡Œç›®ã®ã¿ï¼‰
const renderScythe = (targetValues) => {
  return (
    <div className="space-y-2.5">
      <div className="grid grid-cols-2 gap-2.5">
        <div className={`bg-gradient-to-br ${paramColors['A']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}>
          <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">A</div>
          <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
            {targetValues['A'].min} - {targetValues['A'].max}
          </div>
        </div>
        {targetValues['B'] && (
          <div className={`bg-gradient-to-br ${paramColors['B']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}>
            <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">B</div>
            <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
              {targetValues['B'].min} - {targetValues['B'].max}
            </div>
          </div>
        )}
      </div>
      <div className="grid grid-cols-2 gap-2.5">
        <div className={`bg-gradient-to-br ${paramColors['C']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}>
          <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">C</div>
          <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
            {targetValues['C'].min} - {targetValues['C'].max}
          </div>
        </div>
      </div>
      <div className="grid grid-cols-2 gap-2.5">
        <div className={`bg-gradient-to-br ${paramColors['E']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}>
          <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">E</div>
          <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
            {targetValues['E'].min} - {targetValues['E'].max}
          </div>
        </div>
      </div>
      <div className="grid grid-cols-2 gap-2.5">
        <div className={`bg-gradient-to-br ${paramColors['G']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}>
          <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">G</div>
          <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
            {targetValues['G'].min} - {targetValues['G'].max}
          </div>
        </div>
      </div>
    </div>
  );
};

  // ABCD 4ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¡¨ç¤º
const renderABCD = (targetValues) => {
  return (
    <div className="grid grid-cols-2 gap-2.5">
      {Object.entries(targetValues).map(([param, values]) => (
        <div
          key={param}
          className={`bg-gradient-to-br ${paramColors[param]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
          style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
        >
          <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{param}</div>
          <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
            {values.min} - {values.max}
          </div>
        </div>
      ))}
    </div>
  );
};

  // ã‚°ãƒªãƒƒãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸè¡¨ç¤ºã®æŒ¯ã‚Šåˆ†ã‘
  const renderTargetValues = (item) => {
    if (Object.keys(item.targetValues).length === 0) {
      return (
        <div className="text-center py-4 bg-gray-50 rounded-xl">
          <p className="text-gray-500 font-bold text-sm">ãƒ‡ãƒ¼ã‚¿åé›†ä¸­...</p>
        </div>
      );
    }

    // ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªã«å¿œã˜ã¦è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
    if (item.subCategory === 'ç‰‡æ‰‹å‰£') {
      return renderOnHandSword(item.targetValues);
    } else if (item.subCategory === 'ä¸¡æ‰‹å‰£') {
      return renderTwoHandSword(item.targetValues);
    } else if (item.subCategory === 'çŸ­å‰£') {
      return renderDagger(item.targetValues);
    } else if (item.subCategory === 'ãƒ¤ãƒª') {
      return renderSpear(item.targetValues);
    } else if (item.subCategory === 'ã‚ªãƒ') {
      return renderAxe(item.targetValues);
    } else if (item.subCategory === 'ãƒ ãƒ') {
      return renderWhip(item.targetValues);
    } else if (item.subCategory === 'ãƒãƒ³ãƒãƒ¼') {
      return renderHammer(item.targetValues);
    } else if (item.subCategory === 'ãƒ–ãƒ¼ãƒ¡ãƒ©ãƒ³') {
      return renderBoomerang(item.targetValues);
    } else if (item.subCategory === 'éŒ') {
      return renderScythe(item.targetValues);
    }
     // é˜²å…·é›å†¶ - ã‚¦ãƒ‡ï¼ˆç¸¦3ãƒã‚¹: A, B, Cï¼‰
else if (item.subCategory === 'ã‚¦ãƒ‡') {
  return renderOnHandSword(item.targetValues);
}

// é˜²å…·é›å†¶ - è¶³ï¼ˆLå­—å‹: B, D, E, Fï¼‰
else if (item.subCategory === 'è¶³') {
  return (
    <div className="space-y-2.5">
      <div className="grid grid-cols-2 gap-2.5">
        <div className="bg-white/10 backdrop-blur-sm p-4 rounded-xl opacity-30 border border-white/20"></div>
        {item.targetValues['B'] && (
          <div className={`bg-gradient-to-br ${paramColors['B']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}>
            <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">B</div>
            <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
              {item.targetValues['B'].min} - {item.targetValues['B'].max}
            </div>
          </div>
        )}
      </div>
      <div className="grid grid-cols-2 gap-2.5">
        <div className="bg-white/10 backdrop-blur-sm p-4 rounded-xl opacity-30 border border-white/20"></div>
        {item.targetValues['D'] && (
          <div className={`bg-gradient-to-br ${paramColors['D']} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`} style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}>
            <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">D</div>
            <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
              {item.targetValues['D'].min} - {item.targetValues['D'].max}
            </div>
          </div>
        )}
      </div>
      <div className="grid grid-cols-2 gap-2.5">
        {['E', 'F'].map((pos) => {
          const value = item.targetValues[pos];
          if (!value) return null;
          return (
            <div
              key={pos}
              className={`bg-gradient-to-br ${paramColors[pos]} backdrop-blur-sm p-4 rounded-xl text-white shadow-lg border border-white/30`}
              style={{boxShadow: '0 0 20px rgba(255, 255, 255, 0.3), 0 0 40px rgba(255, 255, 255, 0.1)'}}
            >
              <div className="text-xs font-bold opacity-90 tracking-wider text-center drop-shadow">{pos}</div>
              <div className="text-2xl font-black mt-1 text-center" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
                {value.min} - {value.max}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
} else if (item.gridType === '3x3') {
  return renderGrid(item.targetValues);
} else if (item.gridType === '3x2') {
  return renderHammer(item.targetValues);
} else {
  return renderABCD(item.targetValues);
}
  };

  const updatePrice = (itemName, materialName, price) => {
    const numericValue = price.replace(/,/g, '');
    setMaterialPrices(prev => ({
      ...prev,
      [`${itemName}-${materialName}`]: numericValue === '' ? 0 : parseInt(numericValue) || 0
    }));
  };

  const formatNumber = (value) => {
    if (!value) return '';
    return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  };

  const calculateTotal = (item) => {
    const materialTotal = item.materials.reduce((total, material) => {
      const price = materialPrices[`${item.name}-${material.name}`] || 0;
      return total + (price * material.quantity);
    }, 0);
    
    const toolPrice = toolPrices[item.name] || 0;
    const toolCost = Math.floor(toolPrice / 30);
    const quantity = craftQuantity[item.name] || 1;
    
    return (materialTotal + toolCost) * quantity;
  };

  // ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢
if (showWelcome) {
  return (
    <div className="min-h-screen relative flex items-center justify-center overflow-hidden">
      {/* èƒŒæ™¯å‹•ç”» */}
      <video 
        key="welcome-video"
        autoPlay 
        loop 
        muted 
        playsInline
        className="fixed inset-0 -z-10 w-full h-full object-cover"
      >
        <source src="assets/bg-image-v10.mp4" type="video/mp4" />
      </video>
      {/* èƒŒæ™¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆå‹•ç”»ã‚’å°‘ã—æš—ãï¼‰ */}
      <div className="fixed inset-0 -z-10 bg-gradient-to-b from-black/30 via-black/20 to-black/40" />
      
      {/* ãƒã‚ªãƒ³è£…é£¾ */}
      <div className="absolute top-10 left-10 w-96 h-96 bg-cyan-400/20 rounded-full blur-3xl animate-pulse"></div>
      <div className="absolute bottom-20 right-20 w-80 h-80 bg-purple-400/20 rounded-full blur-3xl animate-pulse" style={{animationDelay: '1s'}}></div>
      <div className="absolute top-1/3 right-1/4 w-64 h-64 bg-pink-400/20 rounded-full blur-3xl animate-pulse" style={{animationDelay: '2s'}}></div>
      
      {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
      <div className="text-center z-10 px-4 max-w-2xl">
        {/* ã‚¿ã‚¤ãƒˆãƒ« */}
        <h1 
          className="text-6xl md:text-7xl font-black text-white mb-4 animate-fade-in"
          style={{
            textShadow: '0 0 40px rgba(56, 189, 248, 0.8), 0 0 80px rgba(56, 189, 248, 0.4), 0 4px 8px rgba(0,0,0,0.3)'
          }}
        >
          ã‚ˆã†ã“ã
        </h1>
        <h2 
          className="text-4xl md:text-5xl font-black text-white mb-8 animate-fade-in"
          style={{
            animationDelay: '0.2s',
            textShadow: '0 0 30px rgba(168, 85, 247, 0.8), 0 0 60px rgba(168, 85, 247, 0.4), 0 4px 8px rgba(0,0,0,0.3)'
          }}
        >
          è·äººæ”¯æ´ãƒ„ãƒ¼ãƒ«ã¸
        </h2>

        {/* ã‚¢ã‚¤ã‚³ãƒ³ */}
        <div className="flex justify-center mb-12 animate-bounce" style={{animationDelay: '0.4s'}}>
          <div 
            className="bg-white/10 backdrop-blur-md p-6 rounded-3xl border-2 border-white/30 relative"
            style={{
              boxShadow: '0 0 40px rgba(56, 189, 248, 0.6), 0 0 80px rgba(168, 85, 247, 0.4), 0 8px 16px rgba(0,0,0,0.2)'
            }}
          >
            <div className="absolute inset-0 bg-gradient-to-br from-cyan-400/20 to-purple-400/20 rounded-3xl animate-pulse"></div>
            <Sparkles className="text-white relative z-10" size={64} />
          </div>
        </div>
        
        {/* èª¬æ˜æ–‡ */}
        <div className="relative mb-12 animate-fade-in" style={{animationDelay: '0.6s'}}>
          <div className="absolute inset-0 bg-gradient-to-r from-cyan-400/20 via-purple-400/20 to-pink-400/20 rounded-2xl blur-xl"></div>
          <div 
            className="relative bg-white/10 backdrop-blur-md rounded-2xl p-8 border border-white/30"
            style={{
              boxShadow: '0 0 30px rgba(56, 189, 248, 0.3), 0 8px 16px rgba(0,0,0,0.1)'
            }}
          >
            <div className="flex items-center justify-center gap-3 mb-4">
              <div className="w-12 h-px bg-gradient-to-r from-transparent via-cyan-400 to-transparent"></div>
              <Sparkles className="text-cyan-300" size={20} />
              <div className="w-12 h-px bg-gradient-to-r from-transparent via-purple-400 to-transparent"></div>
            </div>
            <p className="text-xl md:text-2xl font-bold text-white leading-relaxed drop-shadow-lg">
              ãƒ‰ãƒ©ã‚´ãƒ³ã‚¯ã‚¨ã‚¹ãƒˆXã®è·äººæ´»å‹•ã‚’
            </p>
            <p 
              className="text-2xl md:text-3xl font-black text-white mt-2"
              style={{
                textShadow: '0 0 20px rgba(56, 189, 248, 0.6), 0 0 40px rgba(168, 85, 247, 0.4)'
              }}
            >
              ã‚‚ã£ã¨ä¾¿åˆ©ã«ã€ã‚‚ã£ã¨æ¥½ã—ã
            </p>
            <div className="flex items-center justify-center gap-3 mt-4">
              <div className="w-12 h-px bg-gradient-to-r from-transparent via-purple-400 to-transparent"></div>
              <Package className="text-purple-300" size={20} />
              <div className="w-12 h-px bg-gradient-to-r from-transparent via-pink-400 to-transparent"></div>
            </div>
          </div>
        </div>
        
        {/* ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ */}
        <button
          onClick={() => setShowWelcome(false)}
          onMouseEnter={(e) => {
            e.currentTarget.style.boxShadow = '0 0 60px rgba(56, 189, 248, 0.8), 0 0 100px rgba(168, 85, 247, 0.6), 0 20px 60px rgba(236, 72, 153, 0.4)';
            e.currentTarget.style.transform = 'scale(1.1) translateY(-2px)';
          }}
          onMouseLeave={(e) => {
            e.currentTarget.style.boxShadow = '0 0 40px rgba(56, 189, 248, 0.6), 0 0 60px rgba(168, 85, 247, 0.4)';
            e.currentTarget.style.transform = 'scale(1) translateY(0)';
          }}
          className="group relative px-16 py-5 bg-white/10 backdrop-blur-md text-white rounded-2xl font-black text-2xl transition-all duration-300 animate-fade-in cursor-pointer border-2 border-white/30 overflow-hidden"
          style={{
            animationDelay: '0.9s',
            boxShadow: '0 0 40px rgba(56, 189, 248, 0.6), 0 0 60px rgba(168, 85, 247, 0.4)'
          }}
        >
          <div className="absolute inset-0 bg-gradient-to-r from-cyan-400/20 via-purple-400/20 to-pink-400/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div className="relative flex items-center gap-3">
            <Sparkles className="animate-spin-slow" size={28} />
            <span style={{textShadow: '0 0 20px rgba(56, 189, 248, 0.8)'}}>START</span>
            <div className="w-2 h-2 bg-cyan-300 rounded-full animate-ping"></div>
          </div>
        </button>
        
        {/* è£œè¶³ãƒ†ã‚­ã‚¹ãƒˆ */}
        <p 
          className="mt-8 text-sm text-white/80 animate-fade-in drop-shadow-lg" 
          style={{animationDelay: '1.2s'}}
        >
          Enterã‚­ãƒ¼ã§ã‚‚ã‚¹ã‚¿ãƒ¼ãƒˆã§ãã¾ã™
        </p>
      </div>
    </div>
  );
}

  // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã®è¡¨ç¤º
  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-violet-100 via-fuchsia-100 to-cyan-100 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-purple-600 mx-auto mb-4"></div>
          <p className="text-lg font-bold text-gray-700">ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
      </div>
    );
  }

  // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª
  return (
  <div className="min-h-screen relative">
    <video 
  key="main-video"
  autoPlay 
  loop 
  muted 
  playsInline
  className="fixed inset-0 -z-10 w-full h-full object-cover"
>
  <source src="assets/bg-image-v4.mp4" type="video/mp4" />
</video>
    <div className="fixed inset-0 -z-10 bg-gradient-to-b from-black/40 via-black/30 to-black/50" />
<header className="bg-white/10 backdrop-blur-md shadow-lg sticky top-0 z-10 border-b border-white/20" style={{boxShadow: '0 0 30px rgba(56, 189, 248, 0.3), 0 4px 6px rgba(0,0,0,0.1)'}}>
  <div className="max-w-5xl mx-auto px-3 py-4">
    <div className="flex items-center justify-between">
      <div className="flex items-center gap-2">
        <div 
          className="bg-white/20 backdrop-blur-sm p-2 rounded-xl border border-white/30"
          style={{boxShadow: '0 0 20px rgba(56, 189, 248, 0.4)'}}
        >
          <Sparkles className="text-cyan-300" size={24} />
        </div>
        <h1 
          className="text-2xl font-black text-white" 
          style={{textShadow: '0 0 30px rgba(56, 189, 248, 0.8), 0 0 60px rgba(168, 85, 247, 0.4)'}}
        >
          ãƒ‰ãƒ©ã‚¯ã‚¨10 è·äººæ”¯æ´ãƒ„ãƒ¼ãƒ«
        </h1>
      </div>
    </div>
    
    <div className="mt-4 flex gap-2 px-1">
      <div className="relative flex-1">
        <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-cyan-300" size={18} />
        <input
          type="text"
          placeholder="å•†æåã‚’æ¤œç´¢ã—ã¦ãã ã•ã„.."
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
          onKeyPress={handleKeyPress}
          className="w-full pl-10 pr-3 py-3 rounded-xl bg-white/10 backdrop-blur-sm border border-white/30 focus:outline-none focus:ring-2 focus:ring-cyan-400/50 focus:border-cyan-400 shadow-md text-sm text-white placeholder-white/60"
          style={{boxShadow: '0 0 20px rgba(56, 189, 248, 0.2)'}}
        />
      </div>
      <button
        onClick={handleSearch}
        onMouseEnter={(e) => {
          e.currentTarget.style.boxShadow = '0 0 40px rgba(56, 189, 248, 0.8), 0 0 60px rgba(56, 189, 248, 0.5)';
          e.currentTarget.style.transform = 'scale(1.05)';
        }}
        onMouseLeave={(e) => {
          e.currentTarget.style.boxShadow = '0 0 20px rgba(56, 189, 248, 0.4)';
          e.currentTarget.style.transform = 'scale(1)';
        }}
        className="px-6 py-3 bg-gradient-to-r from-cyan-500/80 to-blue-500/80 backdrop-blur-sm text-white rounded-xl font-bold text-sm shadow-md transition-all whitespace-nowrap border border-cyan-300/50"
        style={{boxShadow: '0 0 20px rgba(56, 189, 248, 0.4)'}}
      >
        æ¤œç´¢
      </button>
      <button
        onClick={handleReset}
        onMouseEnter={(e) => {
          e.currentTarget.style.boxShadow = '0 0 40px rgba(168, 85, 247, 0.6)';
          e.currentTarget.style.transform = 'scale(1.05)';
        }}
        onMouseLeave={(e) => {
          e.currentTarget.style.boxShadow = '';
          e.currentTarget.style.transform = 'scale(1)';
        }}
        className="px-6 py-3 bg-white/10 backdrop-blur-sm hover:bg-white/20 text-white rounded-xl font-bold text-sm shadow-md transition-all whitespace-nowrap border border-white/30"
      >
        ãƒªã‚»ãƒƒãƒˆ
      </button>
    </div>
  </div>
  <div className="h-3"></div>
</header>

      <div className="max-w-5xl mx-auto px-3 py-4">
        <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
  {categories.map((cat, idx) => {
    const colors = [
      'from-orange-500 to-amber-500',      // æ­¦å™¨é›å†¶ â†’ ã‚ªãƒ¬ãƒ³ã‚¸
      'from-purple-500 to-violet-500',     // é˜²å…·é›å†¶ â†’ ãƒ‘ãƒ¼ãƒ—ãƒ«
      'from-pink-500 to-rose-500',         // é“å…·é›å†¶ â†’ ãƒ”ãƒ³ã‚¯
      'from-cyan-500 to-blue-500',         // è£ç¸« â†’ ã‚·ã‚¢ãƒ³ï¼ˆé’ï¼‰
      'from-emerald-500 to-teal-500',      // æœ¨å·¥ â†’ ã‚°ãƒªãƒ¼ãƒ³
      'from-indigo-500 to-purple-500',     // æ–™ç† â†’ ã‚¤ãƒ³ãƒ‡ã‚£ã‚´
      'from-green-500 to-emerald-500'      // åç›Šç®¡ç† â†’ ã‚°ãƒªãƒ¼ãƒ³
    ];
    const glowColors = [
      'rgba(251, 146, 60, 0.6)',           // æ­¦å™¨é›å†¶ â†’ ã‚ªãƒ¬ãƒ³ã‚¸
      'rgba(168, 85, 247, 0.6)',           // é˜²å…·é›å†¶ â†’ ãƒ‘ãƒ¼ãƒ—ãƒ«
      'rgba(236, 72, 153, 0.6)',           // é“å…·é›å†¶ â†’ ãƒ”ãƒ³ã‚¯
      'rgba(56, 189, 248, 0.6)',           // è£ç¸« â†’ ã‚·ã‚¢ãƒ³ï¼ˆé’ï¼‰
      'rgba(16, 185, 129, 0.6)',           // æœ¨å·¥ â†’ ã‚°ãƒªãƒ¼ãƒ³
      'rgba(99, 102, 241, 0.6)',           // æ–™ç† â†’ ã‚¤ãƒ³ãƒ‡ã‚£ã‚´
      'rgba(34, 197, 94, 0.6)'             // åç›Šç®¡ç† â†’ ã‚°ãƒªãƒ¼ãƒ³
    ];
    const isActive = activeCategory === cat;
    
    return (
      <button
        key={cat}
        onClick={() => {
          setActiveCategory(cat);
          setSelectedItem(null);
          setMaterialPrices({});
          setToolPrices({});
          if (cat === 'æ­¦å™¨é›å†¶') setSelectedWeaponType('ç‰‡æ‰‹å‰£');
          if (cat === 'é˜²å…·é›å†¶') setSelectedArmorType('å°ç›¾');
          if (cat === 'é“å…·é›å†¶') setSelectedToolType('ç´ æ');
          if (cat === 'è£ç¸«') setSelectedSewingType('ã‚¢ã‚¿ãƒ');
          if (cat === 'æœ¨å·¥') setSelectedWoodworkType('ã‚¹ãƒ†ã‚£ãƒƒã‚¯');
          if (cat === 'æ–™ç†') setSelectedCookingType('æ–™ç†å…¨éƒ¨');
        }}
        onMouseEnter={(e) => {
          e.currentTarget.style.boxShadow = `0 0 40px ${glowColors[idx % glowColors.length]}, 0 0 60px ${glowColors[idx % glowColors.length]}`;
          e.currentTarget.style.transform = 'scale(1.05)';
        }}
        onMouseLeave={(e) => {
          if (isActive) {
            e.currentTarget.style.boxShadow = `0 0 30px ${glowColors[idx % glowColors.length]}`;
            e.currentTarget.style.transform = 'scale(1.05)';
          } else {
            e.currentTarget.style.boxShadow = '';
            e.currentTarget.style.transform = 'scale(1)';
          }
        }}
        className={`px-5 py-2 rounded-xl font-bold text-sm whitespace-nowrap transition-all cursor-pointer ${
          isActive
            ? `bg-gradient-to-r ${colors[idx % colors.length]} text-white shadow-lg scale-105 border border-white/30`
            : 'bg-white/10 backdrop-blur-sm text-white shadow-sm border border-white/30'
        }`}
        style={isActive ? {boxShadow: `0 0 30px ${glowColors[idx % glowColors.length]}`} : {}}
      >
        {cat}
      </button>
    );
  })}
</div>
        
        {/* ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªè¡¨ç¤º */}
        {activeCategory === 'æ­¦å™¨é›å†¶' && (
  <div className="mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
    {weaponTypes.map((type) => (
      <button
        key={type}
        onClick={() => setSelectedWeaponType(type)}
        onMouseEnter={(e) => {
          e.currentTarget.style.boxShadow = '0 0 30px rgba(251, 146, 60, 0.6), 0 0 50px rgba(251, 146, 60, 0.4)';
          e.currentTarget.style.transform = 'scale(1.05)';
        }}
        onMouseLeave={(e) => {
          if (selectedWeaponType === type) {
            e.currentTarget.style.boxShadow = '0 0 20px rgba(251, 146, 60, 0.5)';
            e.currentTarget.style.transform = 'scale(1.05)';
          } else {
            e.currentTarget.style.boxShadow = '';
            e.currentTarget.style.transform = 'scale(1)';
          }
        }}
        className={`px-4 py-1.5 rounded-lg font-bold text-xs whitespace-nowrap transition-all cursor-pointer ${
          selectedWeaponType === type
            ? 'bg-gradient-to-r from-orange-500 to-amber-500 text-white shadow-lg border border-orange-300/50 scale-105'
            : 'bg-white/10 backdrop-blur-sm text-white/80 border border-white/30 hover:bg-white/20'
        }`}
        style={selectedWeaponType === type ? {boxShadow: '0 0 20px rgba(251, 146, 60, 0.5)'} : {}}
      >
        {type}
      </button>
    ))}
  </div>
)}
        
        {activeCategory === 'é˜²å…·é›å†¶' && (
  <div className="mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
    {armorTypes.map((type) => (
      <button
        key={type}
        onClick={() => setSelectedArmorType(type)}
        onMouseEnter={(e) => {
          e.currentTarget.style.boxShadow = '0 0 30px rgba(168, 85, 247, 0.6), 0 0 50px rgba(168, 85, 247, 0.4)';
          e.currentTarget.style.transform = 'scale(1.05)';
        }}
        onMouseLeave={(e) => {
          if (selectedArmorType === type) {
            e.currentTarget.style.boxShadow = '0 0 20px rgba(168, 85, 247, 0.5)';
            e.currentTarget.style.transform = 'scale(1.05)';
          } else {
            e.currentTarget.style.boxShadow = '';
            e.currentTarget.style.transform = 'scale(1)';
          }
        }}
        className={`px-4 py-1.5 rounded-lg font-bold text-xs whitespace-nowrap transition-all cursor-pointer ${
          selectedArmorType === type
            ? 'bg-gradient-to-r from-purple-500 to-violet-500 text-white shadow-lg border border-purple-300/50 scale-105'
            : 'bg-white/10 backdrop-blur-sm text-white/80 border border-white/30 hover:bg-white/20'
        }`}
        style={selectedArmorType === type ? {boxShadow: '0 0 20px rgba(168, 85, 247, 0.5)'} : {}}
      >
        {type}
      </button>
    ))}
  </div>
)}
        
        {activeCategory === 'é“å…·é›å†¶' && (
  <div className="mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
    {toolTypes.map((type) => (
      <button
        key={type}
        onClick={() => setSelectedToolType(type)}
        onMouseEnter={(e) => {
          e.currentTarget.style.boxShadow = '0 0 30px rgba(236, 72, 153, 0.6), 0 0 50px rgba(236, 72, 153, 0.4)';
          e.currentTarget.style.transform = 'scale(1.05)';
        }}
        onMouseLeave={(e) => {
          if (selectedToolType === type) {
            e.currentTarget.style.boxShadow = '0 0 20px rgba(236, 72, 153, 0.5)';
            e.currentTarget.style.transform = 'scale(1.05)';
          } else {
            e.currentTarget.style.boxShadow = '';
            e.currentTarget.style.transform = 'scale(1)';
          }
        }}
        className={`px-4 py-1.5 rounded-lg font-bold text-xs whitespace-nowrap transition-all cursor-pointer ${
          selectedToolType === type
            ? 'bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow-lg border border-pink-300/50 scale-105'
            : 'bg-white/10 backdrop-blur-sm text-white/80 border border-white/30 hover:bg-white/20'
        }`}
        style={selectedToolType === type ? {boxShadow: '0 0 20px rgba(236, 72, 153, 0.5)'} : {}}
      >
        {type}
      </button>
    ))}
  </div>
)}
        
        {activeCategory === 'è£ç¸«' && (
  <div className="mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
    {sewingTypes.map((type) => (
      <button
        key={type}
        onClick={() => setSelectedSewingType(type)}
        onMouseEnter={(e) => {
          e.currentTarget.style.boxShadow = '0 0 30px rgba(56, 189, 248, 0.6), 0 0 50px rgba(56, 189, 248, 0.4)';
          e.currentTarget.style.transform = 'scale(1.05)';
        }}
        onMouseLeave={(e) => {
          if (selectedSewingType === type) {
            e.currentTarget.style.boxShadow = '0 0 20px rgba(56, 189, 248, 0.5)';
            e.currentTarget.style.transform = 'scale(1.05)';
          } else {
            e.currentTarget.style.boxShadow = '';
            e.currentTarget.style.transform = 'scale(1)';
          }
        }}
        className={`px-4 py-1.5 rounded-lg font-bold text-xs whitespace-nowrap transition-all cursor-pointer ${
          selectedSewingType === type
            ? 'bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-lg border border-cyan-300/50 scale-105'
            : 'bg-white/10 backdrop-blur-sm text-white/80 border border-white/30 hover:bg-white/20'
        }`}
        style={selectedSewingType === type ? {boxShadow: '0 0 20px rgba(56, 189, 248, 0.5)'} : {}}
      >
        {type}
      </button>
    ))}
  </div>
)}
        
{activeCategory === 'æœ¨å·¥' && (
  <div className="mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
    {woodworkTypes.map((type) => (
      <button
        key={type}
        onClick={() => setSelectedWoodworkType(type)}
        onMouseEnter={(e) => {
          e.currentTarget.style.boxShadow = '0 0 30px rgba(16, 185, 129, 0.6), 0 0 50px rgba(16, 185, 129, 0.4)';
          e.currentTarget.style.transform = 'scale(1.05)';
        }}
        onMouseLeave={(e) => {
          if (selectedWoodworkType === type) {
            e.currentTarget.style.boxShadow = '0 0 20px rgba(16, 185, 129, 0.5)';
            e.currentTarget.style.transform = 'scale(1.05)';
          } else {
            e.currentTarget.style.boxShadow = '';
            e.currentTarget.style.transform = 'scale(1)';
          }
        }}
        className={`px-4 py-1.5 rounded-lg font-bold text-xs whitespace-nowrap transition-all cursor-pointer ${
          selectedWoodworkType === type
            ? 'bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg border border-emerald-300/50 scale-105'
            : 'bg-white/10 backdrop-blur-sm text-white/80 border border-white/30 hover:bg-white/20'
        }`}
        style={selectedWoodworkType === type ? {boxShadow: '0 0 20px rgba(16, 185, 129, 0.5)'} : {}}
      >
        {type}
      </button>
    ))}
  </div>
)}
        
{activeCategory === 'æ–™ç†' && (
  <div className="mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-hide px-1 py-1">
    {cookingTypes.map((type) => (
      <button
        key={type}
        onClick={() => setSelectedCookingType(type)}
        onMouseEnter={(e) => {
          e.currentTarget.style.boxShadow = '0 0 30px rgba(99, 102, 241, 0.6), 0 0 50px rgba(99, 102, 241, 0.4)';
          e.currentTarget.style.transform = 'scale(1.05)';
        }}
        onMouseLeave={(e) => {
          if (selectedCookingType === type) {
            e.currentTarget.style.boxShadow = '0 0 20px rgba(99, 102, 241, 0.5)';
            e.currentTarget.style.transform = 'scale(1.05)';
          } else {
            e.currentTarget.style.boxShadow = '';
            e.currentTarget.style.transform = 'scale(1)';
          }
        }}
        className={`px-4 py-1.5 rounded-lg font-bold text-xs whitespace-nowrap transition-all cursor-pointer ${
          selectedCookingType === type
            ? 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg border border-indigo-300/50 scale-105'
            : 'bg-white/10 backdrop-blur-sm text-white/80 border border-white/30 hover:bg-white/20'
        }`}
        style={selectedCookingType === type ? {boxShadow: '0 0 20px rgba(99, 102, 241, 0.5)'} : {}}
      >
        {type}
      </button>
    ))}
  </div>
)}
      </div>


      {/* ğŸ†• ãƒ”ãƒ³ç•™ã‚ã‚µãƒãƒªãƒ¼ */}
      {isPinned && activeCategory !== 'åç›Šç®¡ç†' && (
        <div className="max-w-5xl mx-auto px-3 pb-3">
          <div className="bg-gradient-to-r from-green-500/90 to-emerald-500/90 backdrop-blur-sm rounded-xl p-3 shadow-lg border border-green-300/50 flex items-center justify-between">
            <div className="flex items-center gap-4">
              <TrendingUp className="text-white" size={24} />
              <div>
                <div className="text-white text-xs font-bold opacity-90">
                  {profitView === 'today' ? 'ä»Šæ—¥ã®åç›Š' : 'ä»Šæœˆã®åç›Š'}
                </div>
                <div className="text-white text-xl font-black">
                  {calculateSummary(profitView).profit >= 0 ? '+' : ''}
                  {calculateSummary(profitView).profit.toLocaleString()} G
                </div>
              </div>
            </div>
            <button
              onClick={togglePin}
              className="px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg transition-all text-white text-sm font-bold"
            >
              ğŸ“Œ è§£é™¤
            </button>
          </div>
        </div>
      )}

      <div className="max-w-5xl mx-auto px-3 pb-6 pt-6">
        {/* ğŸ†• åç›Šç®¡ç†ã‚«ãƒ†ã‚´ãƒª */}
        {activeCategory === 'åç›Šç®¡ç†' ? (
          <div className="space-y-4">
            {/* åç›Šã‚µãƒãƒªãƒ¼ */}
            <div className="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 shadow-xl">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-3">
                  <TrendingUp className="text-amber-300" size={32} />
                  <h2 className="text-2xl font-black text-white">åç›Šã‚µãƒãƒªãƒ¼</h2>
                </div>
                <div className="flex gap-2">
                  <button
                    onClick={() => setProfitView('today')}
                    className={`px-4 py-2 rounded-lg font-bold text-sm transition-all ${
                      profitView === 'today'
                        ? 'bg-amber-500/90 text-white shadow-lg'
                        : 'bg-white/20 text-white/80'
                    }`}
                  >
                    ä»Šæ—¥
                  </button>
                  <button
                    onClick={() => setProfitView('month')}
                    className={`px-4 py-2 rounded-lg font-bold text-sm transition-all ${
                      profitView === 'month'
                        ? 'bg-amber-500/90 text-white shadow-lg'
                        : 'bg-white/20 text-white/80'
                    }`}
                  >
                    ä»Šæœˆ
                  </button>
                  <button
                    onClick={togglePin}
                    className={`px-4 py-2 rounded-lg font-bold text-sm transition-all ${
                      isPinned
                        ? 'bg-green-500/90 text-white shadow-lg'
                        : 'bg-white/20 text-white/80'
                    }`}
                  >
                    <Pin size={16} className="inline mr-1" />
                    {isPinned ? 'ON' : 'OFF'}
                  </button>
                </div>
              </div>
              
              {(() => {
                const summary = calculateSummary(profitView);
                return (
                  <div className="grid grid-cols-3 gap-4">
                    <div className="bg-blue-500/20 backdrop-blur-sm rounded-xl p-4 border border-blue-300/30">
                      <div className="text-white/80 text-sm font-bold mb-1">ç·å£²ä¸Š</div>
                      <div className="text-white text-2xl font-black">
                        {summary.totalIncome.toLocaleString()} G
                      </div>
                    </div>
                    <div className="bg-red-500/20 backdrop-blur-sm rounded-xl p-4 border border-red-300/30">
                      <div className="text-white/80 text-sm font-bold mb-1">ç·ã‚³ã‚¹ãƒˆ</div>
                      <div className="text-white text-2xl font-black">
                        {summary.totalCost.toLocaleString()} G
                      </div>
                    </div>
                    <div className={`${summary.profit >= 0 ? 'bg-green-500/20 border-green-300/30' : 'bg-red-500/20 border-red-300/30'} backdrop-blur-sm rounded-xl p-4 border`}>
                      <div className="text-white/80 text-sm font-bold mb-1">ç´”åˆ©ç›Š</div>
                      <div className={`text-3xl font-black ${summary.profit >= 0 ? 'text-green-300' : 'text-red-300'}`}>
                        {summary.profit >= 0 ? '+' : ''}{summary.profit.toLocaleString()} G
                      </div>
                    </div>
                  </div>
                );
              })()}
              
              <div className="mt-4 text-white/60 text-sm text-center">
                è¨˜éŒ²æ•°: {calculateSummary(profitView).count} ä»¶
              </div>
            </div>
            
            {/* ä¿å­˜ã•ã‚ŒãŸè¨˜éŒ²ä¸€è¦§ */}
            <div className="space-y-3">
              {savedRecords.map((record) => (
                <div
                  key={record.id}
                  className="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20 shadow-lg"
                >
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-2">
                        <span className="text-xs font-bold bg-amber-500/80 text-white px-2 py-0.5 rounded-full">
                          {record.category}
                        </span>
                        <span className="text-white font-bold">{record.itemName}</span>
                        <span className="text-white/60 text-xs">
                          Ã—{record.quantity}å›
                        </span>
                      </div>
                      
                      <div className="text-white/80 text-sm mb-2">
                        {new Date(record.timestamp).toLocaleString('ja-JP', {
                          month: '2-digit',
                          day: '2-digit',
                          hour: '2-digit',
                          minute: '2-digit'
                        })}
                      </div>
                      
                      <div className="grid grid-cols-3 gap-2 text-sm">
                        <div>
                          <span className="text-white/60">å£²ä¸Š: </span>
                          <span className="text-blue-300 font-bold">
                            {record.totalIncome.toLocaleString()}G
                          </span>
                        </div>
                        <div>
                          <span className="text-white/60">ã‚³ã‚¹ãƒˆ: </span>
                          <span className="text-red-300 font-bold">
                            {record.totalCost.toLocaleString()}G
                          </span>
                        </div>
                        <div>
                          <span className="text-white/60">åˆ©ç›Š: </span>
                          <span className={`font-black ${record.profit >= 0 ? 'text-green-300' : 'text-red-300'}`}>
                            {record.profit >= 0 ? '+' : ''}{record.profit.toLocaleString()}G
                          </span>
                        </div>
                      </div>
                    </div>
                    
                    <button
                      onClick={() => deleteRecord(record.id)}
                      className="ml-4 px-3 py-1.5 bg-red-500/80 hover:bg-red-600/80 text-white rounded-lg text-xs font-bold transition-all"
                    >
                      å‰Šé™¤
                    </button>
                  </div>
                </div>
              ))}
              
              {savedRecords.length === 0 && (
                <div className="text-center py-12">
                  <div className="text-4xl mb-3">ğŸ“Š</div>
                  <p className="text-lg font-bold text-white/60">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>
                  <p className="text-white/40 mt-1 text-sm">æˆæœã‚’ä¿å­˜ã™ã‚‹ã¨ã€ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                </div>
              )}
            </div>
          </div>
        ) : filteredItems.length === 0 ? (
          <div className="text-center py-12">
            <div className="text-4xl mb-3">ğŸ”</div>
            <p className="text-lg font-bold text-white/60">è©²å½“ã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>
            <p className="text-white/40 mt-1 text-sm">åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„</p>
          </div>
        ) : (
          <div className="grid gap-12">
{filteredItems.map((item, index) => {
              const isSelected = selectedItem === item.name;
              return (
                <div
  key={index}
  onClick={() => {
    setSelectedItem(isSelected ? null : item.name);
  }}
  style={{
    transition: 'all 0.3s ease',
    boxShadow: isSelected ? '0 0 40px rgba(56, 189, 248, 0.6)' : '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
    transform: isSelected ? 'scale(1.02)' : 'scale(1)',
    outline: isSelected ? '2px solid rgb(56, 189, 248)' : 'none'
  }}
  onMouseEnter={(e) => {
    e.currentTarget.style.boxShadow = '0 0 40px rgba(56, 189, 248, 0.6)';
    e.currentTarget.style.transform = 'scale(1.02)';
    e.currentTarget.style.outline = '2px solid rgb(56, 189, 248)';
  }}
  onMouseLeave={(e) => {
    if (!isSelected) {
      e.currentTarget.style.boxShadow = '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)';
      e.currentTarget.style.transform = 'scale(1)';
      e.currentTarget.style.outline = 'none';
    } else {
      e.currentTarget.style.boxShadow = '0 0 40px rgba(56, 189, 248, 0.6)';
      e.currentTarget.style.transform = 'scale(1.02)';
      e.currentTarget.style.outline = '2px solid rgb(56, 189, 248)';
    }
  }}
  className="bg-white/10 backdrop-blur-md rounded-2xl overflow-hidden cursor-pointer relative border border-white/20 shadow-xl"
>
<div className="bg-gradient-to-r from-cyan-500/80 via-purple-500/80 to-pink-500/80 backdrop-blur-sm p-4 text-white relative overflow-hidden border-b border-white/30" style={{boxShadow: '0 0 30px rgba(56, 189, 248, 0.4), 0 0 50px rgba(168, 85, 247, 0.3)'}}>
  <div className="absolute top-0 right-0 w-24 h-24 bg-white/10 rounded-full -mr-12 -mt-12"></div>
  <div className="absolute bottom-0 left-0 w-20 h-20 bg-white/10 rounded-full -ml-10 -mb-10"></div>
  <div className="relative flex items-center justify-between">
    <div>
      <span className="text-xs font-bold bg-white/30 px-3 py-0.5 rounded-full backdrop-blur-sm">{item.category}</span>
      <div className="flex items-center gap-2 mt-2">
        <h2 className="text-2xl font-black drop-shadow-lg" style={{textShadow: '0 0 20px rgba(255, 255, 255, 0.5)'}}>{item.name}</h2>
        {item.specialTrait && (
          <span className="px-3 py-1 bg-yellow-400 text-yellow-900 rounded-full text-xs font-bold shadow-md">
            {item.specialTrait}
          </span>
        )}
        <button
          onClick={(e) => {
            e.stopPropagation();
            openRecipeWindow(item);
          }}
          className="ml-2 px-3 py-1 bg-white/20 hover:bg-white/30 rounded-lg font-bold text-xs transition-all backdrop-blur-sm border border-white/30 transform hover:scale-105"
          style={{boxShadow: '0 0 10px rgba(255, 255, 255, 0.2)'}}
        >
          ğŸ“‹ ãƒ¬ã‚·ãƒ”
        </button>
      </div>
    </div>
    {item.category === 'æ–™ç†' ? (
      <UtensilsCrossed size={32} className="opacity-90 drop-shadow-lg" />
    ) : (
      <Package size={32} className="opacity-90 drop-shadow-lg" />
    )}
  </div>
</div>

                  <div className="p-4">
  <h3 className="text-sm font-black text-white drop-shadow-lg mb-3 flex items-center gap-2" style={{textShadow: '0 0 20px rgba(56, 189, 248, 0.6)'}}>
    <span className="text-xl">ğŸ¯</span>
    <span>ç›®æ¨™æ•°å€¤</span>
  </h3>
  {renderTargetValues(item)}
</div>

                  <div className="px-4 pb-4">
  <h3 className="text-sm font-black text-white drop-shadow-lg mb-3 flex items-center gap-2" style={{textShadow: '0 0 20px rgba(168, 85, 247, 0.6)'}}>
    <span className="text-xl">ğŸ“¦</span>
    <span>å¿…è¦ç´ æ</span>
  </h3>
  <div className="space-y-2">
    {item.materials.map((material, idx) => (
      <div
        key={idx}
        className="p-4 bg-white/10 backdrop-blur-md rounded-xl border border-white/30"
        style={{boxShadow: '0 0 20px rgba(168, 85, 247, 0.2)'}}
      >
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            <span className="font-bold text-white text-sm drop-shadow">{material.name}</span>
            <span 
              className="px-2.5 py-0.5 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-full font-black shadow-md text-xs"
              style={{boxShadow: '0 0 15px rgba(236, 72, 153, 0.5)'}}
            >
              Ã—{material.quantity}
            </span>
          </div>
          {isSelected && (
            <div className="flex items-center gap-1.5">
              <input
                type="text"
                inputMode="numeric"
                placeholder="å˜ä¾¡"
                value={formatNumber(materialPrices[`${item.name}-${material.name}`] || '')}
                onClick={(e) => e.stopPropagation()}
                onChange={(e) => {
                  const value = e.target.value.replace(/[^0-9]/g, '');
                  updatePrice(item.name, material.name, value);
                }}
                className="w-24 px-3 py-2 rounded-lg border-2 border-purple-400/50 bg-white/10 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400 font-bold text-right text-base text-white placeholder-white/50"
                style={{boxShadow: '0 0 15px rgba(168, 85, 247, 0.3)'}}
              />
              <span className="text-white/80 font-bold text-sm drop-shadow">G</span>
            </div>
          )}
        </div>
      </div>
    ))}
  </div>
                    
{isSelected && (
  <div className="mt-3 p-4 bg-white/10 backdrop-blur-md rounded-xl border border-white/30" style={{boxShadow: '0 0 20px rgba(168, 85, 247, 0.3)'}}>
    <div className="flex items-center justify-between">
      <div className="flex items-center gap-2">
        <span className="font-bold text-white text-sm drop-shadow">ğŸ”§ è·äººé“å…·ä»£</span>
        <span className="text-xs text-white/60">(è‡ªå‹•ã§Ã·30)</span>
      </div>
      <div className="flex items-center gap-2">
        <input
          type="text"
          inputMode="numeric"
          placeholder="é“å…·ä»£"
          value={formatNumber(toolPrices[item.name] || '')}
          onClick={(e) => e.stopPropagation()}
          onChange={(e) => {
            const value = e.target.value.replace(/[^0-9]/g, '');
            setToolPrices(prev => ({
              ...prev,
              [item.name]: value === '' ? 0 : parseInt(value) || 0
            }));
          }}
          className="w-28 px-3 py-2 rounded-lg border-2 border-purple-400/50 bg-white/10 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400 font-bold text-right text-base text-white placeholder-white/50"
          style={{boxShadow: '0 0 15px rgba(168, 85, 247, 0.3)'}}
        />
        <span className="text-white/80 font-bold text-sm drop-shadow">G</span>
      </div>
    </div>
    {toolPrices[item.name] > 0 && (
      <div className="mt-2 text-right text-xs text-white/60">
        <span className="font-bold">1å›ã‚ãŸã‚Š: {Math.floor(toolPrices[item.name] / 30).toLocaleString()} G</span>
      </div>
    )}
  </div>
)}
                    
                    {isSelected && (
  <div className="mt-3 p-4 bg-white/10 backdrop-blur-md rounded-xl border border-white/30" style={{boxShadow: '0 0 20px rgba(56, 189, 248, 0.3)'}}>
    <div className="flex items-center justify-between mb-3">
      <span className="font-bold text-white text-sm flex items-center gap-2 drop-shadow">
        <span className="text-xl">ğŸ”¢</span>
        <span>ä½œæˆå›æ•°</span>
      </span>
      <div className="flex items-center gap-2">
        <input
          type="text"
          inputMode="numeric"
          placeholder="å›æ•°"
          value={craftQuantity[item.name] || 1}
          onClick={(e) => e.stopPropagation()}
          onFocus={(e) => {
            if ((craftQuantity[item.name] || 1) === 1) {
              e.target.value = '';
            }
          }}
          onBlur={(e) => {
            if (e.target.value === '') {
              setCraftQuantity(prev => ({
                ...prev,
                [item.name]: 1
              }));
            }
          }}
          onChange={(e) => {
            const value = e.target.value.replace(/[^0-9]/g, '');
            setCraftQuantity(prev => ({
              ...prev,
              [item.name]: value === '' ? '' : parseInt(value) || 1
            }));
          }}
          className="w-20 px-3 py-2 rounded-lg border-2 border-cyan-400/50 bg-white/10 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 font-bold text-right text-base text-white placeholder-white/50"
          style={{boxShadow: '0 0 15px rgba(56, 189, 248, 0.3)'}}
        />
        <span className="text-white/80 font-bold text-sm drop-shadow">å›</span>
      </div>
    </div>
    <div className="flex gap-2">
      {[1, 5, 10, 30].map((num) => (
        <button
          key={num}
          onClick={(e) => {
            e.stopPropagation();
            setCraftQuantity(prev => ({
              ...prev,
              [item.name]: num
            }));
          }}
          className={`flex-1 px-3 py-2 rounded-lg font-bold text-sm transition-all transform hover:scale-105 cursor-pointer ${
            (craftQuantity[item.name] || 1) === num
              ? 'bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-lg border border-cyan-300/50'
              : 'bg-white/10 backdrop-blur-sm text-white border border-white/30 hover:bg-white/20'
          }`}
          style={(craftQuantity[item.name] || 1) === num ? {boxShadow: '0 0 20px rgba(56, 189, 248, 0.5)'} : {}}
        >
          Ã—{num}
        </button>
      ))}
    </div>
  </div>
)}
                    
                    {isSelected && (
  <div className="mt-3 p-4 bg-gradient-to-br from-rose-400/90 via-pink-400/90 to-fuchsia-500/90 backdrop-blur-sm rounded-xl border border-rose-300/50" style={{boxShadow: '0 0 30px rgba(244, 114, 182, 0.6), 0 0 50px rgba(244, 114, 182, 0.3), 0 4px 6px rgba(0,0,0,0.1)'}}>
    <div className="flex items-center justify-between text-white">
      <span className="text-lg font-black drop-shadow">Total Cost:</span>
                          <div className="flex items-center gap-3">
                            <span className="text-2xl font-black drop-shadow">{calculateTotal(item).toLocaleString()} G</span>
                            <button
  onClick={(e) => {
    e.stopPropagation();
    const newMaterialPrices = { ...materialPrices };
    item.materials.forEach(material => {
      delete newMaterialPrices[`${item.name}-${material.name}`];
    });
    setMaterialPrices(newMaterialPrices);
    
    const newToolPrices = { ...toolPrices };
    delete newToolPrices[item.name];
    setToolPrices(newToolPrices);
    
    const newCraftQuantity = { ...craftQuantity };
    delete newCraftQuantity[item.name];
    setCraftQuantity(newCraftQuantity);
    
    const newSellPrices = { ...sellPrices };
    delete newSellPrices[item.name];
    setSellPrices(newSellPrices);
    
    const newCraftResults = { ...craftResults };
    delete newCraftResults[item.name];
    setCraftResults(newCraftResults);
    
    const newBazaarMode = { ...bazaarMode };
    delete newBazaarMode[item.name];
    setBazaarMode(newBazaarMode);
  }}
  className="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg font-bold text-sm transition-all backdrop-blur-sm border border-white/30 transform hover:scale-105 cursor-pointer"
>
  ã‚¯ãƒªã‚¢
</button>
                          </div>
                        </div>
                      </div>
                    )}
                    
                    {isSelected && (
  <div className="mt-3 p-4 bg-gradient-to-br from-amber-50/80 via-yellow-50/80 to-orange-50/80 backdrop-blur-sm rounded-xl shadow-lg border border-amber-200/50">
    <div className="flex items-center justify-between mb-3">
  <h4 className="text-sm font-black text-amber-900 flex items-center gap-2">
    <span className="text-xl">ğŸ’°</span>
    <span>å£²å´äºˆå®šé¡</span>
  </h4>
      <div className="flex gap-1 bg-amber-100/50 rounded-lg p-1 shadow-sm backdrop-blur-sm">
  <button
    onClick={(e) => {
      e.stopPropagation();
      setBazaarMode(prev => ({...prev, [item.name]: true}));
    }}
    className={`px-3 py-1 rounded-md text-xs font-bold transition-all ${
      (bazaarMode[item.name] ?? true)
        ? 'bg-gradient-to-r from-amber-500 to-yellow-500 text-white shadow-md' 
        : 'text-amber-700 hover:bg-amber-200/50'
    }`}
  >
    ãƒã‚¶ãƒ¼
  </button>
        <button
          onClick={(e) => {
            e.stopPropagation();
            setBazaarMode(prev => ({...prev, [item.name]: false}));
          }}
          className={`px-3 py-1 rounded-md text-xs font-bold transition-all ${
            (bazaarMode[item.name] ?? true) === false
               ? 'bg-gradient-to-r from-amber-500 to-yellow-500 text-white shadow-md' 
        : 'text-amber-700 hover:bg-amber-200/50'
          }`}
        >
          ãƒ¢ãƒ¼ãƒ¢ãƒ³
        </button>
      </div>
    </div>
    
    {item.category === 'é“å…·é›å†¶' && item.subCategory === 'ç´ æ' ? (
      <div className="flex flex-col">
        <label className="text-xs font-bold text-gray-700 mb-1">ç´ æã®å˜ä¾¡</label>
        <div className="flex items-center gap-1">
          <input
            type="text"
            inputMode="numeric"
            placeholder="0"
            value={formatNumber(sellPrices[item.name]?.unitPrice || '')}
            onClick={(e) => e.stopPropagation()}
            onChange={(e) => {
              const value = e.target.value.replace(/[^0-9]/g, '');
              setSellPrices(prev => ({
                ...prev,
                [item.name]: {
                  ...prev[item.name],
                  unitPrice: value === '' ? 0 : parseInt(value) || 0
                }
              }));
            }}
            className="flex-1 px-3 py-2 rounded-lg border-2 border-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 font-bold text-right text-base"
          />
          <span className="text-gray-600 font-bold text-sm">G</span>
        </div>
        {sellPrices[item.name]?.unitPrice > 0 && (
          <span className="text-xs text-gray-600 mt-0.5 text-right">
            {(bazaarMode[item.name] ?? true) 
              ? `æ‰‹å–ã‚Š: ${Math.floor(sellPrices[item.name].unitPrice * 0.95).toLocaleString()}G`
              : `æ‰‹å–ã‚Š: ${sellPrices[item.name].unitPrice.toLocaleString()}G`
            }
          </span>
        )}
      </div>
    ) : (
      <div className="grid grid-cols-1 gap-2">
        {[
          { key: 'star3', label: 'â˜†â˜†â˜†', color: 'from-yellow-400 to-orange-400' },
          { key: 'star2', label: 'â˜†â˜†', color: 'from-gray-300 to-gray-400' },
          { key: 'star1', label: 'â˜†', color: 'from-orange-300 to-amber-400' },
          { key: 'star0', label: 'â˜†ãªã—', color: 'from-gray-200 to-gray-300' }
        ].map(({ key, label, color }) => (
          <div key={key} className="flex flex-col">
            <label className="text-xs font-bold text-gray-700 mb-1">{label}</label>
            <div className="flex items-center gap-1">
              <input
                type="text"
                inputMode="numeric"
                placeholder="0"
                value={formatNumber(sellPrices[item.name]?.[key] || '')}
                onClick={(e) => e.stopPropagation()}
                onChange={(e) => {
                  const value = e.target.value.replace(/[^0-9]/g, '');
                  setSellPrices(prev => ({
                    ...prev,
                    [item.name]: {
                      ...prev[item.name],
                      [key]: value === '' ? 0 : parseInt(value) || 0
                    }
                  }));
                }}
                className="flex-1 px-3 py-2 rounded-lg border-2 border-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 font-bold text-right text-base"
              />
              <span className="text-gray-600 font-bold text-sm">G</span>
            </div>
            {sellPrices[item.name]?.[key] > 0 && (
              <span className="text-xs text-gray-600 mt-0.5 text-right">
                {(bazaarMode[item.name] ?? true) 
                  ? `æ‰‹å–ã‚Š: ${Math.floor(sellPrices[item.name][key] * 0.95).toLocaleString()}G`
                  : `æ‰‹å–ã‚Š: ${sellPrices[item.name][key].toLocaleString()}G`
                }
              </span>
            )}
          </div>
        ))}
      </div>
    )}
      </div>
)}
                        
{(() => {
  const prices = sellPrices[item.name] || {};
  const isMaterial = item.category === 'é“å…·é›å†¶' && item.subCategory === 'ç´ æ';
  const hasAnyPrice = isMaterial 
    ? prices.unitPrice 
    : (prices.star3 || prices.star2 || prices.star1 || prices.star0);
  
  if (!hasAnyPrice) return null;
  
  const totalCost = calculateTotal(item);
  const quantity = craftQuantity[item.name] || 1;
  const feeRate = (bazaarMode[item.name] ?? true) ? 0.95 : 1.0;
  
  if (isMaterial) {
    const unitPrice = Math.floor((prices.unitPrice || 0) * feeRate);
    const worstIncome = quantity * 3 * unitPrice;
    const needStar3 = Math.ceil((totalCost - worstIncome) / Math.max((10 - 3) * unitPrice, 1));
    const actualNeedStar3 = Math.max(0, Math.min(needStar3, quantity));
    const needPercentage = ((actualNeedStar3 / quantity) * 100).toFixed(1);
    const bestIncome = quantity * 10 * unitPrice;
    const isDefiniteLoss = bestIncome < totalCost;
    
    return (
      <div className="mt-3 p-3 bg-gradient-to-br from-orange-50/80 via-amber-50/80 to-yellow-50/80 backdrop-blur-sm rounded-lg shadow-md border border-orange-200/50">
  <div className="text-xs font-bold text-orange-900 mb-2 flex items-center gap-2">
    <span className="text-lg">ğŸ“Š</span>
    <span>é»’å­—ãƒ©ã‚¤ãƒ³ï¼ˆâ˜†â˜†â˜† å¿…è¦æ•°ï¼‰</span>
  </div>
        {isDefiniteLoss ? (
          <div className="text-sm text-red-600 font-bold">
            âš ï¸ ã“ã®ä¾¡æ ¼ã§ã¯å…¨ã¦â˜†â˜†â˜†ã§ã‚‚èµ¤å­—ç¢ºå®šã§ã™
          </div>
        ) : (
          <div className="text-sm">
            <div className="flex items-center justify-between">
              <span className="text-gray-700">æœ€ä½</span>
              <span className={`font-black ${actualNeedStar3 > quantity ? 'text-red-600' : 'text-green-600'}`}>
                {actualNeedStar3} å› / {quantity} å›
              </span>
            </div>
            <div className="flex items-center justify-between mt-1">
              <span className="text-gray-700">æˆåŠŸç‡</span>
              <span className={`font-black ${parseFloat(needPercentage) > 100 ? 'text-red-600' : 'text-green-600'}`}>
                {needPercentage}% ä»¥ä¸Š
              </span>
            </div>
            <div className="mt-2 text-xs text-gray-500">
              â€» â˜†â˜†â˜†ä»¥å¤–ã¯å…¨ã¦â˜†â˜†ï¼ˆ3å€‹ï¼‰ã¨ä»®å®š
            </div>
          </div>
        )}
      </div>
    );
  }
  
  const income3 = Math.floor((prices.star3 || 0) * feeRate);
  const income2 = Math.floor((prices.star2 || 0) * feeRate);
  const income1 = Math.floor((prices.star1 || 0) * feeRate);
  const income0 = Math.floor((prices.star0 || 0) * feeRate);
  const worstIncome = income0 * quantity;
  const needStar3 = Math.ceil((totalCost - worstIncome) / Math.max(income3 - income0, 1));
  const actualNeedStar3 = Math.max(0, Math.min(needStar3, quantity));
  const needPercentage = ((actualNeedStar3 / quantity) * 100).toFixed(1);
  const bestIncome = income3 * quantity;
  const isDefiniteLoss = bestIncome < totalCost;
  
  return (
    <div className="mt-3 p-3 bg-white rounded-lg border border-indigo-200">
      <div className="text-xs font-bold text-gray-700 mb-2">ğŸ“Š é»’å­—ãƒ©ã‚¤ãƒ³ï¼ˆâ˜†â˜†â˜† å¿…è¦æ•°ï¼‰</div>
      {isDefiniteLoss ? (
        <div className="text-sm text-red-600 font-bold">
          âš ï¸ ã“ã®ä¾¡æ ¼ã§ã¯å…¨ã¦â˜†â˜†â˜†ã§ã‚‚èµ¤å­—ç¢ºå®šã§ã™
        </div>
      ) : (
        <div className="text-sm">
          <div className="flex items-center justify-between">
            <span className="text-gray-700">æœ€ä½</span>
            <span className={`font-black ${actualNeedStar3 > quantity ? 'text-red-600' : 'text-green-600'}`}>
              {actualNeedStar3} å€‹ / {quantity} å›
            </span>
          </div>
          <div className="flex items-center justify-between mt-1">
            <span className="text-gray-700">æˆåŠŸç‡</span>
            <span className={`font-black ${parseFloat(needPercentage) > 100 ? 'text-red-600' : 'text-green-600'}`}>
              {needPercentage}% ä»¥ä¸Š
            </span>
          </div>
          <div className="mt-2 text-xs text-gray-500">
            â€» â˜†â˜†â˜†ä»¥å¤–ã¯å…¨ã¦â˜†ãªã—ã¨ä»®å®š
          </div>
        </div>
      )}
    </div>
  );
})()}
                    
{isSelected && (
 <div className="mt-3 p-4 bg-gradient-to-br from-emerald-50/80 via-teal-50/80 to-cyan-50/80 backdrop-blur-sm rounded-xl shadow-lg border border-emerald-200/50">
    <div className="flex items-center justify-between mb-3">
  <h4 className="text-sm font-black text-emerald-900 flex items-center gap-2">
    <span className="text-xl">ğŸ“</span>
    <span>æˆæœè¨˜éŒ²</span>
  </h4>
      
      {item.category === 'é“å…·é›å†¶' && item.subCategory === 'ç´ æ' && (
        <div className="flex gap-1 bg-emerald-100/50 rounded-lg p-1 shadow-sm backdrop-blur-sm">
  <button
    onClick={(e) => {
      e.stopPropagation();
      setCraftResults(prev => ({
        ...prev,
        [`${item.name}_mode`]: 'simple'
      }));
    }}
    className={`px-3 py-1 rounded-md text-xs font-bold transition-all ${
      (craftResults[`${item.name}_mode`] || 'simple') === 'simple'
        ? 'bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-md' 
        : 'text-emerald-700 hover:bg-emerald-200/50'
    }`}
  >
    å€‹æ•°å…¥åŠ›
  </button>
          <button
            onClick={(e) => {
              e.stopPropagation();
              setCraftResults(prev => ({
                ...prev,
                [`${item.name}_mode`]: 'detail'
              }));
            }}
            className={`px-3 py-1 rounded-md text-xs font-bold transition-all ${
              (craftResults[`${item.name}_mode`] || 'simple') === 'detail'
                ? 'bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-md' 
        : 'text-emerald-700 hover:bg-emerald-200/50'
            }`}
          >
            è©³ç´°å…¥åŠ›
          </button>
        </div>
      )}
    </div>
    
    {item.category === 'é“å…·é›å†¶' && item.subCategory === 'ç´ æ' && (craftResults[`${item.name}_mode`] || 'simple') === 'simple' ? (
      <div className="flex flex-col">
        <label className="text-xs font-bold text-gray-700 mb-1">ä½œæˆã§ããŸå€‹æ•°</label>
        <div className="flex items-center gap-1">
          <input
            type="text"
            inputMode="numeric"
            placeholder="0"
            value={craftResults[item.name]?.totalItems || ''}
            onClick={(e) => e.stopPropagation()}
            onChange={(e) => {
              const value = e.target.value.replace(/[^0-9]/g, '');
              setCraftResults(prev => ({
                ...prev,
                [item.name]: {
                  ...prev[item.name],
                  totalItems: value === '' ? 0 : parseInt(value) || 0
                }
              }));
            }}
            className="flex-1 px-3 py-2 rounded-lg border-2 border-emerald-300 focus:outline-none focus:ring-2 focus:ring-emerald-400 font-bold text-right text-base"
          />
          <span className="text-gray-600 font-bold text-sm">å€‹</span>
        </div>
      </div>
    ) : (
      <>
        <div className="grid grid-cols-1 gap-2">
          {[
            { key: 'star3', label: item.category === 'é“å…·é›å†¶' && item.subCategory === 'ç´ æ' ? 'â˜†â˜†â˜†(10å€‹)' : 'â˜†â˜†â˜†' },
            { key: 'star2', label: item.category === 'é“å…·é›å†¶' && item.subCategory === 'ç´ æ' ? 'â˜†â˜†(3å€‹)' : 'â˜†â˜†' },
            { key: 'star1', label: item.category === 'é“å…·é›å†¶' && item.subCategory === 'ç´ æ' ? 'â˜†(2å€‹)' : 'â˜†' },
            { key: 'star0', label: item.category === 'é“å…·é›å†¶' && item.subCategory === 'ç´ æ' ? 'â˜†ãªã—(1å€‹)' : 'â˜†ãªã—' },
            { key: 'fail', label: item.category === 'é“å…·é›å†¶' && item.subCategory === 'ç´ æ' ? 'å¤±æ•—(0å€‹)' : 'å¤±æ•—' }
          ].map(({ key, label }) => (
            <div key={key} className="flex flex-col">
              <label className="text-xs font-bold text-gray-700 mb-1">{label}</label>
              <div className="flex items-center gap-1">
                <input
                  type="text"
                  inputMode="numeric"
                  placeholder="0"
                  value={craftResults[item.name]?.[key] || ''}
                  onClick={(e) => e.stopPropagation()}
                  onChange={(e) => {
                    const value = e.target.value.replace(/[^0-9]/g, '');
                    setCraftResults(prev => ({
                      ...prev,
                      [item.name]: {
                        ...prev[item.name],
                        [key]: value === '' ? 0 : parseInt(value) || 0
                      }
                    }));
                  }}
                  className="flex-1 px-2 py-1.5 rounded-lg border-2 border-emerald-300 focus:outline-none focus:ring-2 focus:ring-emerald-400 font-bold text-right text-sm"
                />
                <span className="text-gray-600 font-bold text-xs">å›</span>
              </div>
            </div>
          ))}
        </div>
        
        {(() => {
          const results = craftResults[item.name] || {};
          const total = (results.star3 || 0) + (results.star2 || 0) + (results.star1 || 0) + (results.star0 || 0) + (results.fail || 0);
          const expected = craftQuantity[item.name] || 1;
          
          if (total > 0) {
            return (
              <div className={`mt-2 text-xs font-bold ${total === expected ? 'text-green-600' : 'text-orange-600'}`}>
                åˆè¨ˆ: {total} å› {total === expected ? 'âœ“' : `(äºˆå®š: ${expected}å›)`}
              </div>
            );
          }
          return null;
        })()}
      </>
    )}
                        
{(() => {
  const results = craftResults[item.name] || {};
  const prices = sellPrices[item.name] || {};
  const isMaterial = item.category === 'é“å…·é›å†¶' && item.subCategory === 'ç´ æ';
  const isSimpleMode = isMaterial && (craftResults[`${item.name}_mode`] || 'simple') === 'simple';
  
  let hasData = false;
  if (isMaterial && isSimpleMode) {
    hasData = (results.totalItems > 0);
  } else {
    hasData = ((results.star3 || 0) + (results.star2 || 0) + (results.star1 || 0) + (results.star0 || 0) + (results.fail || 0) > 0);
  }
  
  const hasPrice = isMaterial ? prices.unitPrice : (prices.star3 || prices.star2 || prices.star1 || prices.star0);
  
  if (hasData && hasPrice) {
    const feeRate = (bazaarMode[item.name] ?? true) ? 0.95 : 1.0;
    
    let totalIncome;
    
    if (isMaterial) {
      const unitPrice = Math.floor((prices.unitPrice || 0) * feeRate);
      
      if (isSimpleMode) {
        totalIncome = (results.totalItems || 0) * unitPrice;
      } else {
        const totalItems = 
          (results.star3 || 0) * 10 +
          (results.star2 || 0) * 3 +
          (results.star1 || 0) * 2 +
          (results.star0 || 0) * 1 +
          (results.fail || 0) * 0;
        totalIncome = totalItems * unitPrice;
      }
    } else {
      totalIncome = 
        Math.floor((results.star3 || 0) * (prices.star3 || 0) * feeRate) +
        Math.floor((results.star2 || 0) * (prices.star2 || 0) * feeRate) +
        Math.floor((results.star1 || 0) * (prices.star1 || 0) * feeRate) +
        Math.floor((results.star0 || 0) * (prices.star0 || 0) * feeRate);
    }
    
    const totalCost = calculateTotal(item);
    const profit = totalIncome - totalCost;
    const profitRate = totalCost > 0 ? ((profit / totalCost) * 100).toFixed(1) : 0;
    
    return (
      <div className="mt-3 p-3 bg-gradient-to-br from-teal-50/80 via-emerald-50/80 to-green-50/80 backdrop-blur-sm rounded-lg shadow-lg border border-teal-200/50">
  <div className="text-xs font-bold text-teal-900 mb-2 flex items-center gap-2">
    <span className="text-lg">ğŸ’µ</span>
    <span>åæ”¯è¨ˆç®—</span>
  </div>
        <div className="space-y-1 text-sm">
          <div className="flex justify-between">
            <span className="text-gray-700">ç·å£²ä¸Š</span>
            <span className="font-bold text-blue-600">{totalIncome.toLocaleString()} G</span>
          </div>
          <div className="flex justify-between">
            <span className="text-gray-700">ç·ã‚³ã‚¹ãƒˆ</span>
            <span className="font-bold text-red-600">{totalCost.toLocaleString()} G</span>
          </div>
          <div className="border-t border-gray-300 my-1"></div>
          <div className="flex justify-between items-center">
            <span className="text-lg font-black text-gray-800">ç´”åˆ©ç›Š:</span>
            <div className="text-right">
              <div className={`font-black text-2xl ${profit >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                {profit >= 0 ? '+' : ''}{profit.toLocaleString()} G
              </div>
              <div className={`text-xs font-bold ${profit >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                {profit >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'} {profitRate}%
              </div>
            </div>
          </div>
          {!isSimpleMode && results.fail > 0 && (
            <div className="text-xs text-gray-500 mt-2">
              â€» å¤±æ•—å“{results.fail}å›ã¯å£²å´ä¸å¯ã®ãŸã‚åç›Šã«å«ã¿ã¾ã›ã‚“
            </div>
          )}
        </div>
      </div>
    );
  }
  return null;
})()}

{/* ğŸ†• æˆæœä¿å­˜ãƒœã‚¿ãƒ³ */}
{(() => {
  const results = craftResults[item.name] || {};
  const prices = sellPrices[item.name] || {};
  const isMaterial = item.category === 'é“å…·é›å†¶' && item.subCategory === 'ç´ æ';
  const isSimpleMode = isMaterial && (craftResults[`${item.name}_mode`] || 'simple') === 'simple';
  
  let hasData = false;
  if (isMaterial && isSimpleMode) {
    hasData = (results.totalItems > 0);
  } else {
    hasData = ((results.star3 || 0) + (results.star2 || 0) + (results.star1 || 0) + (results.star0 || 0) + (results.fail || 0) > 0);
  }
  
  const hasPrice = isMaterial ? prices.unitPrice : (prices.star3 || prices.star2 || prices.star1 || prices.star0);
  
  if (hasData && hasPrice) {
    return (
      <button
        onClick={(e) => {
          e.stopPropagation();
          saveRecord(item);
        }}
        className="mt-3 w-full px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl font-bold shadow-lg hover:shadow-xl transition-all transform hover:scale-105"
      >
        ğŸ’¾ æˆæœã‚’ä¿å­˜ã™ã‚‹
      </button>
    );
  }
  return null;
})()}
      </div>
    )}
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>

      <footer className="bg-white/80 backdrop-blur-md mt-8 py-4">
        <div className="max-w-5xl mx-auto px-3 text-center text-gray-600 text-xs">
          <p className="font-bold">ãƒ‰ãƒ©ã‚¯ã‚¨10 è·äººæ”¯æ´ãƒ„ãƒ¼ãƒ«</p>
          <p className="mt-0.5 text-xs">ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ç‰ˆ with åç›Šç®¡ç†</p>
        </div>
      </footer>
    </div>
  );
};

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<CraftsmanApp />);
  </script>
</body>
</html>

